<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام التوظيف - Al-Zahrani</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    
    <!-- إضافة Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, query, orderBy, doc, deleteDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCWQ2q1HU_LLQKkp2KRlOZ1FdF0bI6jBbM",
            authDomain: "zahrani-bc3ae.firebaseapp.com",
            projectId: "zahrani-bc3ae",
            storageBucket: "zahrani-bc3ae.firebasestorage.app",
            messagingSenderId: "405206070457",
            appId: "1:405206070457:web:fedf4204571d910030d768"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.db = db;
        window.firestoreFunctions = { collection, addDoc, getDocs, query, orderBy, doc, deleteDoc, getDoc };

        console.log("✅ Firebase initialized successfully");
        window.firebaseReady = true;
        if (window.onFirebaseReady) window.onFirebaseReady();
    </script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', 'Tajawal', sans-serif; }
        :root {
            --primary: #1a365d; --secondary: #2d3748; --accent: #3182ce; --success: #38a169;
            --warning: #d69e2e; --danger: #e53e3e; --light: #f7fafc; --dark: #2d3748;
            --gradient: linear-gradient(135deg, #1a365d 0%, #2d3748 100%);
        }
        
        /* إضافة الخلفية الجديدة */
        body { 
            background: linear-gradient(rgba(255, 255, 255, 0.85), rgba(255, 255, 255, 0.85)), 
                        url('https://i.ibb.co/0Q6qW8g/background.jpg') no-repeat center center fixed;
            background-size: cover;
            min-height: 100vh; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            padding: 20px; 
            position: relative;
        }
        
        /* طبقة شفافة فوق الخلفية */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.7);
            z-index: -1;
        }
        
        .container { 
            width: 100%; 
            max-width: 1200px; 
            position: relative;
            z-index: 1;
        }
        
        .header { 
            background: var(--gradient); 
            color: white; 
            padding: 20px; 
            border-radius: 15px; 
            text-align: center; 
            margin-bottom: 30px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); 
            position: relative; 
            overflow: hidden; 
        }
        .header::before { 
            content: ''; 
            position: absolute; 
            top: 0; 
            left: 0; 
            right: 0; 
            height: 4px; 
            background: linear-gradient(90deg, var(--accent), var(--success)); 
        }
        .logo { width: 120px; height: auto; margin-bottom: 15px; }
        .main-title { font-size: 2.2rem; margin-bottom: 10px; font-weight: 700; }
        .sub-title { font-size: 1.1rem; opacity: 0.9; }
        
        .nav-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; margin-bottom: 40px; }
        .nav-card { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.08); text-align: center; transition: all 0.3s ease; cursor: pointer; border: 2px solid transparent; position: relative; overflow: hidden; }
        .nav-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: var(--accent); transform: scaleX(0); transition: transform 0.3s ease; }
        .nav-card:hover { transform: translateY(-5px); box-shadow: 0 15px 35px rgba(0,0,0,0.15); border-color: var(--accent); }
        .nav-card:hover::before { transform: scaleX(1); }
        .nav-icon { font-size: 3rem; color: var(--accent); margin-bottom: 20px; }
        .nav-title { font-size: 1.4rem; color: var(--primary); margin-bottom: 15px; font-weight: 600; }
        .nav-description { color: var(--secondary); line-height: 1.6; }
        
        .form-container { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.08); margin-bottom: 30px; display: none; }
        .form-title { color: var(--primary); font-size: 1.8rem; margin-bottom: 25px; text-align: center; font-weight: 600; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 25px; }
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark); }
        .form-input, .form-select, .form-textarea { width: 100%; padding: 12px 15px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 15px; transition: all 0.3s ease; background: white; }
        .form-input:focus, .form-select:focus, .form-textarea:focus { border-color: var(--accent); outline: none; box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.1); }
        .form-textarea { resize: vertical; min-height: 100px; }
        
        .image-preview { margin-top: 10px; text-align: center; }
        .image-preview img { max-width: 200px; max-height: 150px; border-radius: 8px; border: 2px solid #e2e8f0; }
        .remove-image { margin-top: 5px; background: var(--danger); color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 12px; }
        
        .btn { padding: 12px 30px; border: none; border-radius: 8px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; display: inline-flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-primary { background: var(--accent); color: white; }
        .btn-primary:hover { background: #2c5aa0; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(49, 130, 206, 0.3); }
        .btn-secondary { background: var(--secondary); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-warning { background: var(--warning); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-full { width: 100%; }
        .btn-group { display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap; }
        .btn-small { padding: 8px 15px; font-size: 14px; }
        
        .table-container { background: white; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.08); overflow: hidden; margin-bottom: 30px; }
        .table-header { background: var(--gradient); color: white; padding: 20px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; }
        .table-title { font-size: 1.5rem; font-weight: 600; }
        .filters { display: flex; gap: 15px; flex-wrap: wrap; }
        .filter-group { display: flex; flex-direction: column; gap: 5px; }
        .filter-label { font-size: 0.9rem; opacity: 0.9; }
        .data-table { width: 100%; border-collapse: collapse; }
        .data-table th { background: #f7fafc; padding: 15px; text-align: right; font-weight: 600; color: var(--dark); border-bottom: 2px solid #e2e8f0; }
        .data-table td { padding: 15px; border-bottom: 1px solid #e2e8f0; text-align: right; }
        .data-table tr:hover { background: #f7fafc; }
        .status-badge { padding: 5px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; }
        .status-active { background: #c6f6d5; color: #22543d; }
        
        .login-container { background: white; padding: 40px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.08); max-width: 400px; margin: 0 auto; display: none; }
        .login-title { color: var(--primary); font-size: 1.8rem; margin-bottom: 30px; text-align: center; font-weight: 600; }
        
        .lang-toggle { position: fixed; top: 20px; left: 20px; background: var(--accent); color: white; border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; font-weight: 600; z-index: 1000; box-shadow: 0 3px 10px rgba(0,0,0,0.2); display: flex; align-items: center; gap: 8px; }
        
        .loading { display: inline-block; width: 20px; height: 20px; border: 3px solid #ffffff; border-radius: 50%; border-top-color: transparent; animation: spin 1s ease-in-out infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .hidden { display: none; }
        .text-center { text-align: center; }
        .mt-20 { margin-top: 20px; }
        
        .job-announcement { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 30px; border-radius: 15px; margin-bottom: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; }
        .job-announcement h2 { font-size: 2.2rem; margin-bottom: 20px; font-weight: 800; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .job-announcement h3 { font-size: 1.6rem; margin: 20px 0 15px; font-weight: 700; }
        .job-announcement p { font-size: 1.2rem; margin-bottom: 15px; line-height: 1.7; font-weight: 500; }
        .job-announcement ul { text-align: right; margin: 20px 0; padding-right: 20px; }
        .job-announcement li { margin-bottom: 12px; font-size: 1.1rem; line-height: 1.6; }
        
        .success-message { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 25px; border-radius: 15px; margin-top: 30px; text-align: center; display: none; }
        
        .expiry-warning { color: var(--danger); font-size: 0.9rem; margin-top: 5px; display: none; }
        
        /* تنسيقات التحقق */
        .verification-container { background: white; padding: 40px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.08); max-width: 400px; margin: 0 auto; display: none; }
        .verification-title { color: var(--primary); font-size: 1.8rem; margin-bottom: 30px; text-align: center; font-weight: 600; }
        
        /* تنسيقات البروفايل */
        .profile-header { background: var(--gradient); color: white; padding: 30px; border-radius: 15px; margin-bottom: 30px; display: flex; align-items: center; gap: 20px; }
        .profile-image { width: 100px; height: 100px; border-radius: 50%; border: 4px solid white; object-fit: cover; }
        .profile-info { flex: 1; }
        .profile-name { font-size: 1.8rem; font-weight: 700; margin-bottom: 5px; }
        .profile-role { font-size: 1.1rem; opacity: 0.9; }
        
        /* تنسيقات OTP */
        .otp-input { text-align: center; font-size: 1.5rem; font-weight: bold; letter-spacing: 8px; }
        .otp-message { background: #e6fffa; border: 2px solid #38a169; color: #22543d; padding: 15px; border-radius: 8px; margin: 20px 0; text-align: center; font-weight: 600; }
        
        /* تنسيقات التنقل في لوحة المشرف */
        .supervisor-nav { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .supervisor-nav-btn { flex: 1; min-width: 200px; }
        
        @media (max-width: 768px) {
            .nav-cards, .form-grid { grid-template-columns: 1fr; }
            .table-header { flex-direction: column; align-items: stretch; }
            .filters { flex-direction: column; }
            .data-table { font-size: 0.9rem; }
            .data-table th, .data-table td { padding: 10px 8px; }
            .btn-group { flex-direction: column; }
            .job-announcement h2 { font-size: 1.8rem; }
            .job-announcement h3 { font-size: 1.4rem; }
            .job-announcement p, .job-announcement li { font-size: 1rem; }
            .profile-header { flex-direction: column; text-align: center; }
            .supervisor-nav { flex-direction: column; }
        }
    </style>
</head>
<body class="lang-ar">
    <button class="lang-toggle" onclick="toggleLanguage()">
        <i class="fas fa-globe"></i>
        <span id="langText">EN</span>
    </button>

    <div class="container">
        <div class="header">
            <img src="https://assets.zyrosite.com/cdn-cgi/image/format=auto,w=375,fit=crop,q=95/dOqNLp8LNNTl7Vlk/alzahrani-logistics-corporate-logo-photoroom-AR03Qav69VTGKk9B.png" alt="Al-Zahrani Logo" class="logo">
            <h1 class="main-title" data-ar="نظام التوظيف" data-en="Employment System" data-ur="ملازمت کا نظام">نظام التوظيف</h1>
            <p class="sub-title" data-ar="Al-Zahrani Logistics - نظام التوظيف" data-en="Al-Zahrani Logistics - Employment System" data-ur="الزہرانی لوجسٹکس - ملازمت کا نظام">Al-Zahrani Logistics - نظام التوظيف</p>
        </div>

        <div class="nav-cards">
            <div class="nav-card" onclick="showJobApplicationForm()">
                <div class="nav-icon"><i class="fas fa-user-tie"></i></div>
                <h3 class="nav-title" data-ar="تقديم طلب توظيف" data-en="Submit Job Application" data-ur="درخواست جمع کروائیں">تقديم طلب توظيف</h3>
                <p class="nav-description" data-ar="تقديم طلب توظيف لوظيفة مندوب توصيل" data-en="Submit job application for delivery representative" data-ur="ڈیلیوری نمائندے کے لیے درخواست جمع کروائیں">تقديم طلب توظيف لوظيفة مندوب توصيل</p>
            </div>

            <div class="nav-card" onclick="showSupervisorLogin()">
                <div class="nav-icon"><i class="fas fa-user-shield"></i></div>
                <h3 class="nav-title" data-ar="دخول المشرف" data-en="Supervisor Login" data-ur="سپروائزر لاگ ان">دخول المشرف</h3>
                <p class="nav-description" data-ar="إدارة طلبات التوظيف وعرض التقارير" data-en="Manage job applications and view reports" data-ur="ملازمت کی درخواستیں منظم کریں اور رپورٹس دیکھیں">إدارة طلبات التوظيف وعرض التقارير</p>
            </div>
        </div>

        <!-- Job Announcement -->
        <div id="jobAnnouncement" class="job-announcement">
            <h2 data-ar="🚀 فرصة عمل مميزة في شركة الزهراني للخدمات اللوجستية 🏍️" data-en="🚀 Great Job Opportunity at Al-Zahrani Logistics Company 🏍️" data-ur="🚀 الزہرانی لوجسٹکس کمپنی میں بہترین ملازمت کا موقع 🏍️">🚀 فرصة عمل مميزة في شركة الزهراني للخدمات اللوجستية 🏍️</h2>
            <p data-ar="تُعلن شركة الزهراني للخدمات اللوجستية عن فتح باب التوظيف لوظيفة مندوب توصيل (دباب نينجا - استور) ضمن فريق ميداني نشط بالمملكة. نبحث عن شباب طموحين وجادين يمتلكون روح الالتزام والمسؤولية ويحبون العمل الميداني والإنجاز السريع." data-en="Al-Zahrani Logistics Company announces the opening of employment for the position of delivery representative (Ninja Motorcycle - Store) within an active field team in the Kingdom. We are looking for ambitious and serious young people who have a spirit of commitment and responsibility and love field work and quick achievement." data-ur="الزہرانی لوجسٹکس کمپنی مملکت میں ایک فعال فیلڈ ٹیم کے اندر ڈیلیوری نمائندے (ننجا موٹرسائیکل - اسٹور) کی پوزیشن کے لیے ملازمت کے دروازے کھولنے کا اعلان کرتی ہے۔ ہم پرعزم اور سنجیدہ نوجوانوں کی تلاش میں ہیں جن میں وابستگی اور ذمہ داری کا جذبہ ہو اور فیلڈ ورک اور فوری کامیابی سے محبت ہو۔">تُعلن شركة الزهراني للخدمات اللوجستية عن فتح باب التوظيف لوظيفة مندوب توصيل (دباب نينجا - استور) ضمن فريق ميداني نشط بالمملكة. نبحث عن شباب طموحين وجادين يمتلكون روح الالتزام والمسؤولية ويحبون العمل الميداني والإنجاز السريع.</p>
            
            <h3 data-ar="تفاصيل الوظيفة" data-en="Job Details" data-ur="ملازمت کی تفصیلات">تفاصيل الوظيفة</h3>
            <ul>
                <li data-ar="المسمى الوظيفي: مندوب توصيل (دباب نينجا - استور)" data-en="Job Title: Delivery Representative (Ninja Motorcycle - Store)" data-ur="ملازمت کا عنوان: ڈیلیوری نمائندہ (ننجا موٹرسائیکل - اسٹور)">المسمى الوظيفي: مندوب توصيل (دباب نينجا - استور)</li>
                <li data-ar="الراتب الشهري: 2300 ريال" data-en="Monthly Salary: 2300 SAR" data-ur="ماہانہ تنخواہ: 2300 ریال">الراتب الشهري: 2300 ريال</li>
                <li data-ar="ساعات الدوام: 10 ساعة يوميًا (اي ساعة اضافية أوفر تايم)" data-en="Working Hours: 10 hours daily (any extra hour is overtime)" data-ur="کام کے اوقات: روزانہ 10 گھنٹے (کوئی بھی اضافی گھنٹہ اوور ٹائم ہے)">ساعات الدوام: 10 ساعة يوميًا (اي ساعة اضافية أوفر تايم)</li>
                <li data-ar="الشركة توفر الدباب والوقود" data-en="The company provides the motorcycle and fuel" data-ur="کمپنی موٹرسائیکل اور ایندھن مہیا کرتی ہے">الشركة توفر الدباب والوقود</li>
                <li data-ar="نقل كفالة بعد شهرين من بدء العمل" data-en="Sponsorship transfer after two months of work" data-ur="کام شروع کرنے کے دو ماہ بعد کفالت کی منتقلی">نقل كفالة بعد شهرين من بدء العمل</li>
                <li data-ar="المكافآت الإضافية - بونس" data-en="Additional rewards - Bonus" data-ur="اضافی انعامات - بونس">المكافآت الإضافية - بونس</li>
            </ul>
            
            <h3 data-ar="الشروط المطلوبة" data-en="Required Conditions" data-ur="مطلوبہ شرائط">الشروط المطلوبة</h3>
            <ul>
                <li data-ar="إقامة سارية المفعول" data-en="Valid residence permit" data-ur="درست رہائشی اجازت">إقامة سارية المفعول</li>
                <li data-ar="رخصة قيادة دباب سارية" data-en="Valid motorcycle driving license" data-ur="درست موٹرسائیکل ڈرائیونگ لائسنس">رخصة قيادة دباب سارية</li>
                <li data-ar="الجدية والانضباط في العمل" data-en="Seriousness and discipline at work" data-ur="کام میں سنجیدگی اور نظم و ضبط">الجدية والانضباط في العمل</li>
            </ul>
            
            <h3 data-ar="المزايا" data-en="Advantages" data-ur="فوائد">المزايا</h3>
            <ul>
                <li data-ar="بيئة عمل منظمة وداعمة" data-en="Organized and supportive work environment" data-ur="منظم اور معاون کام کا ماحول">بيئة عمل منظمة وداعمة</li>
                <li data-ar="فرصة للاستقرار الوظيفي ونقل الكفالة" data-en="Opportunity for job stability and sponsorship transfer" data-ur="ملازمت کے استحکام اور کفالت کی منتقلی کا موقع">فرصة للاستقرار الوظيفي ونقل الكفالة</li>
                <li data-ar="دعم ومتابعة ميدانية مستمرة" data-en="Continuous field support and follow-up" data-ur="مسلسل فیلڈ سپورٹ اور فالو اپ">دعم ومتابعة ميدانية مستمرة</li>
                <li data-ar="مكان العمل: الشرقية – الدمام" data-en="Work Location: Eastern Province - Dammam" data-ur="کام کی جگہ: مشرقی صوبہ - دمام">مكان العمل: الشرقية – الدمام</li>
            </ul>
        </div>

        <!-- Job Application Form -->
        <div id="jobApplicationForm" class="form-container">
            <h2 class="form-title" data-ar="طلب توظيف جديد" data-en="New Job Application" data-ur="نیا ملازمت کا درخواست فارم">طلب توظيف جديد</h2>
            <form id="jobForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label" data-ar="الاسم الكامل" data-en="Full Name" data-ur="پورا نام">الاسم الكامل</label>
                        <input type="text" class="form-input" id="fullName" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label" data-ar="رقم الجوال" data-en="Phone Number" data-ur="فون نمبر">رقم الجوال</label>
                        <input type="tel" class="form-input" id="phoneNumber" required>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label" data-ar="نوع المركبة" data-en="Vehicle Type" data-ur="گاڑی کی قسم">نوع المركبة</label>
                        <select class="form-select" id="vehicleType" required onchange="toggleLicensePlateField()">
                            <option value="" data-ar="اختر نوع المركبة" data-en="Select Vehicle Type" data-ur="گاڑی کی قسم منتخب کریں">اختر نوع المركبة</option>
                            <option value="دباب" data-ar="دباب" data-en="Motorcycle" data-ur="موٹرسائیکل">دباب</option>
                            <option value="سيارة" data-ar="سيارة" data-en="Car" data-ur="کار">سيارة</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label" data-ar="رقم لوحة المركبة" data-en="Vehicle Plate Number" data-ur="گاڑی کی پلیٹ نمبر">رقم لوحة المركبة</label>
                        <input type="text" class="form-input" id="vehiclePlate" required>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label" data-ar="تاريخ انتهاء الإقامة" data-en="Residence Expiry Date" data-ur="رہائشی کی میعاد ختم ہونے کی تاریخ">تاريخ انتهاء الإقامة</label>
                        <input type="date" class="form-input" id="residenceExpiry" required onchange="checkExpiry(this, 'residence')">
                        <div class="expiry-warning" id="residenceWarning" data-ar="❌ إقامتك منتهية" data-en="❌ Your residence is expired" data-ur="❌ آپ کی رہائش ختم ہو گئی ہے">❌ إقامتك منتهية</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" data-ar="تاريخ انتهاء الرخصة" data-en="License Expiry Date" data-ur="لائسنس کی میعاد ختم ہونے کی تاریخ">تاريخ انتهاء الرخصة</label>
                        <input type="date" class="form-input" id="licenseExpiry" required onchange="checkExpiry(this, 'license')">
                        <div class="expiry-warning" id="licenseWarning" data-ar="❌ رخصتك منتهية" data-en="❌ Your license is expired" data-ur="❌ آپ کا لائسنس ختم ہو گیا ہے">❌ رخصتك منتهية</div>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label" data-ar="صورة الإقامة" data-en="Residence Photo" data-ur="رہائشی کی تصویر">صورة الإقامة</label>
                        <input type="file" class="form-input" id="residencePhoto" accept="image/*" onchange="previewImage(this, 'residencePreview')" required>
                        <div class="image-preview" id="residencePreview"></div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" data-ar="صورة رخصة القيادة" data-en="Driving License Photo" data-ur="ڈرائیونگ لائسنس کی تصویر">صورة رخصة القيادة</label>
                        <input type="file" class="form-input" id="licensePhoto" accept="image/*" onchange="previewImage(this, 'licensePreview')" required>
                        <div class="image-preview" id="licensePreview"></div>
                    </div>
                </div>

                <div class="btn-group">
                    <button type="submit" class="btn btn-primary btn-full" id="submitBtn">
                        <i class="fas fa-paper-plane"></i>
                        <span data-ar="تقديم الطلب" data-en="Submit Application" data-ur="درخواست جمع کروائیں">تقديم الطلب</span>
                    </button>
                </div>
            </form>

            <div class="btn-group">
                <button class="btn btn-secondary btn-full" onclick="showHomePage()">
                    <i class="fas fa-arrow-right"></i>
                    <span data-ar="العودة للرئيسية" data-en="Back to Home" data-ur="ہوم پیج پر واپس جائیں">العودة للرئيسية</span>
                </button>
            </div>
        </div>

        <!-- Success Message -->
        <div id="successMessage" class="success-message">
            <h2 data-ar="شكراً لتقديمك للوظيفة!" data-en="Thank you for applying!" data-ur="درخواست دینے کا شکریہ!">شكراً لتقديمك للوظيفة!</h2>
            <p data-ar="سيتم التواصل معك خلال ساعة او اقل" data-en="We will contact you within an hour or less" data-ur="ہم ایک گھنٹے یا اس سے کم وقت میں آپ سے رابطہ کریں گے">سيتم التواصل معك خلال ساعة او اقل</p>
        </div>

        <!-- Supervisor Login -->
        <div id="supervisorLogin" class="login-container">
            <h2 class="login-title" data-ar="دخول المشرف" data-en="Supervisor Login" data-ur="سپروائزر لاگ ان">دخول المشرف</h2>
            <div class="form-group">
                <label class="form-label" data-ar="اسم المستخدم" data-en="Username" data-ur="صارف نام">اسم المستخدم</label>
                <input type="text" class="form-input" id="username" placeholder="أدخل اسم المستخدم">
            </div>

            <div class="form-group">
                <label class="form-label" data-ar="كلمة المرور" data-en="Password" data-ur="پاس ورڈ">كلمة المرور</label>
                <input type="password" class="form-input" id="password" placeholder="أدخل كلمة المرور">
            </div>

            <div class="btn-group">
                <button class="btn btn-primary btn-full" onclick="supervisorLogin()">
                    <i class="fas fa-sign-in-alt"></i>
                    <span data-ar="دخول" data-en="Login" data-ur="لاگ ان">دخول</span>
                </button>
            </div>

            <div class="btn-group">
                <button class="btn btn-secondary btn-full" onclick="showHomePage()">
                    <i class="fas fa-arrow-right"></i>
                    <span data-ar="العودة للرئيسية" data-en="Back to Home" data-ur="ہوم پیج پر واپس جائیں">العودة للرئيسية</span>
                </button>
            </div>
        </div>

        <!-- Verification Container -->
        <div id="verificationContainer" class="verification-container">
            <h2 class="verification-title" data-ar="التحقق من الهوية" data-en="Identity Verification" data-ur="شناختی تصدیق">التحقق من الهوية</h2>
            
            <div class="otp-message" id="otpMessage">
                <i class="fas fa-shield-alt"></i>
                <span data-ar="تم إرسال رمز التحقق إلى المشرف أحمد الصادق" data-en="Verification code has been sent to supervisor Ahmed Al-Sadiq" data-ur="تصدیقی کوڈ سپروائزر احمد الصادق کو بھیج دیا گیا ہے">تم إرسال رمز التحقق إلى المشرف أحمد الصادق</span>
            </div>

            <div class="form-group">
                <label class="form-label" data-ar="أدخل رمز التحقق (OTP)" data-en="Enter Verification Code (OTP)" data-ur="تصدیقی کوڈ درج کریں (OTP)">أدخل رمز التحقق (OTP)</label>
                <input type="password" class="form-input otp-input" id="otpCode" placeholder="●●●●●●" maxlength="6">
            </div>

            <div class="btn-group">
                <button class="btn btn-success btn-full" onclick="verifyOTP()">
                    <i class="fas fa-check-circle"></i>
                    <span data-ar="تحقق" data-en="Verify" data-ur="تصدیق کریں">تحقق</span>
                </button>
            </div>

            <div class="btn-group">
                <button class="btn btn-secondary btn-full" onclick="showSupervisorLogin()">
                    <i class="fas fa-arrow-right"></i>
                    <span data-ar="العودة لتسجيل الدخول" data-en="Back to Login" data-ur="لاگ ان پر واپس جائیں">العودة لتسجيل الدخول</span>
                </button>
            </div>
        </div>

        <!-- Supervisor Dashboard -->
        <div id="supervisorDashboard" class="form-container">
            <!-- Profile Header -->
            <div class="profile-header">
                <img src="https://i.ibb.co/vrKBxqC/profile.jpg" alt="Ahmed Al-Sadiq" class="profile-image">
                <div class="profile-info">
                    <h2 class="profile-name">أحمد الصادق</h2>
                    <p class="profile-role" data-ar="مشرف نظام التوظيف" data-en="Employment System Supervisor" data-ur="ملازمت کے نظام کا سپروائزر">مشرف نظام التوظيف</p>
                </div>
                <button class="btn btn-danger" onclick="supervisorLogout()">
                    <i class="fas fa-sign-out-alt"></i>
                    <span data-ar="تسجيل الخروج" data-en="Logout" data-ur="لاگ آؤٹ">تسجيل الخروج</span>
                </button>
            </div>

            <!-- Supervisor Navigation -->
            <div class="supervisor-nav">
                <button class="btn btn-primary supervisor-nav-btn" onclick="showJobApplicationsSection()">
                    <i class="fas fa-users"></i>
                    <span data-ar="طلبات التوظيف" data-en="Job Applications" data-ur="ملازمت کی درخواستیں">طلبات التوظيف</span>
                </button>
                <button class="btn btn-success supervisor-nav-btn" onclick="showAdvanceRequestsSection()">
                    <i class="fas fa-hand-holding-usd"></i>
                    <span data-ar="طلبات السلفيات" data-en="Advance Requests" data-ur="ایڈوانس کی درخواستیں">طلبات السلفيات</span>
                </button>
            </div>

            <!-- Job Applications Section -->
            <div id="jobApplicationsSection">
                <div class="table-header">
                    <h2 class="table-title" data-ar="طلبات التوظيف المسجلة" data-en="Registered Job Applications" data-ur="رجسٹرڈ ملازمت کی درخواستیں">طلبات التوظيف المسجلة</h2>
                    <div class="filters">
                        <div class="filter-group">
                            <label class="filter-label" data-ar="اسم المتقدم" data-en="Applicant Name" data-ur="درخواست دہندہ کا نام">اسم المتقدم</label>
                            <input type="text" class="form-input" id="filterName" placeholder="بحث بالاسم">
                        </div>

                        <div class="filter-group">
                            <label class="filter-label" data-ar="التاريخ" data-en="Date" data-ur="تاریخ">التاريخ</label>
                            <input type="date" class="form-input" id="filterDate">
                        </div>
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-success" onclick="loadJobApplications()" id="loadDataBtn">
                        <i class="fas fa-sync-alt"></i>
                        <span data-ar="عرض البيانات" data-en="Show Data" data-ur="ڈیٹا دکھائیں">عرض البيانات</span>
                    </button>
                    <button class="btn btn-primary" onclick="exportJobApplicationsToExcel()">
                        <i class="fas fa-file-excel"></i>
                        <span data-ar="تحميل Excel" data-en="Download Excel" data-ur="ایکسل ڈاؤن لوڈ کریں">تحميل Excel</span>
                    </button>
                </div>

                <div class="table-container mt-20">
                    <table class="data-table" id="jobApplicationsTable">
                        <thead>
                            <tr>
                                <th data-ar="الاسم" data-en="Name" data-ur="نام">الاسم</th>
                                <th data-ar="رقم الجوال" data-en="Phone" data-ur="فون">رقم الجوال</th>
                                <th data-ar="نوع المركبة" data-en="Vehicle Type" data-ur="گاڑی کی قسم">نوع المركبة</th>
                                <th data-ar="رقم اللوحة" data-en="Plate Number" data-ur="پلیٹ نمبر">رقم اللوحة</th>
                                <th data-ar="انتهاء الإقامة" data-en="Residence Expiry" data-ur="رہائشی کی میعاد">انتهاء الإقامة</th>
                                <th data-ar="انتهاء الرخصة" data-en="License Expiry" data-ur="لائسنس کی میعاد">انتهاء الرخصة</th>
                                <th data-ar="صورة الإقامة" data-en="Residence Photo" data-ur="رہائشی تصویر">صورة الإقامة</th>
                                <th data-ar="صورة الرخصة" data-en="License Photo" data-ur="لائسنس تصویر">صورة الرخصة</th>
                                <th data-ar="التاريخ" data-en="Date" data-ur="تاریخ">التاريخ</th>
                                <th data-ar="الإجراءات" data-en="Actions" data-ur="اعمال">الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody id="applicationsTableBody">
                            <!-- البيانات سيتم تحميلها هنا -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Advance Requests Section -->
            <div id="advanceRequestsSection" style="display: none;">
                <div class="table-header">
                    <h2 class="table-title" data-ar="طلبات السلفيات" data-en="Advance Requests" data-ur="ایڈوانس کی درخواستیں">طلبات السلفيات</h2>
                    <div class="filters">
                        <div class="filter-group">
                            <label class="filter-label" data-ar="اسم الموظف" data-en="Employee Name" data-ur="ملازم کا نام">اسم الموظف</label>
                            <input type="text" class="form-input" id="filterEmployeeName" placeholder="بحث بالاسم">
                        </div>

                        <div class="filter-group">
                            <label class="filter-label" data-ar="التاريخ" data-en="Date" data-ur="تاریخ">التاريخ</label>
                            <input type="date" class="form-input" id="filterAdvanceDate">
                        </div>
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-success" onclick="loadAdvanceRequests()" id="loadAdvanceDataBtn">
                        <i class="fas fa-sync-alt"></i>
                        <span data-ar="عرض البيانات" data-en="Show Data" data-ur="ڈیٹا دکھائیں">عرض البيانات</span>
                    </button>
                    <button class="btn btn-primary" onclick="exportAdvanceRequestsToExcel()">
                        <i class="fas fa-file-excel"></i>
                        <span data-ar="تحميل Excel" data-en="Download Excel" data-ur="ایکسل ڈاؤن لوڈ کریں">تحميل Excel</span>
                    </button>
                    <button class="btn btn-warning" onclick="showAddAdvanceRequestForm()">
                        <i class="fas fa-plus"></i>
                        <span data-ar="إضافة طلب سلفية" data-en="Add Advance Request" data-ur="ایڈوانس کی درخواست شامل کریں">إضافة طلب سلفية</span>
                    </button>
                </div>

                <div class="table-container mt-20">
                    <table class="data-table" id="advanceRequestsTable">
                        <thead>
                            <tr>
                                <th data-ar="الاسم" data-en="Name" data-ur="نام">الاسم</th>
                                <th data-ar="المشروع" data-en="Project" data-ur="پروجیکٹ">المشروع</th>
                                <th data-ar="رقم الإقامة" data-en="Residence Number" data-ur="رہائشی نمبر">رقم الإقامة</th>
                                <th data-ar="نوع المركبة" data-en="Vehicle Type" data-ur="گاڑی کی قسم">نوع المركبة</th>
                                <th data-ar="رقم لوحة الدباب" data-en="Motorcycle Plate" data-ur="موٹرسائیکل پلیٹ">رقم لوحة الدباب</th>
                                <th data-ar="رقم لوحة السيارة" data-en="Car Plate" data-ur="کار پلیٹ">رقم لوحة السيارة</th>
                                <th data-ar="المبلغ" data-en="Amount" data-ur="رقم">المبلغ</th>
                                <th data-ar="التاريخ" data-en="Date" data-ur="تاریخ">التاريخ</th>
                                <th data-ar="الحالة" data-en="Status" data-ur="حالت">الحالة</th>
                                <th data-ar="الإجراءات" data-en="Actions" data-ur="اعمال">الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody id="advanceRequestsTableBody">
                            <!-- البيانات سيتم تحميلها هنا -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Add Advance Request Form -->
            <div id="addAdvanceRequestForm" class="form-container" style="display: none;">
                <h2 class="form-title" data-ar="إضافة طلب سلفية جديد" data-en="Add New Advance Request" data-ur="نیا ایڈوانس کی درخواست شامل کریں">إضافة طلب سلفية جديد</h2>
                <form id="advanceRequestForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label" data-ar="اسم الموظف" data-en="Employee Name" data-ur="ملازم کا نام">اسم الموظف</label>
                            <input type="text" class="form-input" id="employeeName" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label" data-ar="المشروع" data-en="Project" data-ur="پروجیکٹ">المشروع</label>
                            <input type="text" class="form-input" id="project" required>
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label" data-ar="رقم الإقامة" data-en="Residence Number" data-ur="رہائشی نمبر">رقم الإقامة</label>
                            <input type="text" class="form-input" id="residenceNumber" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label" data-ar="المبلغ" data-en="Amount" data-ur="رقم">المبلغ</label>
                            <input type="number" class="form-input" id="advanceAmount" required>
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label" data-ar="نوع المركبة" data-en="Vehicle Type" data-ur="گاڑی کی قسم">نوع المركبة</label>
                            <select class="form-select" id="advanceVehicleType" required onchange="toggleAdvancePlateFields()">
                                <option value="" data-ar="اختر نوع المركبة" data-en="Select Vehicle Type" data-ur="گاڑی کی قسم منتخب کریں">اختر نوع المركبة</option>
                                <option value="دباب" data-ar="دباب" data-en="Motorcycle" data-ur="موٹرسائیکل">دباب</option>
                                <option value="سيارة" data-ar="سيارة" data-en="Car" data-ur="کار">سيارة</option>
                                <option value="كلاهما" data-ar="كلاهما" data-en="Both" data-ur="دونوں">كلاهما</option>
                            </select>
                        </div>

                        <div class="form-group" id="motorcyclePlateGroup">
                            <label class="form-label" data-ar="رقم لوحة الدباب" data-en="Motorcycle Plate" data-ur="موٹرسائیکل پلیٹ">رقم لوحة الدباب</label>
                            <input type="text" class="form-input" id="motorcyclePlate">
                        </div>

                        <div class="form-group" id="carPlateGroup" style="display: none;">
                            <label class="form-label" data-ar="رقم لوحة السيارة" data-en="Car Plate" data-ur="کار پلیٹ">رقم لوحة السيارة</label>
                            <input type="text" class="form-input" id="carPlate">
                        </div>
                    </div>

                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary btn-full" id="submitAdvanceBtn">
                            <i class="fas fa-save"></i>
                            <span data-ar="حفظ طلب السلفية" data-en="Save Advance Request" data-ur="ایڈوانس کی درخواست محفوظ کریں">حفظ طلب السلفية</span>
                        </button>
                    </div>
                </form>

                <div class="btn-group">
                    <button class="btn btn-secondary btn-full" onclick="showAdvanceRequestsSection()">
                        <i class="fas fa-arrow-right"></i>
                        <span data-ar="العودة لطلبات السلفيات" data-en="Back to Advance Requests" data-ur="ایڈوانس کی درخواستوں پر واپس جائیں">العودة لطلبات السلفيات</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let systemState = {
            firebaseReady: false,
            currentEditingId: null,
            selectedResidenceImage: null,
            selectedLicenseImage: null,
            hasExpiredResidence: false,
            hasExpiredLicense: false,
            // كود التحقق المشفر (6 خانات) - 046035
            verificationCode: "046035"
        };

        window.onFirebaseReady = function() {
            systemState.firebaseReady = true;
            console.log("✅ Firebase is ready to use");
            showNotification(getTranslation('✅ تم الاتصال بقاعدة البيانات بنجاح', '✅ Connected to database successfully', '✅ ڈیٹا بیس سے کامیابی سے منسلک ہو گیا'), 'success');
        };

        // دالة التحقق من تاريخ الانتهاء
        function checkExpiry(input, type) {
            const expiryDate = new Date(input.value);
            const today = new Date();
            const warningElement = document.getElementById(type + 'Warning');
            
            if (expiryDate < today) {
                warningElement.style.display = 'block';
                if (type === 'residence') {
                    systemState.hasExpiredResidence = true;
                } else {
                    systemState.hasExpiredLicense = true;
                }
            } else {
                warningElement.style.display = 'none';
                if (type === 'residence') {
                    systemState.hasExpiredResidence = false;
                } else {
                    systemState.hasExpiredLicense = false;
                }
            }
        }

        // دالة رفع الصور إلى ImgBB
        async function uploadToImgBB(imageFile) {
            const apiKey = '6724dafff610326aa1f9cd661d600c9f';
            const formData = new FormData();
            formData.append('image', imageFile);

            try {
                const response = await fetch(`https://api.imgbb.com/1/upload?key=${apiKey}`, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                
                if (data.success) {
                    return data.data.url;
                } else {
                    throw new Error(data.error.message || 'فشل رفع الصورة');
                }
            } catch (error) {
                console.error('Error uploading image:', error);
                throw error;
            }
        }

        function previewImage(input, previewId) {
            const preview = document.getElementById(previewId);
            preview.innerHTML = '';
            
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    
                    const removeBtn = document.createElement('button');
                    removeBtn.type = 'button';
                    removeBtn.className = 'remove-image';
                    removeBtn.innerHTML = '<i class="fas fa-times"></i> ' + getTranslation('إزالة الصورة', 'Remove Image', 'تصویر ہٹائیں');
                    removeBtn.onclick = function() {
                        input.value = '';
                        preview.innerHTML = '';
                        if (previewId === 'residencePreview') {
                            systemState.selectedResidenceImage = null;
                        } else if (previewId === 'licensePreview') {
                            systemState.selectedLicenseImage = null;
                        }
                    };
                    
                    preview.appendChild(img);
                    preview.appendChild(removeBtn);
                    
                    if (previewId === 'residencePreview') {
                        systemState.selectedResidenceImage = input.files[0];
                    } else if (previewId === 'licensePreview') {
                        systemState.selectedLicenseImage = input.files[0];
                    }
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function toggleLicensePlateField() {
            const vehicleType = document.getElementById('vehicleType').value;
            const vehiclePlate = document.getElementById('vehiclePlate');
            
            if (vehicleType === 'دباب') {
                vehiclePlate.placeholder = getTranslation('أدخل رقم لوحة الدباب', 'Enter motorcycle plate number', 'موٹرسائیکل پلیٹ نمبر درج کریں');
            } else if (vehicleType === 'سيارة') {
                vehiclePlate.placeholder = getTranslation('أدخل رقم لوحة السيارة', 'Enter car plate number', 'کار پلیٹ نمبر درج کریں');
            } else {
                vehiclePlate.placeholder = getTranslation('رقم لوحة المركبة', 'Vehicle plate number', 'گاڑی کی پلیٹ نمبر');
            }
        }

        function toggleAdvancePlateFields() {
            const vehicleType = document.getElementById('advanceVehicleType').value;
            const motorcycleGroup = document.getElementById('motorcyclePlateGroup');
            const carGroup = document.getElementById('carPlateGroup');
            
            if (vehicleType === 'دباب') {
                motorcycleGroup.style.display = 'block';
                carGroup.style.display = 'none';
                document.getElementById('motorcyclePlate').required = true;
                document.getElementById('carPlate').required = false;
            } else if (vehicleType === 'سيارة') {
                motorcycleGroup.style.display = 'none';
                carGroup.style.display = 'block';
                document.getElementById('motorcyclePlate').required = false;
                document.getElementById('carPlate').required = true;
            } else if (vehicleType === 'كلاهما') {
                motorcycleGroup.style.display = 'block';
                carGroup.style.display = 'block';
                document.getElementById('motorcyclePlate').required = true;
                document.getElementById('carPlate').required = true;
            } else {
                motorcycleGroup.style.display = 'none';
                carGroup.style.display = 'none';
                document.getElementById('motorcyclePlate').required = false;
                document.getElementById('carPlate').required = false;
            }
        }

        function showHomePage() {
            document.getElementById('jobApplicationForm').style.display = 'none';
            document.getElementById('supervisorLogin').style.display = 'none';
            document.getElementById('supervisorDashboard').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
            document.getElementById('verificationContainer').style.display = 'none';
            document.querySelector('.nav-cards').style.display = 'grid';
            document.getElementById('jobAnnouncement').style.display = 'block';
            resetForm();
        }

        function showJobApplicationForm() {
            document.querySelector('.nav-cards').style.display = 'none';
            document.getElementById('jobApplicationForm').style.display = 'block';
            document.getElementById('supervisorLogin').style.display = 'none';
            document.getElementById('supervisorDashboard').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
            document.getElementById('verificationContainer').style.display = 'none';
            document.getElementById('jobAnnouncement').style.display = 'none';
            resetForm();
        }

        function showSupervisorLogin() {
            document.querySelector('.nav-cards').style.display = 'none';
            document.getElementById('jobApplicationForm').style.display = 'none';
            document.getElementById('supervisorLogin').style.display = 'block';
            document.getElementById('supervisorDashboard').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
            document.getElementById('verificationContainer').style.display = 'none';
            document.getElementById('jobAnnouncement').style.display = 'none';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        function showVerificationContainer() {
            document.querySelector('.nav-cards').style.display = 'none';
            document.getElementById('jobApplicationForm').style.display = 'none';
            document.getElementById('supervisorLogin').style.display = 'none';
            document.getElementById('supervisorDashboard').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
            document.getElementById('verificationContainer').style.display = 'block';
            document.getElementById('jobAnnouncement').style.display = 'none';
            document.getElementById('otpCode').value = '';
        }

        function showSupervisorDashboard() {
            document.querySelector('.nav-cards').style.display = 'none';
            document.getElementById('jobApplicationForm').style.display = 'none';
            document.getElementById('supervisorLogin').style.display = 'none';
            document.getElementById('supervisorDashboard').style.display = 'block';
            document.getElementById('successMessage').style.display = 'none';
            document.getElementById('verificationContainer').style.display = 'none';
            document.getElementById('jobAnnouncement').style.display = 'none';
            showJobApplicationsSection();
        }

        function showJobApplicationsSection() {
            document.getElementById('jobApplicationsSection').style.display = 'block';
            document.getElementById('advanceRequestsSection').style.display = 'none';
            document.getElementById('addAdvanceRequestForm').style.display = 'none';
            loadJobApplications();
        }

        function showAdvanceRequestsSection() {
            document.getElementById('jobApplicationsSection').style.display = 'none';
            document.getElementById('advanceRequestsSection').style.display = 'block';
            document.getElementById('addAdvanceRequestForm').style.display = 'none';
            loadAdvanceRequests();
        }

        function showAddAdvanceRequestForm() {
            document.getElementById('jobApplicationsSection').style.display = 'none';
            document.getElementById('advanceRequestsSection').style.display = 'none';
            document.getElementById('addAdvanceRequestForm').style.display = 'block';
            document.getElementById('advanceRequestForm').reset();
        }

        function showSuccessMessage() {
            document.querySelector('.nav-cards').style.display = 'none';
            document.getElementById('jobApplicationForm').style.display = 'none';
            document.getElementById('supervisorLogin').style.display = 'none';
            document.getElementById('supervisorDashboard').style.display = 'none';
            document.getElementById('successMessage').style.display = 'block';
            document.getElementById('jobAnnouncement').style.display = 'none';
        }

        function resetForm() {
            document.getElementById('jobForm').reset();
            document.getElementById('residencePreview').innerHTML = '';
            document.getElementById('licensePreview').innerHTML = '';
            document.getElementById('residenceWarning').style.display = 'none';
            document.getElementById('licenseWarning').style.display = 'none';
            systemState.currentEditingId = null;
            systemState.selectedResidenceImage = null;
            systemState.selectedLicenseImage = null;
            systemState.hasExpiredResidence = false;
            systemState.hasExpiredLicense = false;
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> <span data-ar="تقديم الطلب" data-en="Submit Application" data-ur="درخواست جمع کروائیں">تقديم الطلب</span>';
            submitBtn.disabled = false;
        }

        async function supervisorLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (username === 'احمد الصادق' && password === '0094') {
                showVerificationContainer();
                showNotification(getTranslation('تم إرسال رمز التحقق', 'Verification code has been sent', 'تصدیقی کوڈ بھیج دیا گیا ہے'), 'info');
            } else {
                showNotification(getTranslation('بيانات الدخول غير صحيحة', 'Invalid login credentials', 'غلط لاگ ان کی تفصیلات'), 'error');
            }
        }

        function verifyOTP() {
            const otpCode = document.getElementById('otpCode').value;
            
            if (otpCode === systemState.verificationCode) {
                showSupervisorDashboard();
                showNotification(getTranslation('✅ تم التحقق من الهوية - المشرف أحمد الصادق', '✅ Identity verified - Supervisor Ahmed Al-Sadiq', '✅ شناخت کی تصدیق ہو گئی - سپروائزر احمد الصادق'), 'success');
            } else {
                showNotification(getTranslation('❌ رمز التحقق غير صحيح', '❌ Invalid verification code', '❌ غلط تصدیقی کوڈ'), 'error');
            }
        }

        function supervisorLogout() {
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('otpCode').value = '';
            showHomePage();
            showNotification(getTranslation('تم تسجيل الخروج', 'Logged out successfully', 'لاگ آؤٹ کامیاب'), 'info');
        }

        async function submitJobApplication(event) {
            event.preventDefault();
            
            if (!systemState.firebaseReady) {
                showNotification(getTranslation('⏳ جاري الاتصال بقاعدة البيانات...', '⏳ Connecting to database...', '⏳ ڈیٹا بیس سے منسلک ہو رہا ہے...'), 'warning');
                return;
            }

            // التحقق من صلاحية الإقامة والرخصة
            if (systemState.hasExpiredResidence) {
                showNotification(getTranslation('❌ لا يمكن تقديم الطلب - إقامتك منتهية', '❌ Cannot submit application - Your residence is expired', '❌ درخواست جمع نہیں کرائی جا سکتی - آپ کی رہائش ختم ہو گئی ہے'), 'error');
                return;
            }

            if (systemState.hasExpiredLicense) {
                showNotification(getTranslation('❌ لا يمكن تقديم الطلب - رخصتك منتهية', '❌ Cannot submit application - Your license is expired', '❌ درخواست جمع نہیں کرائی جا سکتی - آپ کا لائسنس ختم ہو گیا ہے'), 'error');
                return;
            }

            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.innerHTML;
            
            try {
                submitBtn.innerHTML = '<div class="loading"></div> ' + getTranslation('جاري الإرسال...', 'Submitting...', 'جمع کرایا جا رہا ہے...');
                submitBtn.disabled = true;

                const formData = {
                    fullName: document.getElementById('fullName').value.trim(),
                    phoneNumber: document.getElementById('phoneNumber').value.trim(),
                    vehicleType: document.getElementById('vehicleType').value,
                    vehiclePlate: document.getElementById('vehiclePlate').value.trim(),
                    residenceExpiry: document.getElementById('residenceExpiry').value,
                    licenseExpiry: document.getElementById('licenseExpiry').value,
                    date: new Date().toISOString().split('T')[0],
                    timestamp: new Date(),
                    status: 'pending',
                    createdAt: new Date().toISOString()
                };

                if (!formData.fullName || !formData.phoneNumber || !formData.residenceExpiry || !formData.licenseExpiry || !formData.vehicleType || !formData.vehiclePlate) {
                    showNotification(getTranslation('❌ يرجى ملء جميع الحقول المطلوبة', '❌ Please fill all required fields', '❌ براہ کرم تمام ضروری فیلڈز کو پُر کریں'), 'error');
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                    return;
                }

                // التحقق من وجود الصور
                if (!systemState.selectedResidenceImage || !systemState.selectedLicenseImage) {
                    showNotification(getTranslation('❌ يرجى رفع صورتي الإقامة والرخصة', '❌ Please upload both residence and license photos', '❌ براہ کرم رہائشی اور لائسنس دونوں تصاویر اپ لوڈ کریں'), 'error');
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                    return;
                }

                let residenceImageUrl = null;
                let licenseImageUrl = null;

                // رفع صورة الإقامة
                try {
                    showNotification(getTranslation('📸 جاري رفع صورة الإقامة...', '📸 Uploading residence photo...', '📸 رہائشی تصویر اپ لوڈ ہو رہی ہے...'), 'info');
                    residenceImageUrl = await uploadToImgBB(systemState.selectedResidenceImage);
                    formData.residenceImageUrl = residenceImageUrl;
                    console.log("✅ Residence image uploaded to ImgBB:", residenceImageUrl);
                } catch (uploadError) {
                    console.error('Error uploading residence image:', uploadError);
                    showNotification(getTranslation('❌ حدث خطأ في رفع صورة الإقامة', '❌ Error uploading residence photo', '❌ رہائشی تصویر اپ لوڈ کرنے میں خرابی'), 'error');
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                    return;
                }

                // رفع صورة الرخصة
                try {
                    showNotification(getTranslation('📸 جاري رفع صورة الرخصة...', '📸 Uploading license photo...', '📸 لائسنس تصویر اپ لوڈ ہو رہی ہے...'), 'info');
                    licenseImageUrl = await uploadToImgBB(systemState.selectedLicenseImage);
                    formData.licenseImageUrl = licenseImageUrl;
                    console.log("✅ License image uploaded to ImgBB:", licenseImageUrl);
                } catch (uploadError) {
                    console.error('Error uploading license image:', uploadError);
                    showNotification(getTranslation('❌ حدث خطأ في رفع صورة الرخصة', '❌ Error uploading license photo', '❌ لائسنس تصویر اپ لوڈ کرنے میں خرابی'), 'error');
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                    return;
                }

                const docRef = await window.firestoreFunctions.addDoc(
                    window.firestoreFunctions.collection(window.db, "jobApplications"), 
                    formData
                );
                
                showNotification(getTranslation('✅ تم إرسال طلب التوظيف بنجاح', '✅ Job application submitted successfully', '✅ ملازمت کی درخواست کامیابی سے جمع ہو گئی'), 'success');
                resetForm();
                
                setTimeout(() => {
                    showSuccessMessage();
                }, 1000);
                
            } catch (error) {
                console.error('Error submitting form:', error);
                let errorMessage = getTranslation('❌ حدث خطأ أثناء إرسال الطلب', '❌ Error submitting request', '❌ درخواست جمع کرانے میں خرابی');
                
                if (error.code === 'permission-denied') {
                    errorMessage = getTranslation('❌ ليس لديك صلاحية للكتابة في قاعدة البيانات', '❌ Permission denied to write to database', '❌ ڈیٹا بیس میں لکھنے کی اجازت نہیں ہے');
                }
                
                showNotification(errorMessage, 'error');
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }

        async function submitAdvanceRequest(event) {
            event.preventDefault();
            
            if (!systemState.firebaseReady) {
                showNotification(getTranslation('⏳ جاري الاتصال بقاعدة البيانات...', '⏳ Connecting to database...', '⏳ ڈیٹا بیس سے منسلک ہو رہا ہے...'), 'warning');
                return;
            }

            const submitBtn = document.getElementById('submitAdvanceBtn');
            const originalText = submitBtn.innerHTML;
            
            try {
                submitBtn.innerHTML = '<div class="loading"></div> ' + getTranslation('جاري الحفظ...', 'Saving...', 'محفوظ ہو رہا ہے...');
                submitBtn.disabled = true;

                const formData = {
                    employeeName: document.getElementById('employeeName').value.trim(),
                    project: document.getElementById('project').value.trim(),
                    residenceNumber: document.getElementById('residenceNumber').value.trim(),
                    vehicleType: document.getElementById('advanceVehicleType').value,
                    motorcyclePlate: document.getElementById('motorcyclePlate').value.trim(),
                    carPlate: document.getElementById('carPlate').value.trim(),
                    amount: document.getElementById('advanceAmount').value,
                    date: new Date().toISOString().split('T')[0],
                    timestamp: new Date(),
                    status: 'pending',
                    createdAt: new Date().toISOString()
                };

                if (!formData.employeeName || !formData.project || !formData.residenceNumber || !formData.vehicleType || !formData.amount) {
                    showNotification(getTranslation('❌ يرجى ملء جميع الحقول المطلوبة', '❌ Please fill all required fields', '❌ براہ کرم تمام ضروری فیلڈز کو پُر کریں'), 'error');
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                    return;
                }

                // التحقق من أرقام اللوحات بناءً على نوع المركبة
                if (formData.vehicleType === 'دباب' && !formData.motorcyclePlate) {
                    showNotification(getTranslation('❌ يرجى إدخال رقم لوحة الدباب', '❌ Please enter motorcycle plate number', '❌ براہ کرم موٹرسائیکل پلیٹ نمبر درج کریں'), 'error');
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                    return;
                }

                if (formData.vehicleType === 'سيارة' && !formData.carPlate) {
                    showNotification(getTranslation('❌ يرجى إدخال رقم لوحة السيارة', '❌ Please enter car plate number', '❌ براہ کرم کار پلیٹ نمبر درج کریں'), 'error');
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                    return;
                }

                if (formData.vehicleType === 'كلاهما' && (!formData.motorcyclePlate || !formData.carPlate)) {
                    showNotification(getTranslation('❌ يرجى إدخال أرقام لوحات الدباب والسيارة', '❌ Please enter both motorcycle and car plate numbers', '❌ براہ کرم موٹرسائیکل اور کار دونوں کی پلیٹ نمبر درج کریں'), 'error');
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                    return;
                }

                const docRef = await window.firestoreFunctions.addDoc(
                    window.firestoreFunctions.collection(window.db, "advanceRequests"), 
                    formData
                );
                
                showNotification(getTranslation('✅ تم حفظ طلب السلفية بنجاح', '✅ Advance request saved successfully', '✅ ایڈوانس کی درخواست کامیابی سے محفوظ ہو گئی'), 'success');
                document.getElementById('advanceRequestForm').reset();
                
                setTimeout(() => {
                    showAdvanceRequestsSection();
                }, 1000);
                
            } catch (error) {
                console.error('Error submitting advance request:', error);
                let errorMessage = getTranslation('❌ حدث خطأ أثناء حفظ طلب السلفية', '❌ Error saving advance request', '❌ ایڈوانس کی درخواست محفوظ کرنے میں خرابی');
                
                if (error.code === 'permission-denied') {
                    errorMessage = getTranslation('❌ ليس لديك صلاحية للكتابة في قاعدة البيانات', '❌ Permission denied to write to database', '❌ ڈیٹا بیس میں لکھنے کی اجازت نہیں ہے');
                }
                
                showNotification(errorMessage, 'error');
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }

        async function loadJobApplications() {
            if (!systemState.firebaseReady) {
                showNotification(getTranslation('⏳ جاري الاتصال بقاعدة البيانات...', '⏳ Connecting to database...', '⏳ ڈیٹا بیس سے منسلک ہو رہا ہے...'), 'warning');
                return;
            }

            const loadBtn = document.getElementById('loadDataBtn');
            const originalText = loadBtn.innerHTML;
            const tableBody = document.getElementById('applicationsTableBody');
            
            try {
                loadBtn.innerHTML = '<div class="loading"></div> ' + getTranslation('جاري التحميل...', 'Loading...', 'لوڈ ہو رہا ہے...');
                loadBtn.disabled = true;
                tableBody.innerHTML = '<tr><td colspan="10" class="text-center">' + getTranslation('جاري تحميل البيانات...', 'Loading data...', 'ڈیٹا لوڈ ہو رہا ہے...') + '</td></tr>';

                const filterName = document.getElementById('filterName').value.toLowerCase();
                const filterDate = document.getElementById('filterDate').value;

                const q = window.firestoreFunctions.query(
                    window.firestoreFunctions.collection(window.db, "jobApplications"),
                    window.firestoreFunctions.orderBy("timestamp", "desc")
                );
                
                const querySnapshot = await window.firestoreFunctions.getDocs(q);
                const applicationsData = [];

                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    data.id = doc.id;
                    applicationsData.push(data);
                });

                const filteredData = applicationsData.filter(item => {
                    const matchName = !filterName || (item.fullName && item.fullName.toLowerCase().includes(filterName));
                    const matchDate = !filterDate || item.date === filterDate;
                    return matchName && matchDate;
                });

                tableBody.innerHTML = '';

                if (filteredData.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="10" class="text-center">' + getTranslation('لا توجد بيانات مطابقة', 'No matching data found', 'کوئی مماثل ڈیٹا نہیں ملا') + '</td></tr>';
                    return;
                }

                filteredData.forEach(item => {
                    const row = `
                        <tr data-id="${item.id}">
                            <td>${item.fullName || '-'}</td>
                            <td>${item.phoneNumber || '-'}</td>
                            <td>${item.vehicleType || '-'}</td>
                            <td>${item.vehiclePlate || '-'}</td>
                            <td>${item.residenceExpiry || '-'}</td>
                            <td>${item.licenseExpiry || '-'}</td>
                            <td>
                                ${item.residenceImageUrl ? 
                                    `<a href="${item.residenceImageUrl}" target="_blank" class="btn btn-primary btn-small">
                                        <i class="fas fa-eye"></i> ${getTranslation('عرض', 'View', 'دیکھیں')}
                                    </a>` : 
                                    '-'
                                }
                            </td>
                            <td>
                                ${item.licenseImageUrl ? 
                                    `<a href="${item.licenseImageUrl}" target="_blank" class="btn btn-primary btn-small">
                                        <i class="fas fa-eye"></i> ${getTranslation('عرض', 'View', 'دیکھیں')}
                                    </a>` : 
                                    '-'
                                }
                            </td>
                            <td>${item.date || '-'}</td>
                            <td>
                                <div class="btn-group">
                                    <button class="btn btn-danger btn-small" onclick="deleteApplication('${item.id}')">
                                        <i class="fas fa-trash"></i> ${getTranslation('حذف', 'Delete', 'حذف کریں')}
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                    tableBody.innerHTML += row;
                });

                showNotification(getTranslation('✅ تم تحميل ', '✅ Loaded ', '✅ لوڈ ہو گیا ') + filteredData.length + getTranslation(' طلب', ' applications', ' درخواستیں'), 'success');

            } catch (error) {
                console.error('Error loading data:', error);
                let errorMessage = getTranslation('❌ حدث خطأ أثناء تحميل البيانات', '❌ Error loading data', '❌ ڈیٹا لوڈ کرنے میں خرابی');
                
                if (error.code === 'permission-denied') {
                    errorMessage = getTranslation('❌ ليس لديك صلاحية لقراءة البيانات', '❌ Permission denied to read data', '❌ ڈیٹا پڑھنے کی اجازت نہیں ہے');
                }
                
                showNotification(errorMessage, 'error');
                tableBody.innerHTML = '<tr><td colspan="10" class="text-center">' + getTranslation('حدث خطأ في تحميل البيانات', 'Error loading data', 'ڈیٹا لوڈ کرنے میں خرابی') + '</td></tr>';
            } finally {
                loadBtn.innerHTML = originalText;
                loadBtn.disabled = false;
            }
        }

        async function loadAdvanceRequests() {
            if (!systemState.firebaseReady) {
                showNotification(getTranslation('⏳ جاري الاتصال بقاعدة البيانات...', '⏳ Connecting to database...', '⏳ ڈیٹا بیس سے منسلک ہو رہا ہے...'), 'warning');
                return;
            }

            const loadBtn = document.getElementById('loadAdvanceDataBtn');
            const originalText = loadBtn.innerHTML;
            const tableBody = document.getElementById('advanceRequestsTableBody');
            
            try {
                loadBtn.innerHTML = '<div class="loading"></div> ' + getTranslation('جاري التحميل...', 'Loading...', 'لوڈ ہو رہا ہے...');
                loadBtn.disabled = true;
                tableBody.innerHTML = '<tr><td colspan="10" class="text-center">' + getTranslation('جاري تحميل البيانات...', 'Loading data...', 'ڈیٹا لوڈ ہو رہا ہے...') + '</td></tr>';

                const filterEmployeeName = document.getElementById('filterEmployeeName').value.toLowerCase();
                const filterAdvanceDate = document.getElementById('filterAdvanceDate').value;

                const q = window.firestoreFunctions.query(
                    window.firestoreFunctions.collection(window.db, "advanceRequests"),
                    window.firestoreFunctions.orderBy("timestamp", "desc")
                );
                
                const querySnapshot = await window.firestoreFunctions.getDocs(q);
                const advanceRequestsData = [];

                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    data.id = doc.id;
                    advanceRequestsData.push(data);
                });

                const filteredData = advanceRequestsData.filter(item => {
                    const matchName = !filterEmployeeName || (item.employeeName && item.employeeName.toLowerCase().includes(filterEmployeeName));
                    const matchDate = !filterAdvanceDate || item.date === filterAdvanceDate;
                    return matchName && matchDate;
                });

                tableBody.innerHTML = '';

                if (filteredData.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="10" class="text-center">' + getTranslation('لا توجد بيانات مطابقة', 'No matching data found', 'کوئی مماثل ڈیٹا نہیں ملا') + '</td></tr>';
                    return;
                }

                filteredData.forEach(item => {
                    const statusBadge = item.status === 'approved' ? 
                        '<span class="status-badge status-active">' + getTranslation('موافق', 'Approved', 'منظور') + '</span>' :
                        '<span class="status-badge" style="background: #fed7d7; color: #c53030;">' + getTranslation('معلق', 'Pending', 'زیر التواء') + '</span>';
                    
                    const row = `
                        <tr data-id="${item.id}">
                            <td>${item.employeeName || '-'}</td>
                            <td>${item.project || '-'}</td>
                            <td>${item.residenceNumber || '-'}</td>
                            <td>${item.vehicleType || '-'}</td>
                            <td>${item.motorcyclePlate || '-'}</td>
                            <td>${item.carPlate || '-'}</td>
                            <td>${item.amount || '-'} ${getTranslation('ريال', 'SAR', 'ریال')}</td>
                            <td>${item.date || '-'}</td>
                            <td>${statusBadge}</td>
                            <td>
                                <div class="btn-group">
                                    <button class="btn btn-success btn-small" onclick="approveAdvanceRequest('${item.id}')">
                                        <i class="fas fa-check"></i> ${getTranslation('موافقة', 'Approve', 'منظوری')}
                                    </button>
                                    <button class="btn btn-danger btn-small" onclick="deleteAdvanceRequest('${item.id}')">
                                        <i class="fas fa-trash"></i> ${getTranslation('حذف', 'Delete', 'حذف کریں')}
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                    tableBody.innerHTML += row;
                });

                showNotification(getTranslation('✅ تم تحميل ', '✅ Loaded ', '✅ لوڈ ہو گیا ') + filteredData.length + getTranslation(' طلب سلفية', ' advance requests', ' ایڈوانس کی درخواستیں'), 'success');

            } catch (error) {
                console.error('Error loading advance requests:', error);
                let errorMessage = getTranslation('❌ حدث خطأ أثناء تحميل البيانات', '❌ Error loading data', '❌ ڈیٹا لوڈ کرنے میں خرابی');
                
                if (error.code === 'permission-denied') {
                    errorMessage = getTranslation('❌ ليس لديك صلاحية لقراءة البيانات', '❌ Permission denied to read data', '❌ ڈیٹا پڑھنے کی اجازت نہیں ہے');
                }
                
                showNotification(errorMessage, 'error');
                tableBody.innerHTML = '<tr><td colspan="10" class="text-center">' + getTranslation('حدث خطأ في تحميل البيانات', 'Error loading data', 'ڈیٹا لوڈ کرنے میں خرابی') + '</td></tr>';
            } finally {
                loadBtn.innerHTML = originalText;
                loadBtn.disabled = false;
            }
        }

        async function deleteApplication(applicationId) {
            if (!systemState.firebaseReady) {
                showNotification(getTranslation('⏳ جاري الاتصال بقاعدة البيانات...', '⏳ Connecting to database...', '⏳ ڈیٹا بیس سے منسلک ہو رہا ہے...'), 'warning');
                return;
            }

            if (!confirm(getTranslation('هل أنت متأكد من حذف هذا الطلب؟', 'Are you sure you want to delete this application?', 'کیا آپ واقعی اس درخواست کو حذف کرنا چاہتے ہیں؟'))) {
                return;
            }

            try {
                await window.firestoreFunctions.deleteDoc(
                    window.firestoreFunctions.doc(window.db, "jobApplications", applicationId)
                );
                
                showNotification(getTranslation('✅ تم حذف الطلب بنجاح', '✅ Application deleted successfully', '✅ درخواست کامیابی سے حذف ہو گئی'), 'success');
                loadJobApplications();
                
            } catch (error) {
                console.error('Error deleting application:', error);
                showNotification(getTranslation('❌ حدث خطأ أثناء حذف الطلب', '❌ Error deleting application', '❌ درخواست حذف کرنے میں خرابی'), 'error');
            }
        }

        async function deleteAdvanceRequest(advanceId) {
            if (!systemState.firebaseReady) {
                showNotification(getTranslation('⏳ جاري الاتصال بقاعدة البيانات...', '⏳ Connecting to database...', '⏳ ڈیٹا بیس سے منسلک ہو رہا ہے...'), 'warning');
                return;
            }

            if (!confirm(getTranslation('هل أنت متأكد من حذف طلب السلفية هذا؟', 'Are you sure you want to delete this advance request?', 'کیا آپ واقعی اس ایڈوانس کی درخواست کو حذف کرنا چاہتے ہیں؟'))) {
                return;
            }

            try {
                await window.firestoreFunctions.deleteDoc(
                    window.firestoreFunctions.doc(window.db, "advanceRequests", advanceId)
                );
                
                showNotification(getTranslation('✅ تم حذف طلب السلفية بنجاح', '✅ Advance request deleted successfully', '✅ ایڈوانس کی درخواست کامیابی سے حذف ہو گئی'), 'success');
                loadAdvanceRequests();
                
            } catch (error) {
                console.error('Error deleting advance request:', error);
                showNotification(getTranslation('❌ حدث خطأ أثناء حذف طلب السلفية', '❌ Error deleting advance request', '❌ ایڈوانس کی درخواست حذف کرنے میں خرابی'), 'error');
            }
        }

        async function approveAdvanceRequest(advanceId) {
            if (!systemState.firebaseReady) {
                showNotification(getTranslation('⏳ جاري الاتصال بقاعدة البيانات...', '⏳ Connecting to database...', '⏳ ڈیٹا بیس سے منسلک ہو رہا ہے...'), 'warning');
                return;
            }

            if (!confirm(getTranslation('هل تريد الموافقة على طلب السلفية هذا؟', 'Do you want to approve this advance request?', 'کیا آپ اس ایڈوانس کی درخواست کو منظور کرنا چاہتے ہیں؟'))) {
                return;
            }

            try {
                await window.firestoreFunctions.updateDoc(
                    window.firestoreFunctions.doc(window.db, "advanceRequests", advanceId),
                    { status: "approved" }
                );
                
                showNotification(getTranslation('✅ تمت الموافقة على طلب السلفية', '✅ Advance request approved', '✅ ایڈوانس کی درخواست منظور ہو گئی'), 'success');
                loadAdvanceRequests();
                
            } catch (error) {
                console.error('Error approving advance request:', error);
                showNotification(getTranslation('❌ حدث خطأ أثناء الموافقة على طلب السلفية', '❌ Error approving advance request', '❌ ایڈوانس کی درخواست منظور کرنے میں خرابی'), 'error');
            }
        }

        function exportJobApplicationsToExcel() {
            try {
                const table = document.getElementById('jobApplicationsTable');
                const workbook = XLSX.utils.table_to_book(table, {sheet: "طلبات التوظيف"});
                XLSX.writeFile(workbook, "job_applications.xlsx");
                showNotification(getTranslation('✅ تم تحميل ملف Excel بنجاح', '✅ Excel file downloaded successfully', '✅ ایکسل فائل کامیابی سے ڈاؤن لوڈ ہو گئی'), 'success');
            } catch (error) {
                console.error('Error exporting to Excel:', error);
                showNotification(getTranslation('❌ حدث خطأ أثناء التصدير', '❌ Error exporting to Excel', '❌ ایکسل میں برآمد کرنے میں خرابی'), 'error');
            }
        }

        function exportAdvanceRequestsToExcel() {
            try {
                const table = document.getElementById('advanceRequestsTable');
                const workbook = XLSX.utils.table_to_book(table, {sheet: "طلبات السلفيات"});
                XLSX.writeFile(workbook, "advance_requests.xlsx");
                showNotification(getTranslation('✅ تم تحميل ملف Excel بنجاح', '✅ Excel file downloaded successfully', '✅ ایکسل فائل کامیابی سے ڈاؤن لوڈ ہو گئی'), 'success');
            } catch (error) {
                console.error('Error exporting to Excel:', error);
                showNotification(getTranslation('❌ حدث خطأ أثناء التصدير', '❌ Error exporting to Excel', '❌ ایکسل میں برآمد کرنے میں خرابی'), 'error');
            }
        }

        // دالة التحويل بين اللغات
        function toggleLanguage() {
            const body = document.body;
            const langToggle = document.getElementById('langText');
            
            if (body.classList.contains('lang-ar')) {
                body.classList.remove('lang-ar');
                body.classList.add('lang-en');
                langToggle.textContent = 'AR';
                document.documentElement.dir = 'ltr';
                document.documentElement.lang = 'en';
                updateLanguage('en');
            } else if (body.classList.contains('lang-en')) {
                body.classList.remove('lang-en');
                body.classList.add('lang-ur');
                langToggle.textContent = 'EN';
                document.documentElement.dir = 'rtl';
                document.documentElement.lang = 'ur';
                updateLanguage('ur');
            } else {
                body.classList.remove('lang-ur');
                body.classList.add('lang-ar');
                langToggle.textContent = 'UR';
                document.documentElement.dir = 'rtl';
                document.documentElement.lang = 'ar';
                updateLanguage('ar');
            }

            if (document.getElementById('supervisorDashboard').style.display === 'block') {
                if (document.getElementById('jobApplicationsSection').style.display !== 'none') {
                    loadJobApplications();
                } else if (document.getElementById('advanceRequestsSection').style.display !== 'none') {
                    loadAdvanceRequests();
                }
            }
        }

        function updateLanguage(lang) {
            document.querySelectorAll('[data-ar], [data-en], [data-ur]').forEach(element => {
                if (element.hasAttribute(`data-${lang}`)) {
                    if (element.tagName === 'INPUT' && element.hasAttribute('data-ar-placeholder')) {
                        element.placeholder = element.getAttribute(`data-${lang}-placeholder`);
                    } else {
                        element.textContent = element.getAttribute(`data-${lang}`);
                    }
                }
            });

            document.querySelectorAll('input[type="date"]').forEach(input => {
                input.style.direction = lang === 'ar' || lang === 'ur' ? 'rtl' : 'ltr';
            });
        }

        function getTranslation(ar, en, ur) {
            const body = document.body;
            if (body.classList.contains('lang-ar')) return ar;
            if (body.classList.contains('lang-en')) return en;
            if (body.classList.contains('lang-ur')) return ur;
            return ar;
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                ${document.body.classList.contains('lang-ar') || document.body.classList.contains('lang-ur') ? 'left: 20px' : 'right: 20px'};
                padding: 15px 25px;
                border-radius: 8px;
                color: white;
                font-weight: 600;
                z-index: 10000;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                transition: all 0.3s ease;
                max-width: 400px;
            `;

            const colors = {
                success: '#38a169',
                error: '#e53e3e',
                info: '#3182ce',
                warning: '#d69e2e'
            };

            notification.style.background = colors[type] || colors.info;
            notification.textContent = message;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateY(-20px)';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 5000);
        }

        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('jobForm').addEventListener('submit', submitJobApplication);
            document.getElementById('advanceRequestForm').addEventListener('submit', submitAdvanceRequest);
            updateLanguage('ar');
            setTimeout(() => {
                if (!systemState.firebaseReady) {
                    showNotification(getTranslation('⚠️ جاري الاتصال بقاعدة البيانات...', '⚠️ Connecting to database...', '⚠️ ڈیٹا بیس سے منسلک ہو رہا ہے...'), 'warning');
                }
            }, 2000);
            showNotification(getTranslation('مرحباً بك في نظام توظيف الزهراني', 'Welcome to Al-Zahrani Employment System', 'الزہرانی ملازمت کے نظام میں خوش آمدید'), 'info');
        });
    </script>
</body>
</html>
