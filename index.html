<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام التوظيف - Al-Zahrani</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    
    <!-- إضافة Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, query, orderBy, doc, deleteDoc, getDoc, updateDoc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCWQ2q1HU_LLQKkp2KRlOZ1FdF0bI6jBbM",
            authDomain: "zahrani-bc3ae.firebaseapp.com",
            projectId: "zahrani-bc3ae",
            storageBucket: "zahrani-bc3ae.firebasestorage.app",
            messagingSenderId: "405206070457",
            appId: "1:405206070457:web:fedf4204571d910030d768"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.db = db;
        window.firestoreFunctions = { collection, addDoc, getDocs, query, orderBy, doc, deleteDoc, getDoc, updateDoc, setDoc, serverTimestamp };

        console.log("✅ Firebase initialized successfully");
        window.firebaseReady = true;
        if (window.onFirebaseReady) window.onFirebaseReady();
    </script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', 'Tajawal', sans-serif; }
        :root {
            --primary: #1a365d; --secondary: #2d3748; --accent: #3182ce; --success: #38a169;
            --warning: #d69e2e; --danger: #e53e3e; --light: #f7fafc; --dark: #2d3748;
            --gradient: linear-gradient(135deg, #1a365d 0%, #2d3748 100%);
        }
        
        /* إضافة الخلفية الجديدة */
        body { 
            background: linear-gradient(rgba(255, 255, 255, 0.85), rgba(255, 255, 255, 0.85)), 
                        url('https://i.ibb.co/0Q6qW8g/background.jpg') no-repeat center center fixed;
            background-size: cover;
            min-height: 100vh; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            padding: 20px; 
            position: relative;
        }
        
        /* طبقة شفافة فوق الخلفية */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.7);
            z-index: -1;
        }
        
        .container { 
            width: 100%; 
            max-width: 1400px; 
            position: relative;
            z-index: 1;
        }
        
        .header { 
            background: var(--gradient); 
            color: white; 
            padding: 25px; 
            border-radius: 20px; 
            text-align: center; 
            margin-bottom: 30px; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.15); 
            position: relative; 
            overflow: hidden; 
        }
        .header::before { 
            content: ''; 
            position: absolute; 
            top: 0; 
            left: 0; 
            right: 0; 
            height: 5px; 
            background: linear-gradient(90deg, var(--accent), var(--success)); 
        }
        .video-container { 
            width: 100%; 
            max-width: 900px; 
            margin: 0 auto 25px; 
            border-radius: 15px; 
            overflow: hidden; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border: 3px solid rgba(255,255,255,0.3);
        }
        .video-container video { 
            width: 100%; 
            height: auto; 
            display: block; 
            max-height: 500px;
            object-fit: cover;
        }
        .main-title { font-size: 2.8rem; margin-bottom: 15px; font-weight: 800; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .sub-title { font-size: 1.4rem; opacity: 0.95; font-weight: 500; }
        
        .nav-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 30px; margin-bottom: 40px; }
        .nav-card { background: white; padding: 35px; border-radius: 20px; box-shadow: 0 8px 25px rgba(0,0,0,0.1); text-align: center; transition: all 0.4s ease; cursor: pointer; border: 2px solid transparent; position: relative; overflow: hidden; }
        .nav-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 5px; background: var(--accent); transform: scaleX(0); transition: transform 0.4s ease; }
        .nav-card:hover { transform: translateY(-8px); box-shadow: 0 20px 40px rgba(0,0,0,0.2); border-color: var(--accent); }
        .nav-card:hover::before { transform: scaleX(1); }
        .nav-icon { font-size: 4rem; color: var(--accent); margin-bottom: 25px; }
        .nav-title { font-size: 1.8rem; color: var(--primary); margin-bottom: 20px; font-weight: 700; }
        .nav-description { color: var(--secondary); line-height: 1.7; font-size: 1.1rem; }
        
        .form-container { background: white; padding: 35px; border-radius: 20px; box-shadow: 0 8px 25px rgba(0,0,0,0.1); margin-bottom: 30px; display: none; }
        .form-title { color: var(--primary); font-size: 2.2rem; margin-bottom: 30px; text-align: center; font-weight: 700; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; margin-bottom: 30px; }
        .form-group { margin-bottom: 25px; }
        .form-label { display: block; margin-bottom: 10px; font-weight: 700; color: var(--dark); font-size: 1.1rem; }
        .form-input, .form-select, .form-textarea { width: 100%; padding: 15px 18px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 16px; transition: all 0.3s ease; background: white; }
        .form-input:focus, .form-select:focus, .form-textarea:focus { border-color: var(--accent); outline: none; box-shadow: 0 0 0 4px rgba(49, 130, 206, 0.15); }
        .form-textarea { resize: vertical; min-height: 120px; }
        
        .image-preview { margin-top: 12px; text-align: center; }
        .image-preview img { max-width: 250px; max-height: 180px; border-radius: 10px; border: 2px solid #e2e8f0; }
        .remove-image { margin-top: 8px; background: var(--danger); color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-size: 13px; }
        
        .btn { padding: 15px 35px; border: none; border-radius: 10px; font-size: 17px; font-weight: 700; cursor: pointer; transition: all 0.3s ease; display: inline-flex; align-items: center; justify-content: center; gap: 10px; }
        .btn-primary { background: var(--accent); color: white; }
        .btn-primary:hover { background: #2c5aa0; transform: translateY(-3px); box-shadow: 0 8px 20px rgba(49, 130, 206, 0.4); }
        .btn-secondary { background: var(--secondary); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-warning { background: var(--warning); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-info { background: #4299e1; color: white; }
        .btn-full { width: 100%; }
        .btn-group { display: flex; gap: 12px; margin-top: 25px; flex-wrap: wrap; }
        .btn-small { padding: 10px 18px; font-size: 15px; }
        
        .table-container { background: white; border-radius: 20px; box-shadow: 0 8px 25px rgba(0,0,0,0.1); overflow: hidden; margin-bottom: 30px; }
        .table-header { background: var(--gradient); color: white; padding: 25px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px; }
        .table-title { font-size: 1.8rem; font-weight: 700; }
        .filters { display: flex; gap: 20px; flex-wrap: wrap; }
        .filter-group { display: flex; flex-direction: column; gap: 8px; }
        .filter-label { font-size: 1rem; opacity: 0.95; }
        .data-table { width: 100%; border-collapse: collapse; }
        .data-table th { background: #f7fafc; padding: 18px; text-align: right; font-weight: 700; color: var(--dark); border-bottom: 3px solid #e2e8f0; font-size: 1.05rem; }
        .data-table td { padding: 18px; border-bottom: 2px solid #e2e8f0; text-align: right; }
        .data-table tr:hover { background: #f7fafc; }
        .status-badge { padding: 8px 16px; border-radius: 25px; font-size: 0.9rem; font-weight: 700; }
        .status-active { background: #c6f6d5; color: #22543d; }
        .status-expired { background: #fed7d7; color: #c53030; }
        .status-warning { background: #fefcbf; color: #744210; }
        
        .login-container { background: white; padding: 45px; border-radius: 20px; box-shadow: 0 8px 25px rgba(0,0,0,0.1); max-width: 450px; margin: 0 auto; display: none; }
        .login-title { color: var(--primary); font-size: 2.2rem; margin-bottom: 35px; text-align: center; font-weight: 700; }
        
        .lang-toggle { position: fixed; top: 25px; left: 25px; background: var(--accent); color: white; border: none; padding: 12px 18px; border-radius: 10px; cursor: pointer; font-weight: 700; z-index: 1000; box-shadow: 0 5px 15px rgba(0,0,0,0.2); display: flex; align-items: center; gap: 10px; font-size: 1rem; }
        
        .loading { display: inline-block; width: 24px; height: 24px; border: 3px solid #ffffff; border-radius: 50%; border-top-color: transparent; animation: spin 1s ease-in-out infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .hidden { display: none; }
        .text-center { text-align: center; }
        .mt-20 { margin-top: 20px; }
        
        .job-announcement { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 35px; border-radius: 20px; margin-bottom: 30px; box-shadow: 0 15px 35px rgba(0,0,0,0.15); text-align: center; }
        .job-announcement h2 { font-size: 2.5rem; margin-bottom: 25px; font-weight: 800; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .job-announcement h3 { font-size: 1.8rem; margin: 25px 0 20px; font-weight: 700; }
        .job-announcement p { font-size: 1.3rem; margin-bottom: 20px; line-height: 1.8; font-weight: 500; }
        .job-announcement ul { text-align: right; margin: 25px 0; padding-right: 25px; }
        .job-announcement li { margin-bottom: 15px; font-size: 1.2rem; line-height: 1.7; }
        
        .success-message { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 30px; border-radius: 20px; margin-top: 30px; text-align: center; display: none; }
        
        .expiry-warning { color: var(--warning); font-size: 1rem; margin-top: 8px; display: none; }
        .expiry-info { color: var(--accent); font-size: 1rem; margin-top: 8px; display: none; }
        
        /* تنسيقات التحقق */
        .verification-container { background: white; padding: 45px; border-radius: 20px; box-shadow: 0 8px 25px rgba(0,0,0,0.1); max-width: 450px; margin: 0 auto; display: none; }
        .verification-title { color: var(--primary); font-size: 2.2rem; margin-bottom: 35px; text-align: center; font-weight: 700; }
        
        /* تنسيقات البروفايل */
        .profile-header { background: var(--gradient); color: white; padding: 35px; border-radius: 20px; margin-bottom: 30px; display: flex; align-items: center; gap: 25px; }
        .profile-image { width: 120px; height: 120px; border-radius: 50%; border: 4px solid white; object-fit: cover; }
        .profile-info { flex: 1; }
        .profile-name { font-size: 2.2rem; font-weight: 800; margin-bottom: 8px; }
        .profile-role { font-size: 1.3rem; opacity: 0.95; }
        
        /* تنسيقات OTP */
        .otp-input { text-align: center; font-size: 1.8rem; font-weight: bold; letter-spacing: 10px; padding: 20px; }
        .otp-message { background: #e6fffa; border: 2px solid #38a169; color: #22543d; padding: 20px; border-radius: 10px; margin: 25px 0; text-align: center; font-weight: 700; font-size: 1.1rem; }
        
        /* تنسيقات التنقل في لوحة المشرف */
        .supervisor-nav { display: flex; gap: 15px; margin-bottom: 25px; flex-wrap: wrap; }
        .supervisor-nav-btn { flex: 1; min-width: 220px; }
        
        /* تنسيقات جديدة للمشرفين */
        .admin-section { display: none; }
        .admin-card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .admin-card-title { font-size: 1.5rem; color: var(--primary); margin-bottom: 15px; font-weight: 700; }
        .permissions-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin-top: 15px; }
        .permission-item { display: flex; align-items: center; gap: 10px; }
        .permission-checkbox { width: 20px; height: 20px; }
        
        /* تنسيقات الإشعارات */
        .notification-container { position: fixed; top: 20px; right: 20px; z-index: 10000; max-width: 400px; }
        .notification { background: white; padding: 15px 20px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); margin-bottom: 10px; border-right: 5px solid var(--accent); display: flex; align-items: center; gap: 15px; animation: slideIn 0.3s ease; }
        .notification-icon { font-size: 1.5rem; }
        .notification-success { border-right-color: var(--success); }
        .notification-warning { border-right-color: var(--warning); }
        .notification-error { border-right-color: var(--danger); }
        .notification-info { border-right-color: var(--accent); }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        
        /* تنسيقات قسم المناديب */
        .representatives-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
        .representative-card { background: white; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); overflow: hidden; transition: transform 0.3s ease; }
        .representative-card:hover { transform: translateY(-5px); }
        .representative-header { background: var(--gradient); color: white; padding: 20px; }
        .representative-name { font-size: 1.4rem; font-weight: 700; margin-bottom: 5px; }
        .representative-id { font-size: 1rem; opacity: 0.9; }
        .representative-body { padding: 20px; }
        .representative-detail { display: flex; justify-content: space-between; margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #e2e8f0; }
        .detail-label { font-weight: 600; color: var(--dark); }
        .detail-value { color: var(--secondary); }
        
        /* تنسيقات متقدمة للبحث */
        .search-container { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .search-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        
        @media (max-width: 768px) {
            .nav-cards, .form-grid { grid-template-columns: 1fr; }
            .table-header { flex-direction: column; align-items: stretch; }
            .filters { flex-direction: column; }
            .data-table { font-size: 0.95rem; }
            .data-table th, .data-table td { padding: 12px 10px; }
            .btn-group { flex-direction: column; }
            .job-announcement h2 { font-size: 2rem; }
            .job-announcement h3 { font-size: 1.5rem; }
            .job-announcement p, .job-announcement li { font-size: 1.1rem; }
            .profile-header { flex-direction: column; text-align: center; }
            .supervisor-nav { flex-direction: column; }
            .video-container { max-width: 100%; }
            .main-title { font-size: 2.2rem; }
            .sub-title { font-size: 1.2rem; }
            .notification-container { left: 20px; right: 20px; max-width: none; }
            .representatives-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body class="lang-ar">
    <button class="lang-toggle" onclick="toggleLanguage()">
        <i class="fas fa-globe"></i>
        <span id="langText">EN</span>
    </button>

    <div class="container">
        <div class="header">
            <div class="video-container">
                <video autoplay muted loop playsinline>
                    <source src="https://res.cloudinary.com/dfgp8dwj3/video/upload/v1761726342/%D8%A7%D9%84%D8%B2%D9%87%D8%B1%D8%A7%D9%86%D9%8A_1_p6ydli.mp4" type="video/mp4">
                    متصفحك لا يدعم تشغيل الفيديو
                </video>
            </div>
            <h1 class="main-title" data-ar="نظام التوظيف" data-en="Employment System" data-ur="ملازمت کا نظام">نظام التوظيف</h1>
            <p class="sub-title" data-ar="Al-Zahrani Logistics - نظام التوظيف" data-en="Al-Zahrani Logistics - Employment System" data-ur="الزہرانی لوجسٹکس - ملازمت کا نظام">Al-Zahrani Logistics - نظام التوظيف</p>
        </div>

        <div class="nav-cards">
            <div class="nav-card" onclick="showJobApplicationForm()">
                <div class="nav-icon"><i class="fas fa-user-tie"></i></div>
                <h3 class="nav-title" data-ar="تقديم طلب توظيف" data-en="Submit Job Application" data-ur="درخواست جمع کروائیں">تقديم طلب توظيف</h3>
                <p class="nav-description" data-ar="تقديم طلب توظيف لوظيفة مندوب توصيل" data-en="Submit job application for delivery representative" data-ur="ڈیلیوری نمائندے کے لیے درخواست جمع کروائیں">تقديم طلب توظيف لوظيفة مندوب توصيل</p>
            </div>

            <div class="nav-card" onclick="showSupervisorLogin()">
                <div class="nav-icon"><i class="fas fa-user-shield"></i></div>
                <h3 class="nav-title" data-ar="دخول المشرف" data-en="Supervisor Login" data-ur="سپروائزر لاگ ان">دخول المشرف</h3>
                <p class="nav-description" data-ar="إدارة طلبات التوظيف وعرض التقارير" data-en="Manage job applications and view reports" data-ur="ملازمت کی درخواستیں منظم کریں اور رپورٹس دیکھیں">إدارة طلبات التوظيف وعرض التقارير</p>
            </div>
        </div>

        <!-- Job Announcement -->
        <div id="jobAnnouncement" class="job-announcement">
            <h2 data-ar="🚀 فرصة عمل مميزة في شركة الزهراني للخدمات اللوجستية 🏍️" data-en="🚀 Great Job Opportunity at Al-Zahrani Logistics Company 🏍️" data-ur="🚀 الزہرانی لوجسٹکس کمپنی میں بہترین ملازمت کا موقع 🏍️">🚀 فرصة عمل مميزة في شركة الزهراني للخدمات اللوجستية 🏍️</h2>
            <p data-ar="تُعلن شركة الزهراني للخدمات اللوجستية عن فتح باب التوظيف لوظيفة مندوب توصيل (دباب نينجا - استور) ضمن فريق ميداني نشط بالمملكة. نبحث عن شباب طموحين وجادين يمتلكون روح الالتزام والمسؤولية ويحبون العمل الميداني والإنجاز السريع." data-en="Al-Zahrani Logistics Company announces the opening of employment for the position of delivery representative (Ninja Motorcycle - Store) within an active field team in the Kingdom. We are looking for ambitious and serious young people who have a spirit of commitment and responsibility and love field work and quick achievement." data-ur="الزہرانی لوجسٹکس کمپنی مملکت میں ایک فعال فیلڈ ٹیم کے اندر ڈیلیوری نمائندے (ننجا موٹرسائیکل - اسٹور) کی پوزیشن کے لیے ملازمت کے دروازے کھولنے کا اعلان کرتی ہے۔ ہم پرعزم اور سنجیدہ نوجوانوں کی تلاش میں ہیں جن میں وابستگی اور ذمہ داری کا جذبہ ہو اور فیلڈ ورک اور فوری کامیابی سے محبت ہو۔">تُعلن شركة الزهراني للخدمات اللوجستية عن فتح باب التوظيف لوظيفة مندوب توصيل (دباب نينجا - استور) ضمن فريق ميداني نشط بالمملكة. نبحث عن شباب طموحين وجادين يمتلكون روح الالتزام والمسؤولية ويحبون العمل الميداني والإنجاز السريع.</p>
            
            <h3 data-ar="تفاصيل الوظيفة" data-en="Job Details" data-ur="ملازمت کی تفصیلات">تفاصيل الوظيفة</h3>
            <ul>
                <li data-ar="المسمى الوظيفي: مندوب توصيل (دباب نينجا - استور)" data-en="Job Title: Delivery Representative (Ninja Motorcycle - Store)" data-ur="ملازمت کا عنوان: ڈیلیوری نمائندہ (ننجا موٹرسائیکل - اسٹور)">المسمى الوظيفي: مندوب توصيل (دباب نينجا - استور)</li>
                <li data-ar="الراتب الشهري: 2300 ريال" data-en="Monthly Salary: 2300 SAR" data-ur="ماہانہ تنخواہ: 2300 ریال">الراتب الشهري: 2300 ريال</li>
                <li data-ar="ساعات الدوام: 10 ساعة يوميًا (اي ساعة اضافية أوفر تايم)" data-en="Working Hours: 10 hours daily (any extra hour is overtime)" data-ur="کام کے اوقات: روزانہ 10 گھنٹے (کوئی بھی اضافی گھنٹہ اوور ٹائم ہے)">ساعات الدوام: 10 ساعة يوميًا (اي ساعة اضافية أوفر تايم)</li>
                <li data-ar="الشركة توفر الدباب والوقود" data-en="The company provides the motorcycle and fuel" data-ur="کمپنی موٹرسائیکل اور ایندھن مہیا کرتی ہے">الشركة توفر الدباب والوقود</li>
                <li data-ar="نقل كفالة بعد شهرين من بدء العمل" data-en="Sponsorship transfer after two months of work" data-ur="کام شروع کرنے کے دو ماہ بعد کفالت کی منتقلی">نقل كفالة بعد شهرين من بدء العمل</li>
                <li data-ar="المكافآت الإضافية - بونس" data-en="Additional rewards - Bonus" data-ur="اضافی انعامات - بونس">المكافآت الإضافية - بونس</li>
            </ul>
            
            <h3 data-ar="الشروط المطلوبة" data-en="Required Conditions" data-ur="مطلوبہ شرائط">الشروط المطلوبة</h3>
            <ul>
                <li data-ar="إقامة سارية المفعول" data-en="Valid residence permit" data-ur="درست رہائشی اجازت">إقامة سارية المفعول</li>
                <li data-ar="رخصة قيادة دباب سارية" data-en="Valid motorcycle driving license" data-ur="درست موٹرسائیکل ڈرائیونگ لائسنس">رخصة قيادة دباب سارية</li>
                <li data-ar="الجدية والانضباط في العمل" data-en="Seriousness and discipline at work" data-ur="کام میں سنجیدگی اور نظم و ضبط">الجدية والانضباط في العمل</li>
            </ul>
            
            <h3 data-ar="المزايا" data-en="Advantages" data-ur="فوائد">المزايا</h3>
            <ul>
                <li data-ar="بيئة عمل منظمة وداعمة" data-en="Organized and supportive work environment" data-ur="منظم اور معاون کام کا ماحول">بيئة عمل منظمة وداعمة</li>
                <li data-ar="فرصة للاستقرار الوظيفي ونقل الكفالة" data-en="Opportunity for job stability and sponsorship transfer" data-ur="ملازمت کے استحکام اور کفالت کی منتقلی کا موقع">فرصة للاستقرار الوظيفي ونقل الكفالة</li>
                <li data-ar="دعم ومتابعة ميدانية مستمرة" data-en="Continuous field support and follow-up" data-ur="مسلسل فیلڈ سپورٹ اور فالو اپ">دعم ومتابعة ميدانية مستمرة</li>
                <li data-ar="مكان العمل: الشرقية – الدمام" data-en="Work Location: Eastern Province - Dammam" data-ur="کام کی جگہ: مشرقی صوبہ - دمام">مكان العمل: الشرقية – الدمام</li>
            </ul>
        </div>

        <!-- Job Application Form -->
        <div id="jobApplicationForm" class="form-container">
            <h2 class="form-title" data-ar="طلب توظيف جديد" data-en="New Job Application" data-ur="نیا ملازمت کا درخواست فارم">طلب توظيف جديد</h2>
            <form id="jobForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label" data-ar="الاسم الكامل" data-en="Full Name" data-ur="پورا نام">الاسم الكامل</label>
                        <input type="text" class="form-input" id="fullName" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label" data-ar="رقم الجوال" data-en="Phone Number" data-ur="فون نمبر">رقم الجوال</label>
                        <input type="tel" class="form-input" id="phoneNumber" required>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label" data-ar="نوع المركبة" data-en="Vehicle Type" data-ur="گاڑی کی قسم">نوع المركبة</label>
                        <select class="form-select" id="vehicleType" required onchange="toggleLicensePlateField()">
                            <option value="" data-ar="اختر نوع المركبة" data-en="Select Vehicle Type" data-ur="گاڑی کی قسم منتخب کریں">اختر نوع المركبة</option>
                            <option value="دباب" data-ar="دباب" data-en="Motorcycle" data-ur="موٹرسائیکل">دباب</option>
                            <option value="سيارة" data-ar="سيارة" data-en="Car" data-ur="کار">سيارة</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label" data-ar="رقم لوحة المركبة" data-en="Vehicle Plate Number" data-ur="گاڑی کی پلیٹ نمبر">رقم لوحة المركبة</label>
                        <input type="text" class="form-input" id="vehiclePlate" required>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label" data-ar="تاريخ انتهاء الإقامة" data-en="Residence Expiry Date" data-ur="رہائشی کی میعاد ختم ہونے کی تاریخ">تاريخ انتهاء الإقامة</label>
                        <input type="date" class="form-input" id="residenceExpiry" required onchange="checkExpiry(this, 'residence')">
                        <div class="expiry-info" id="residenceInfo" data-ar="⚠️ يمكن تقديم الطلب حتى مع انتهاء الإقامة" data-en="⚠️ Application can be submitted even with expired residence" data-ur="⚠️ درخواست رہائشی ختم ہونے کے باوجود بھی جمع کرائی جا سکتی ہے">⚠️ يمكن تقديم الطلب حتى مع انتهاء الإقامة</div>
                        <div class="expiry-warning" id="residenceWarning" data-ar="⚠️ إقامتك منتهية - يمكنك تقديم الطلب" data-en="⚠️ Your residence is expired - You can still submit the application" data-ur="⚠️ آپ کی رہائش ختم ہو گئی ہے - آپ پھر بھی درخواست جمع کروا سکتے ہیں">⚠️ إقامتك منتهية - يمكنك تقديم الطلب</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" data-ar="تاريخ انتهاء الرخصة" data-en="License Expiry Date" data-ur="لائسنس کی میعاد ختم ہونے کی تاریخ">تاريخ انتهاء الرخصة</label>
                        <input type="date" class="form-input" id="licenseExpiry" required onchange="checkExpiry(this, 'license')">
                        <div class="expiry-warning" id="licenseWarning" data-ar="❌ رخصتك منتهية - لا يمكن تقديم الطلب" data-en="❌ Your license is expired - Cannot submit application" data-ur="❌ آپ کا لائسنس ختم ہو گیا ہے - درخواست جمع نہیں کرائی جا سکتی">❌ رخصتك منتهية - لا يمكن تقديم الطلب</div>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label" data-ar="صورة الإقامة" data-en="Residence Photo" data-ur="رہائشی کی تصویر">صورة الإقامة</label>
                        <input type="file" class="form-input" id="residencePhoto" accept="image/*" onchange="previewImage(this, 'residencePreview')" required>
                        <div class="image-preview" id="residencePreview"></div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" data-ar="صورة رخصة القيادة" data-en="Driving License Photo" data-ur="ڈرائیونگ لائسنس کی تصویر">صورة رخصة القيادة</label>
                        <input type="file" class="form-input" id="licensePhoto" accept="image/*" onchange="previewImage(this, 'licensePreview')" required>
                        <div class="image-preview" id="licensePreview"></div>
                    </div>
                </div>

                <div class="btn-group">
                    <button type="submit" class="btn btn-primary btn-full" id="submitBtn">
                        <i class="fas fa-paper-plane"></i>
                        <span data-ar="تقديم الطلب" data-en="Submit Application" data-ur="درخواست جمع کروائیں">تقديم الطلب</span>
                    </button>
                </div>
            </form>

            <div class="btn-group">
                <button class="btn btn-secondary btn-full" onclick="showHomePage()">
                    <i class="fas fa-arrow-right"></i>
                    <span data-ar="العودة للرئيسية" data-en="Back to Home" data-ur="ہوم پیج پر واپس جائیں">العودة للرئيسية</span>
                </button>
            </div>
        </div>

        <!-- Success Message -->
        <div id="successMessage" class="success-message">
            <h2 data-ar="شكراً لتقديمك للوظيفة!" data-en="Thank you for applying!" data-ur="درخواست دینے کا شکریہ!">شكراً لتقديمك للوظيفة!</h2>
            <p data-ar="سيتم التواصل معك خلال ساعة او اقل" data-en="We will contact you within an hour or less" data-ur="ہم ایک گھنٹے یا اس سے کم وقت میں آپ سے رابطہ کریں گے">سيتم التواصل معك خلال ساعة او اقل</p>
        </div>

        <!-- Supervisor Login -->
        <div id="supervisorLogin" class="login-container">
            <h2 class="login-title" data-ar="دخول المشرف" data-en="Supervisor Login" data-ur="سپروائزر لاگ ان">دخول المشرف</h2>
            <div class="form-group">
                <label class="form-label" data-ar="اسم المستخدم" data-en="Username" data-ur="صارف نام">اسم المستخدم</label>
                <input type="text" class="form-input" id="username" placeholder="أدخل اسم المستخدم">
            </div>

            <div class="form-group">
                <label class="form-label" data-ar="كلمة المرور" data-en="Password" data-ur="پاس ورڈ">كلمة المرور</label>
                <input type="password" class="form-input" id="password" placeholder="أدخل كلمة المرور">
            </div>

            <div class="btn-group">
                <button class="btn btn-primary btn-full" onclick="supervisorLogin()">
                    <i class="fas fa-sign-in-alt"></i>
                    <span data-ar="دخول" data-en="Login" data-ur="لاگ ان">دخول</span>
                </button>
            </div>

            <div class="btn-group">
                <button class="btn btn-secondary btn-full" onclick="showHomePage()">
                    <i class="fas fa-arrow-right"></i>
                    <span data-ar="العودة للرئيسية" data-en="Back to Home" data-ur="ہوم پیج پر واپس جائیں">العودة للرئيسية</span>
                </button>
            </div>
        </div>

        <!-- Verification Container -->
        <div id="verificationContainer" class="verification-container">
            <h2 class="verification-title" data-ar="التحقق من الهوية" data-en="Identity Verification" data-ur="شناختی تصدیق">التحقق من الهوية</h2>
            
            <div class="otp-message" id="otpMessage">
                <i class="fas fa-shield-alt"></i>
                <span data-ar="تم إرسال رمز التحقق إلى المشرف أحمد الصادق" data-en="Verification code has been sent to supervisor Ahmed Al-Sadiq" data-ur="تصدیقی کوڈ سپروائزر احمد الصادق کو بھیج دیا گیا ہے">تم إرسال رمز التحقق إلى المشرف أحمد الصادق</span>
            </div>

            <div class="form-group">
                <label class="form-label" data-ar="أدخل رمز التحقق (OTP)" data-en="Enter Verification Code (OTP)" data-ur="تصدیقی کوڈ درج کریں (OTP)">أدخل رمز التحقق (OTP)</label>
                <input type="password" class="form-input otp-input" id="otpCode" placeholder="●●●●●●" maxlength="6">
            </div>

            <div class="btn-group">
                <button class="btn btn-success btn-full" onclick="verifyOTP()">
                    <i class="fas fa-check-circle"></i>
                    <span data-ar="تحقق" data-en="Verify" data-ur="تصدیق کریں">تحقق</span>
                </button>
            </div>

            <div class="btn-group">
                <button class="btn btn-secondary btn-full" onclick="showSupervisorLogin()">
                    <i class="fas fa-arrow-right"></i>
                    <span data-ar="العودة لتسجيل الدخول" data-en="Back to Login" data-ur="لاگ ان پر واپس جائیں">العودة لتسجيل الدخول</span>
                </button>
            </div>
        </div>

        <!-- Supervisor Dashboard -->
        <div id="supervisorDashboard" class="form-container">
            <!-- Profile Header -->
            <div class="profile-header">
                <img src="https://i.ibb.co/vrKBxqC/profile.jpg" alt="Ahmed Al-Sadiq" class="profile-image">
                <div class="profile-info">
                    <h2 class="profile-name" id="currentSupervisorName">أحمد الصادق</h2>
                    <p class="profile-role" id="currentSupervisorRole" data-ar="مشرف نظام التوظيف" data-en="Employment System Supervisor" data-ur="ملازمت کے نظام کا سپروائزر">مشرف نظام التوظيف</p>
                </div>
                <button class="btn btn-danger" onclick="supervisorLogout()">
                    <i class="fas fa-sign-out-alt"></i>
                    <span data-ar="تسجيل الخروج" data-en="Logout" data-ur="لاگ آؤٹ">تسجيل الخروج</span>
                </button>
            </div>

            <!-- Supervisor Navigation -->
            <div class="supervisor-nav">
                <button class="btn btn-primary supervisor-nav-btn" onclick="showJobApplicationsSection()">
                    <i class="fas fa-users"></i>
                    <span data-ar="طلبات التوظيف" data-en="Job Applications" data-ur="ملازمت کی درخواستیں">طلبات التوظيف</span>
                </button>
                <button class="btn btn-success supervisor-nav-btn" onclick="showAdvanceRequestsSection()">
                    <i class="fas fa-hand-holding-usd"></i>
                    <span data-ar="طلبات السلفيات" data-en="Advance Requests" data-ur="ایڈوانس کی درخواستیں">طلبات السلفيات</span>
                </button>
                <button class="btn btn-info supervisor-nav-btn" onclick="showRepresentativesSection()">
                    <i class="fas fa-motorcycle"></i>
                    <span data-ar="المناديب" data-en="Representatives" data-ur="نمائندے">المناديب</span>
                </button>
                <button class="btn btn-warning supervisor-nav-btn" onclick="showAdminManagementSection()">
                    <i class="fas fa-user-cog"></i>
                    <span data-ar="إدارة المشرفين" data-en="Admin Management" data-ur="ایڈمن مینجمنٹ">إدارة المشرفين</span>
                </button>
                <button class="btn btn-secondary supervisor-nav-btn" onclick="showLoginReportsSection()">
                    <i class="fas fa-history"></i>
                    <span data-ar="تقارير الدخول" data-en="Login Reports" data-ur="لاگ ان رپورٹس">تقارير الدخول</span>
                </button>
            </div>

            <!-- Job Applications Section -->
            <div id="jobApplicationsSection">
                <div class="table-header">
                    <h2 class="table-title" data-ar="طلبات التوظيف المسجلة" data-en="Registered Job Applications" data-ur="رجسٹرڈ ملازمت کی درخواستیں">طلبات التوظيف المسجلة</h2>
                    <div class="filters">
                        <div class="filter-group">
                            <label class="filter-label" data-ar="اسم المتقدم" data-en="Applicant Name" data-ur="درخواست دہندہ کا نام">اسم المتقدم</label>
                            <input type="text" class="form-input" id="filterName" placeholder="بحث بالاسم">
                        </div>

                        <div class="filter-group">
                            <label class="filter-label" data-ar="التاريخ" data-en="Date" data-ur="تاریخ">التاريخ</label>
                            <input type="date" class="form-input" id="filterDate">
                        </div>

                        <div class="filter-group">
                            <label class="filter-label" data-ar="حالة الإقامة" data-en="Residence Status" data-ur="رہائشی کی حالت">حالة الإقامة</label>
                            <select class="form-select" id="filterResidenceStatus">
                                <option value="" data-ar="الكل" data-en="All" data-ur="سب">الكل</option>
                                <option value="active" data-ar="سارية" data-en="Active" data-ur="درست">سارية</option>
                                <option value="expired" data-ar="منتهية" data-en="Expired" data-ur="ختم">منتهية</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-success" onclick="loadJobApplications()" id="loadDataBtn">
                        <i class="fas fa-sync-alt"></i>
                        <span data-ar="عرض البيانات" data-en="Show Data" data-ur="ڈیٹا دکھائیں">عرض البيانات</span>
                    </button>
                    <button class="btn btn-primary" onclick="exportJobApplicationsToExcel()">
                        <i class="fas fa-file-excel"></i>
                        <span data-ar="تحميل Excel" data-en="Download Excel" data-ur="ایکسل ڈاؤن لوڈ کریں">تحميل Excel</span>
                    </button>
                </div>

                <div class="table-container mt-20">
                    <table class="data-table" id="jobApplicationsTable">
                        <thead>
                            <tr>
                                <th data-ar="الاسم" data-en="Name" data-ur="نام">الاسم</th>
                                <th data-ar="رقم الجوال" data-en="Phone" data-ur="فون">رقم الجوال</th>
                                <th data-ar="نوع المركبة" data-en="Vehicle Type" data-ur="گاڑی کی قسم">نوع المركبة</th>
                                <th data-ar="رقم اللوحة" data-en="Plate Number" data-ur="پلیٹ نمبر">رقم اللوحة</th>
                                <th data-ar="انتهاء الإقامة" data-en="Residence Expiry" data-ur="رہائشی کی میعاد">انتهاء الإقامة</th>
                                <th data-ar="حالة الإقامة" data-en="Residence Status" data-ur="رہائشی کی حالت">حالة الإقامة</th>
                                <th data-ar="انتهاء الرخصة" data-en="License Expiry" data-ur="لائسنس کی میعاد">انتهاء الرخصة</th>
                                <th data-ar="حالة الرخصة" data-en="License Status" data-ur="لائسنس کی حالت">حالة الرخصة</th>
                                <th data-ar="صورة الإقامة" data-en="Residence Photo" data-ur="رہائشی تصویر">صورة الإقامة</th>
                                <th data-ar="صورة الرخصة" data-en="License Photo" data-ur="لائسنس تصویر">صورة الرخصة</th>
                                <th data-ar="التاريخ" data-en="Date" data-ur="تاریخ">التاريخ</th>
                                <th data-ar="الإجراءات" data-en="Actions" data-ur="اعمال">الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody id="applicationsTableBody">
                            <!-- البيانات سيتم تحميلها هنا -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Advance Requests Section -->
            <div id="advanceRequestsSection" style="display: none;">
                <div class="table-header">
                    <h2 class="table-title" data-ar="طلبات السلفيات" data-en="Advance Requests" data-ur="ایڈوانس کی درخواستیں">طلبات السلفيات</h2>
                    <div class="filters">
                        <div class="filter-group">
                            <label class="filter-label" data-ar="اسم الموظف" data-en="Employee Name" data-ur="ملازم کا نام">اسم الموظف</label>
                            <input type="text" class="form-input" id="filterEmployeeName" placeholder="بحث بالاسم">
                        </div>

                        <div class="filter-group">
                            <label class="filter-label" data-ar="التاريخ" data-en="Date" data-ur="تاریخ">التاريخ</label>
                            <input type="date" class="form-input" id="filterAdvanceDate">
                        </div>
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-success" onclick="loadAdvanceRequests()" id="loadAdvanceDataBtn">
                        <i class="fas fa-sync-alt"></i>
                        <span data-ar="عرض البيانات" data-en="Show Data" data-ur="ڈیٹا دکھائیں">عرض البيانات</span>
                    </button>
                    <button class="btn btn-primary" onclick="exportAdvanceRequestsToExcel()">
                        <i class="fas fa-file-excel"></i>
                        <span data-ar="تحميل Excel" data-en="Download Excel" data-ur="ایکسل ڈاؤن لوڈ کریں">تحميل Excel</span>
                    </button>
                    <button class="btn btn-warning" onclick="showAddAdvanceRequestForm()">
                        <i class="fas fa-plus"></i>
                        <span data-ar="إضافة طلب سلفية" data-en="Add Advance Request" data-ur="ایڈوانس کی درخواست شامل کریں">إضافة طلب سلفية</span>
                    </button>
                </div>

                <div class="table-container mt-20">
                    <table class="data-table" id="advanceRequestsTable">
                        <thead>
                            <tr>
                                <th data-ar="الاسم" data-en="Name" data-ur="نام">الاسم</th>
                                <th data-ar="المشروع" data-en="Project" data-ur="پروجیکٹ">المشروع</th>
                                <th data-ar="رقم الإقامة" data-en="Residence Number" data-ur="رہائشی نمبر">رقم الإقامة</th>
                                <th data-ar="نوع المركبة" data-en="Vehicle Type" data-ur="گاڑی کی قسم">نوع المركبة</th>
                                <th data-ar="رقم لوحة الدباب" data-en="Motorcycle Plate" data-ur="موٹرسائیکل پلیٹ">رقم لوحة الدباب</th>
                                <th data-ar="رقم لوحة السيارة" data-en="Car Plate" data-ur="کار پلیٹ">رقم لوحة السيارة</th>
                                <th data-ar="المبلغ" data-en="Amount" data-ur="رقم">المبلغ</th>
                                <th data-ar="التاريخ" data-en="Date" data-ur="تاریخ">التاريخ</th>
                                <th data-ar="الحالة" data-en="Status" data-ur="حالت">الحالة</th>
                                <th data-ar="الإجراءات" data-en="Actions" data-ur="اعمال">الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody id="advanceRequestsTableBody">
                            <!-- البيانات سيتم تحميلها هنا -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Representatives Section -->
            <div id="representativesSection" class="admin-section">
                <div class="table-header">
                    <h2 class="table-title" data-ar="إدارة المناديب" data-en="Representatives Management" data-ur="نمائندے مینجمنٹ">إدارة المناديب</h2>
                    <div class="filters">
                        <div class="filter-group">
                            <label class="filter-label" data-ar="بحث" data-en="Search" data-ur="تلاش">بحث</label>
                            <input type="text" class="form-input" id="searchRepresentative" placeholder="بحث برقم الإقامة أو المركبة">
                        </div>
                        <div class="filter-group">
                            <label class="filter-label" data-ar="المنطقة" data-en="Area" data-ur="علاقہ">المنطقة</label>
                            <select class="form-select" id="filterArea">
                                <option value="" data-ar="الكل" data-en="All" data-ur="سب">الكل</option>
                                <option value="الهفوف" data-ar="الهفوف" data-en="Al-Hofuf" data-ur="الحفوف">الهفوف</option>
                                <option value="العليا" data-ar="العليا" data-en="Al-Ulya" data-ur="العلیا">العليا</option>
                                <option value="الزهران" data-ar="الزهران" data-en="Al-Zahran" data-ur="الزہران">الزهران</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-success" onclick="loadRepresentatives()">
                        <i class="fas fa-sync-alt"></i>
                        <span data-ar="عرض البيانات" data-en="Show Data" data-ur="ڈیٹا دکھائیں">عرض البيانات</span>
                    </button>
                    <button class="btn btn-primary" onclick="exportRepresentativesToExcel()">
                        <i class="fas fa-file-excel"></i>
                        <span data-ar="تحميل Excel" data-en="Download Excel" data-ur="ایکسل ڈاؤن لوڈ کریں">تحميل Excel</span>
                    </button>
                    <button class="btn btn-warning" onclick="showAddRepresentativeForm()">
                        <i class="fas fa-plus"></i>
                        <span data-ar="إضافة مندوب" data-en="Add Representative" data-ur="نمائندہ شامل کریں">إضافة مندوب</span>
                    </button>
                </div>

                <!-- بطاقات المناديب -->
                <div class="representatives-grid" id="representativesGrid">
                    <!-- البيانات سيتم تحميلها هنا -->
                </div>

                <!-- جدول المناديب -->
                <div class="table-container mt-20">
                    <table class="data-table" id="representativesTable">
                        <thead>
                            <tr>
                                <th data-ar="اسم المندوب" data-en="Representative Name" data-ur="نمائندہ کا نام">اسم المندوب</th>
                                <th data-ar="رقم الاي دي" data-en="ID Number" data-ur="آئی ڈی نمبر">رقم الاي دي</th>
                                <th data-ar="رقم الجوال" data-en="Phone Number" data-ur="فون نمبر">رقم الجوال</th>
                                <th data-ar="رقم الإقامة" data-en="Residence Number" data-ur="رہائشی نمبر">رقم الإقامة</th>
                                <th data-ar="المنطقة" data-en="Area" data-ur="علاقہ">المنطقة</th>
                                <th data-ar="المركبة" data-en="Vehicle" data-ur="گاڑی">المركبة</th>
                                <th data-ar="لوحة المركبة" data-en="Vehicle Plate" data-ur="گاڑی کی پلیٹ">لوحة المركبة</th>
                                <th data-ar="نوع السيارة" data-en="Car Type" data-ur="کار کی قسم">نوع السيارة</th>
                                <th data-ar="الإجراءات" data-en="Actions" data-ur="اعمال">الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody id="representativesTableBody">
                            <!-- البيانات سيتم تحميلها هنا -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Add Representative Form -->
            <div id="addRepresentativeForm" class="form-container" style="display: none;">
                <h2 class="form-title" data-ar="إضافة مندوب جديد" data-en="Add New Representative" data-ur="نیا نمائندہ شامل کریں">إضافة مندوب جديد</h2>
                <form id="representativeForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label" data-ar="اسم المندوب" data-en="Representative Name" data-ur="نمائندہ کا نام">اسم المندوب</label>
                            <input type="text" class="form-input" id="representativeName" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label" data-ar="رقم الاي دي" data-en="ID Number" data-ur="آئی ڈی نمبر">رقم الاي دي</label>
                            <input type="text" class="form-input" id="representativeId" required>
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label" data-ar="رقم الجوال" data-en="Phone Number" data-ur="فون نمبر">رقم الجوال</label>
                            <input type="tel" class="form-input" id="representativePhone" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label" data-ar="رقم الإقامة" data-en="Residence Number" data-ur="رہائشی نمبر">رقم الإقامة</label>
                            <input type="text" class="form-input" id="representativeResidence" required>
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label" data-ar="المنطقة" data-en="Area" data-ur="علاقہ">المنطقة</label>
                            <select class="form-select" id="representativeArea" required>
                                <option value="" data-ar="اختر المنطقة" data-en="Select Area" data-ur="علاقہ منتخب کریں">اختر المنطقة</option>
                                <option value="الهفوف" data-ar="الهفوف" data-en="Al-Hofuf" data-ur="الحفوف">الهفوف</option>
                                <option value="العليا" data-ar="العليا" data-en="Al-Ulya" data-ur="العلیا">العليا</option>
                                <option value="الزهران" data-ar="الزهران" data-en="Al-Zahran" data-ur="الزہران">الزهران</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label" data-ar="المركبة" data-en="Vehicle" data-ur="گاڑی">المركبة</label>
                            <select class="form-select" id="representativeVehicle" required onchange="toggleVehicleType()">
                                <option value="" data-ar="اختر المركبة" data-en="Select Vehicle" data-ur="گاڑی منتخب کریں">اختر المركبة</option>
                                <option value="دباب" data-ar="دباب" data-en="Motorcycle" data-ur="موٹرسائیکل">دباب</option>
                                <option value="سيارة" data-ar="سيارة" data-en="Car" data-ur="کار">سيارة</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label" data-ar="لوحة المركبة" data-en="Vehicle Plate" data-ur="گاڑی کی پلیٹ">لوحة المركبة</label>
                            <input type="text" class="form-input" id="representativePlate" required>
                        </div>

                        <div class="form-group" id="carTypeGroup" style="display: none;">
                            <label class="form-label" data-ar="نوع السيارة" data-en="Car Type" data-ur="کار کی قسم">نوع السيارة</label>
                            <select class="form-select" id="carType">
                                <option value="" data-ar="اختر نوع السيارة" data-en="Select Car Type" data-ur="کار کی قسم منتخب کریں">اختر نوع السيارة</option>
                                <option value="فري لانسر" data-ar="فري لانسر" data-en="Free Lancer" data-ur="فری لانسر">فري لانسر</option>
                                <option value="سيارة الشركة" data-ar="سيارة الشركة" data-en="Company Car" data-ur="کمپنی کار">سيارة الشركة</option>
                            </select>
                        </div>
                    </div>

                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary btn-full" id="submitRepresentativeBtn">
                            <i class="fas fa-save"></i>
                            <span data-ar="حفظ المندوب" data-en="Save Representative" data-ur="نمائندہ محفوظ کریں">حفظ المندوب</span>
                        </button>
                    </div>
                </form>

                <div class="btn-group">
                    <button class="btn btn-secondary btn-full" onclick="showRepresentativesSection()">
                        <i class="fas fa-arrow-right"></i>
                        <span data-ar="العودة للمناديب" data-en="Back to Representatives" data-ur="نمائندوں پر واپس جائیں">العودة للمناديب</span>
                    </button>
                </div>
            </div>

            <!-- Admin Management Section -->
            <div id="adminManagementSection" class="admin-section">
                <div class="table-header">
                    <h2 class="table-title" data-ar="إدارة المشرفين" data-en="Admin Management" data-ur="ایڈمن مینجمنٹ">إدارة المشرفين</h2>
                </div>

                <div class="admin-card">
                    <h3 class="admin-card-title" data-ar="إضافة مشرف جديد" data-en="Add New Supervisor" data-ur="نیا سپروائزر شامل کریں">إضافة مشرف جديد</h3>
                    <form id="addAdminForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label" data-ar="اسم المشرف" data-en="Supervisor Name" data-ur="سپروائزر کا نام">اسم المشرف</label>
                                <input type="text" class="form-input" id="adminName" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-ar="اسم المستخدم" data-en="Username" data-ur="صارف نام">اسم المستخدم</label>
                                <input type="text" class="form-input" id="adminUsername" required>
                            </div>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label" data-ar="كلمة المرور" data-en="Password" data-ur="پاس ورڈ">كلمة المرور</label>
                                <input type="password" class="form-input" id="adminPassword" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-ar="تأكيد كلمة المرور" data-en="Confirm Password" data-ur="پاس ورڈ کی تصدیق کریں">تأكيد كلمة المرور</label>
                                <input type="password" class="form-input" id="adminConfirmPassword" required>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" data-ar="الصلاحيات" data-en="Permissions" data-ur="اجازتیں">الصلاحيات</label>
                            <div class="permissions-grid">
                                <div class="permission-item">
                                    <input type="checkbox" class="permission-checkbox" id="permJobApps" checked>
                                    <label for="permJobApps" data-ar="إدارة طلبات التوظيف" data-en="Manage Job Applications" data-ur="ملازمت کی درخواستیں منظم کریں">إدارة طلبات التوظيف</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" class="permission-checkbox" id="permAdvances" checked>
                                    <label for="permAdvances" data-ar="إدارة السلفيات" data-en="Manage Advances" data-ur="ایڈوانس منظم کریں">إدارة السلفيات</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" class="permission-checkbox" id="permRepresentatives" checked>
                                    <label for="permRepresentatives" data-ar="إدارة المناديب" data-en="Manage Representatives" data-ur="نمائندے منظم کریں">إدارة المناديب</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" class="permission-checkbox" id="permAdmins">
                                    <label for="permAdmins" data-ar="إدارة المشرفين" data-en="Manage Admins" data-ur="ایڈمن منظم کریں">إدارة المشرفين</label>
                                </div>
                                <div class="permission-item">
                                    <input type="checkbox" class="permission-checkbox" id="permReports" checked>
                                    <label for="permReports" data-ar="عرض التقارير" data-en="View Reports" data-ur="رپورٹس دیکھیں">عرض التقارير</label>
                                </div>
                            </div>
                        </div>

                        <div class="btn-group">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-plus"></i>
                                <span data-ar="إضافة المشرف" data-en="Add Supervisor" data-ur="سپروائزر شامل کریں">إضافة المشرف</span>
                            </button>
                        </div>
                    </form>
                </div>

                <div class="admin-card">
                    <h3 class="admin-card-title" data-ar="قائمة المشرفين" data-en="Supervisors List" data-ur="سپروائزرز کی فہرست">قائمة المشرفين</h3>
                    <div class="btn-group">
                        <button class="btn btn-success" onclick="loadAdminsList()">
                            <i class="fas fa-sync-alt"></i>
                            <span data-ar="تحديث القائمة" data-en="Refresh List" data-ur="فہرست تازہ کریں">تحديث القائمة</span>
                        </button>
                    </div>
                    <div class="table-container mt-20">
                        <table class="data-table" id="adminsTable">
                            <thead>
                                <tr>
                                    <th data-ar="اسم المشرف" data-en="Supervisor Name" data-ur="سپروائزر کا نام">اسم المشرف</th>
                                    <th data-ar="اسم المستخدم" data-en="Username" data-ur="صارف نام">اسم المستخدم</th>
                                    <th data-ar="الصلاحيات" data-en="Permissions" data-ur="اجازتیں">الصلاحيات</th>
                                    <th data-ar="تاريخ الإضافة" data-en="Added Date" data-ur="شامل کرنے کی تاریخ">تاريخ الإضافة</th>
                                    <th data-ar="الإجراءات" data-en="Actions" data-ur="اعمال">الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody id="adminsTableBody">
                                <!-- البيانات سيتم تحميلها هنا -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Login Reports Section -->
            <div id="loginReportsSection" class="admin-section">
                <div class="table-header">
                    <h2 class="table-title" data-ar="تقارير دخول المشرفين" data-en="Supervisor Login Reports" data-ur="سپروائزر لاگ ان رپورٹس">تقارير دخول المشرفين</h2>
                    <div class="filters">
                        <div class="filter-group">
                            <label class="filter-label" data-ar="اسم المشرف" data-en="Supervisor Name" data-ur="سپروائزر کا نام">اسم المشرف</label>
                            <input type="text" class="form-input" id="filterLoginName" placeholder="بحث بالاسم">
                        </div>
                        <div class="filter-group">
                            <label class="filter-label" data-ar="التاريخ" data-en="Date" data-ur="تاریخ">التاريخ</label>
                            <input type="date" class="form-input" id="filterLoginDate">
                        </div>
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-success" onclick="loadLoginReports()">
                        <i class="fas fa-sync-alt"></i>
                        <span data-ar="عرض التقارير" data-en="Show Reports" data-ur="رپورٹس دکھائیں">عرض التقارير</span>
                    </button>
                    <button class="btn btn-primary" onclick="exportLoginReportsToExcel()">
                        <i class="fas fa-file-excel"></i>
                        <span data-ar="تحميل Excel" data-en="Download Excel" data-ur="ایکسل ڈاؤن لوڈ کریں">تحميل Excel</span>
                    </button>
                </div>

                <div class="table-container mt-20">
                    <table class="data-table" id="loginReportsTable">
                        <thead>
                            <tr>
                                <th data-ar="اسم المشرف" data-en="Supervisor Name" data-ur="سپروائزر کا نام">اسم المشرف</th>
                                <th data-ar="اسم المستخدم" data-en="Username" data-ur="صارف نام">اسم المستخدم</th>
                                <th data-ar="تاريخ الدخول" data-en="Login Date" data-ur="لاگ ان کی تاریخ">تاريخ الدخول</th>
                                <th data-ar="وقت الدخول" data-en="Login Time" data-ur="لاگ ان کا وقت">وقت الدخول</th>
                                <th data-ar="عنوان IP" data-en="IP Address" data-ur="آئی پی ایڈریس">عنوان IP</th>
                            </tr>
                        </thead>
                        <tbody id="loginReportsTableBody">
                            <!-- البيانات سيتم تحميلها هنا -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Add Advance Request Form -->
            <div id="addAdvanceRequestForm" class="form-container" style="display: none;">
                <h2 class="form-title" data-ar="إضافة طلب سلفية جديد" data-en="Add New Advance Request" data-ur="نیا ایڈوانس کی درخواست شامل کریں">إضافة طلب سلفية جديد</h2>
                <form id="advanceRequestForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label" data-ar="اسم الموظف" data-en="Employee Name" data-ur="ملازم کا نام">اسم الموظف</label>
                            <input type="text" class="form-input" id="employeeName" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label" data-ar="المشروع" data-en="Project" data-ur="پروجیکٹ">المشروع</label>
                            <input type="text" class="form-input" id="project" required>
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label" data-ar="رقم الإقامة" data-en="Residence Number" data-ur="رہائشی نمبر">رقم الإقامة</label>
                            <input type="text" class="form-input" id="residenceNumber" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label" data-ar="المبلغ" data-en="Amount" data-ur="رقم">المبلغ</label>
                            <input type="number" class="form-input" id="advanceAmount" required>
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label" data-ar="نوع المركبة" data-en="Vehicle Type" data-ur="گاڑی کی قسم">نوع المركبة</label>
                            <select class="form-select" id="advanceVehicleType" required onchange="toggleAdvancePlateFields()">
                                <option value="" data-ar="اختر نوع المركبة" data-en="Select Vehicle Type" data-ur="گاڑی کی قسم منتخب کریں">اختر نوع المركبة</option>
                                <option value="دباب" data-ar="دباب" data-en="Motorcycle" data-ur="موٹرسائیکل">دباب</option>
                                <option value="سيارة" data-ar="سيارة" data-en="Car" data-ur="کار">سيارة</option>
                                <option value="كلاهما" data-ar="كلاهما" data-en="Both" data-ur="دونوں">كلاهما</option>
                            </select>
                        </div>

                        <div class="form-group" id="motorcyclePlateGroup">
                            <label class="form-label" data-ar="رقم لوحة الدباب" data-en="Motorcycle Plate" data-ur="موٹرسائیکل پلیٹ">رقم لوحة الدباب</label>
                            <input type="text" class="form-input" id="motorcyclePlate">
                        </div>

                        <div class="form-group" id="carPlateGroup" style="display: none;">
                            <label class="form-label" data-ar="رقم لوحة السيارة" data-en="Car Plate" data-ur="کار پلیٹ">رقم لوحة السيارة</label>
                            <input type="text" class="form-input" id="carPlate">
                        </div>
                    </div>

                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary btn-full" id="submitAdvanceBtn">
                            <i class="fas fa-save"></i>
                            <span data-ar="حفظ طلب السلفية" data-en="Save Advance Request" data-ur="ایڈوانس کی درخواست محفوظ کریں">حفظ طلب السلفية</span>
                        </button>
                    </div>
                </form>

                <div class="btn-group">
                    <button class="btn btn-secondary btn-full" onclick="showAdvanceRequestsSection()">
                        <i class="fas fa-arrow-right"></i>
                        <span data-ar="العودة لطلبات السلفيات" data-en="Back to Advance Requests" data-ur="ایڈوانس کی درخواستوں پر واپس جائیں">العودة لطلبات السلفيات</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div class="notification-container" id="notificationContainer"></div>

    <script>
        let systemState = {
            firebaseReady: false,
            currentEditingId: null,
            selectedResidenceImage: null,
            selectedLicenseImage: null,
            hasExpiredResidence: false,
            hasExpiredLicense: false,
            // كود التحقق المشفر (6 خانات) - 046035
            verificationCode: "046035",
            currentSupervisor: null,
            supervisors: {
                "احمد الصادق": {
                    username: "احمد الصادق",
                    password: "0094",
                    name: "أحمد الصادق",
                    role: "مشرف رئيسي",
                    permissions: {
                        jobApps: true,
                        advances: true,
                        representatives: true,
                        admins: true,
                        reports: true
                    }
                }
            },
            // بيانات المناديب الافتراضية
            representatives: {
                "rep001": {
                    id: "rep001",
                    name: "محمد أحمد",
                    phone: "0551234567",
                    residence: "1234567890",
                    area: "الهفوف",
                    vehicle: "دباب",
                    plate: "د ب 1234",
                    carType: "",
                    dateAdded: new Date().toISOString()
                },
                "rep002": {
                    id: "rep002",
                    name: "علي حسن",
                    phone: "0557654321",
                    residence: "0987654321",
                    area: "العليا",
                    vehicle: "سيارة",
                    plate: "أ ب 5678",
                    carType: "فري لانسر",
                    dateAdded: new Date().toISOString()
                },
                "rep003": {
                    id: "rep003",
                    name: "سعيد خالد",
                    phone: "0559876543",
                    residence: "1122334455",
                    area: "الزهران",
                    vehicle: "سيارة",
                    plate: "ج د 9012",
                    carType: "سيارة الشركة",
                    dateAdded: new Date().toISOString()
                }
            }
        };

        window.onFirebaseReady = function() {
            systemState.firebaseReady = true;
            console.log("✅ Firebase is ready to use");
            showNotification(getTranslation('✅ تم الاتصال بقاعدة البيانات بنجاح', '✅ Connected to database successfully', '✅ ڈیٹا بیس سے کامیابی سے منسلک ہو گیا'), 'success');
        };

        // دالة التحقق من تاريخ الانتهاء
        function checkExpiry(input, type) {
            const expiryDate = new Date(input.value);
            const today = new Date();
            const warningElement = document.getElementById(type + 'Warning');
            const infoElement = document.getElementById(type + 'Info');
            
            if (expiryDate < today) {
                if (type === 'residence') {
                    // للإقامة: إظهار رسالة تنبيه ولكن السماح بالتقديم
                    warningElement.style.display = 'block';
                    infoElement.style.display = 'none';
                    systemState.hasExpiredResidence = true;
                } else {
                    // للرخصة: منع التقديم
                    warningElement.style.display = 'block';
                    systemState.hasExpiredLicense = true;
                }
            } else {
                warningElement.style.display = 'none';
                if (type === 'residence') {
                    infoElement.style.display = 'block';
                    systemState.hasExpiredResidence = false;
                } else {
                    systemState.hasExpiredLicense = false;
                }
            }
        }

        // دالة رفع الصور إلى ImgBB
        async function uploadToImgBB(imageFile) {
            const apiKey = '6724dafff610326aa1f9cd661d600c9f';
            const formData = new FormData();
            formData.append('image', imageFile);

            try {
                const response = await fetch(`https://api.imgbb.com/1/upload?key=${apiKey}`, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                
                if (data.success) {
                    return data.data.url;
                } else {
                    throw new Error(data.error.message || 'فشل رفع الصورة');
                }
            } catch (error) {
                console.error('Error uploading image:', error);
                throw error;
            }
        }

        function previewImage(input, previewId) {
            const preview = document.getElementById(previewId);
            preview.innerHTML = '';
            
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    
                    const removeBtn = document.createElement('button');
                    removeBtn.type = 'button';
                    removeBtn.className = 'remove-image';
                    removeBtn.innerHTML = '<i class="fas fa-times"></i> ' + getTranslation('إزالة الصورة', 'Remove Image', 'تصویر ہٹائیں');
                    removeBtn.onclick = function() {
                        input.value = '';
                        preview.innerHTML = '';
                        if (previewId === 'residencePreview') {
                            systemState.selectedResidenceImage = null;
                        } else if (previewId === 'licensePreview') {
                            systemState.selectedLicenseImage = null;
                        }
                    };
                    
                    preview.appendChild(img);
                    preview.appendChild(removeBtn);
                    
                    if (previewId === 'residencePreview') {
                        systemState.selectedResidenceImage = input.files[0];
                    } else if (previewId === 'licensePreview') {
                        systemState.selectedLicenseImage = input.files[0];
                    }
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function toggleLicensePlateField() {
            const vehicleType = document.getElementById('vehicleType').value;
            const vehiclePlate = document.getElementById('vehiclePlate');
            
            if (vehicleType === 'دباب') {
                vehiclePlate.placeholder = getTranslation('أدخل رقم لوحة الدباب', 'Enter motorcycle plate number', 'موٹرسائیکل پلیٹ نمبر درج کریں');
            } else if (vehicleType === 'سيارة') {
                vehiclePlate.placeholder = getTranslation('أدخل رقم لوحة السيارة', 'Enter car plate number', 'کار پلیٹ نمبر درج کریں');
            } else {
                vehiclePlate.placeholder = getTranslation('رقم لوحة المركبة', 'Vehicle plate number', 'گاڑی کی پلیٹ نمبر');
            }
        }

        function toggleVehicleType() {
            const vehicleType = document.getElementById('representativeVehicle').value;
            const carTypeGroup = document.getElementById('carTypeGroup');
            
            if (vehicleType === 'سيارة') {
                carTypeGroup.style.display = 'block';
                document.getElementById('carType').required = true;
            } else {
                carTypeGroup.style.display = 'none';
                document.getElementById('carType').required = false;
                document.getElementById('carType').value = '';
            }
        }

        function toggleAdvancePlateFields() {
            const vehicleType = document.getElementById('advanceVehicleType').value;
            const motorcycleGroup = document.getElementById('motorcyclePlateGroup');
            const carGroup = document.getElementById('carPlateGroup');
            
            if (vehicleType === 'دباب') {
                motorcycleGroup.style.display = 'block';
                carGroup.style.display = 'none';
                document.getElementById('motorcyclePlate').required = true;
                document.getElementById('carPlate').required = false;
            } else if (vehicleType === 'سيارة') {
                motorcycleGroup.style.display = 'none';
                carGroup.style.display = 'block';
                document.getElementById('motorcyclePlate').required = false;
                document.getElementById('carPlate').required = true;
            } else if (vehicleType === 'كلاهما') {
                motorcycleGroup.style.display = 'block';
                carGroup.style.display = 'block';
                document.getElementById('motorcyclePlate').required = true;
                document.getElementById('carPlate').required = true;
            } else {
                motorcycleGroup.style.display = 'none';
                carGroup.style.display = 'none';
                document.getElementById('motorcyclePlate').required = false;
                document.getElementById('carPlate').required = false;
            }
        }

        function showHomePage() {
            document.getElementById('jobApplicationForm').style.display = 'none';
            document.getElementById('supervisorLogin').style.display = 'none';
            document.getElementById('supervisorDashboard').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
            document.getElementById('verificationContainer').style.display = 'none';
            document.querySelector('.nav-cards').style.display = 'grid';
            document.getElementById('jobAnnouncement').style.display = 'block';
            resetForm();
        }

        function showJobApplicationForm() {
            document.querySelector('.nav-cards').style.display = 'none';
            document.getElementById('jobApplicationForm').style.display = 'block';
            document.getElementById('supervisorLogin').style.display = 'none';
            document.getElementById('supervisorDashboard').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
            document.getElementById('verificationContainer').style.display = 'none';
            document.getElementById('jobAnnouncement').style.display = 'none';
            resetForm();
        }

        function showSupervisorLogin() {
            document.querySelector('.nav-cards').style.display = 'none';
            document.getElementById('jobApplicationForm').style.display = 'none';
            document.getElementById('supervisorLogin').style.display = 'block';
            document.getElementById('supervisorDashboard').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
            document.getElementById('verificationContainer').style.display = 'none';
            document.getElementById('jobAnnouncement').style.display = 'none';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        function showVerificationContainer() {
            document.querySelector('.nav-cards').style.display = 'none';
            document.getElementById('jobApplicationForm').style.display = 'none';
            document.getElementById('supervisorLogin').style.display = 'none';
            document.getElementById('supervisorDashboard').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
            document.getElementById('verificationContainer').style.display = 'block';
            document.getElementById('jobAnnouncement').style.display = 'none';
            document.getElementById('otpCode').value = '';
        }

        function showSupervisorDashboard() {
            document.querySelector('.nav-cards').style.display = 'none';
            document.getElementById('jobApplicationForm').style.display = 'none';
            document.getElementById('supervisorLogin').style.display = 'none';
            document.getElementById('supervisorDashboard').style.display = 'block';
            document.getElementById('successMessage').style.display = 'none';
            document.getElementById('verificationContainer').style.display = 'none';
            document.getElementById('jobAnnouncement').style.display = 'none';
            showJobApplicationsSection();
        }

        function showJobApplicationsSection() {
            document.getElementById('jobApplicationsSection').style.display = 'block';
            document.getElementById('advanceRequestsSection').style.display = 'none';
            document.getElementById('representativesSection').style.display = 'none';
            document.getElementById('adminManagementSection').style.display = 'none';
            document.getElementById('loginReportsSection').style.display = 'none';
            document.getElementById('addAdvanceRequestForm').style.display = 'none';
            document.getElementById('addRepresentativeForm').style.display = 'none';
            loadJobApplications();
        }

        function showAdvanceRequestsSection() {
            document.getElementById('jobApplicationsSection').style.display = 'none';
            document.getElementById('advanceRequestsSection').style.display = 'block';
            document.getElementById('representativesSection').style.display = 'none';
            document.getElementById('adminManagementSection').style.display = 'none';
            document.getElementById('loginReportsSection').style.display = 'none';
            document.getElementById('addAdvanceRequestForm').style.display = 'none';
            document.getElementById('addRepresentativeForm').style.display = 'none';
            loadAdvanceRequests();
        }

        function showRepresentativesSection() {
            document.getElementById('jobApplicationsSection').style.display = 'none';
            document.getElementById('advanceRequestsSection').style.display = 'none';
            document.getElementById('representativesSection').style.display = 'block';
            document.getElementById('adminManagementSection').style.display = 'none';
            document.getElementById('loginReportsSection').style.display = 'none';
            document.getElementById('addAdvanceRequestForm').style.display = 'none';
            document.getElementById('addRepresentativeForm').style.display = 'none';
            loadRepresentatives();
        }

        function showAdminManagementSection() {
            document.getElementById('jobApplicationsSection').style.display = 'none';
            document.getElementById('advanceRequestsSection').style.display = 'none';
            document.getElementById('representativesSection').style.display = 'none';
            document.getElementById('adminManagementSection').style.display = 'block';
            document.getElementById('loginReportsSection').style.display = 'none';
            document.getElementById('addAdvanceRequestForm').style.display = 'none';
            document.getElementById('addRepresentativeForm').style.display = 'none';
            loadAdminsList();
        }

        function showLoginReportsSection() {
            document.getElementById('jobApplicationsSection').style.display = 'none';
            document.getElementById('advanceRequestsSection').style.display = 'none';
            document.getElementById('representativesSection').style.display = 'none';
            document.getElementById('adminManagementSection').style.display = 'none';
            document.getElementById('loginReportsSection').style.display = 'block';
            document.getElementById('addAdvanceRequestForm').style.display = 'none';
            document.getElementById('addRepresentativeForm').style.display = 'none';
            loadLoginReports();
        }

        function showAddAdvanceRequestForm() {
            document.getElementById('jobApplicationsSection').style.display = 'none';
            document.getElementById('advanceRequestsSection').style.display = 'none';
            document.getElementById('representativesSection').style.display = 'none';
            document.getElementById('adminManagementSection').style.display = 'none';
            document.getElementById('loginReportsSection').style.display = 'none';
            document.getElementById('addAdvanceRequestForm').style.display = 'block';
            document.getElementById('addRepresentativeForm').style.display = 'none';
            document.getElementById('advanceRequestForm').reset();
        }

        function showAddRepresentativeForm() {
            document.getElementById('jobApplicationsSection').style.display = 'none';
            document.getElementById('advanceRequestsSection').style.display = 'none';
            document.getElementById('representativesSection').style.display = 'none';
            document.getElementById('adminManagementSection').style.display = 'none';
            document.getElementById('loginReportsSection').style.display = 'none';
            document.getElementById('addAdvanceRequestForm').style.display = 'none';
            document.getElementById('addRepresentativeForm').style.display = 'block';
            document.getElementById('representativeForm').reset();
            toggleVehicleType();
        }

        function showSuccessMessage() {
            document.querySelector('.nav-cards').style.display = 'none';
            document.getElementById('jobApplicationForm').style.display = 'none';
            document.getElementById('supervisorLogin').style.display = 'none';
            document.getElementById('supervisorDashboard').style.display = 'none';
            document.getElementById('successMessage').style.display = 'block';
            document.getElementById('jobAnnouncement').style.display = 'none';
        }

        function resetForm() {
            document.getElementById('jobForm').reset();
            document.getElementById('residencePreview').innerHTML = '';
            document.getElementById('licensePreview').innerHTML = '';
            document.getElementById('residenceWarning').style.display = 'none';
            document.getElementById('licenseWarning').style.display = 'none';
            document.getElementById('residenceInfo').style.display = 'block';
            systemState.currentEditingId = null;
            systemState.selectedResidenceImage = null;
            systemState.selectedLicenseImage = null;
            systemState.hasExpiredResidence = false;
            systemState.hasExpiredLicense = false;
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> <span data-ar="تقديم الطلب" data-en="Submit Application" data-ur="درخواست جمع کروائیں">تقديم الطلب</span>';
            submitBtn.disabled = false;
        }

        async function supervisorLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            // التحقق من بيانات الدخول
            let supervisor = null;
            for (const key in systemState.supervisors) {
                if (systemState.supervisors[key].username === username && systemState.supervisors[key].password === password) {
                    supervisor = systemState.supervisors[key];
                    break;
                }
            }

            if (supervisor) {
                systemState.currentSupervisor = supervisor;
                
                // تسجيل دخول المشرف في قاعدة البيانات
                await logSupervisorLogin(supervisor);
                
                // إرسال إشعار للمستخدم الرئيسي أحمد الصادق
                if (supervisor.username !== "احمد الصادق") {
                    await sendNotificationToMainAdmin(supervisor);
                }
                
                showVerificationContainer();
                showNotification(getTranslation('تم إرسال رمز التحقق', 'Verification code has been sent', 'تصدیقی کوڈ بھیج دیا گیا ہے'), 'info');
            } else {
                showNotification(getTranslation('بيانات الدخول غير صحيحة', 'Invalid login credentials', 'غلط لاگ ان کی تفصیلات'), 'error');
            }
        }

        async function logSupervisorLogin(supervisor) {
            if (!systemState.firebaseReady) return;
            
            try {
                const loginData = {
                    supervisorName: supervisor.name,
                    username: supervisor.username,
                    loginDate: new Date().toISOString().split('T')[0],
                    loginTime: new Date().toLocaleTimeString(),
                    timestamp: new Date(),
                    ipAddress: await getIPAddress()
                };
                
                await window.firestoreFunctions.addDoc(
                    window.firestoreFunctions.collection(window.db, "supervisorLogins"), 
                    loginData
                );
                
                console.log("✅ Supervisor login logged successfully");
            } catch (error) {
                console.error("Error logging supervisor login:", error);
            }
        }

        async function sendNotificationToMainAdmin(supervisor) {
            if (!systemState.firebaseReady) return;
            
            try {
                const notificationData = {
                    title: getTranslation('دخول مشرف جديد', 'New Supervisor Login', 'نیا سپروائزر لاگ ان'),
                    message: getTranslation('قام المشرف ', 'Supervisor ', 'سپروائزر ') + 
                             supervisor.name + 
                             getTranslation(' بتسجيل الدخول إلى النظام', ' logged into the system', ' نے سسٹم میں لاگ ان کیا'),
                    supervisorName: supervisor.name,
                    loginTime: new Date().toLocaleString(),
                    timestamp: new Date(),
                    read: false
                };
                
                await window.firestoreFunctions.addDoc(
                    window.firestoreFunctions.collection(window.db, "notifications"), 
                    notificationData
                );
                
                console.log("✅ Notification sent to main admin");
            } catch (error) {
                console.error("Error sending notification:", error);
            }
        }

        async function getIPAddress() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch (error) {
                console.error("Error getting IP address:", error);
                return "غير معروف";
            }
        }

        function verifyOTP() {
            const otpCode = document.getElementById('otpCode').value;
            
            if (otpCode === systemState.verificationCode) {
                // تحديث واجهة المشرف بناءً على صلاحياته
                updateSupervisorInterface();
                
                showSupervisorDashboard();
                showNotification(getTranslation('✅ تم التحقق من الهوية - المشرف ', '✅ Identity verified - Supervisor ', '✅ شناخت کی تصدیق ہو گئی - سپروائزر ') + systemState.currentSupervisor.name, 'success');
            } else {
                showNotification(getTranslation('❌ رمز التحقق غير صحيح', '❌ Invalid verification code', '❌ غلط تصدیقی کوڈ'), 'error');
            }
        }

        function updateSupervisorInterface() {
            // تحديث اسم و دور المشرف
            document.getElementById('currentSupervisorName').textContent = systemState.currentSupervisor.name;
            document.getElementById('currentSupervisorRole').textContent = systemState.currentSupervisor.role;
            
            // إخفاء الأقسام التي ليس للمشرف صلاحية الوصول إليها
            const adminManagementBtn = document.querySelector('.supervisor-nav-btn:nth-child(4)');
            const representativesBtn = document.querySelector('.supervisor-nav-btn:nth-child(3)');
            
            if (!systemState.currentSupervisor.permissions.admins) {
                adminManagementBtn.style.display = 'none';
            } else {
                adminManagementBtn.style.display = 'flex';
            }
            
            if (!systemState.currentSupervisor.permissions.representatives) {
                representativesBtn.style.display = 'none';
            } else {
                representativesBtn.style.display = 'flex';
            }
        }

        function supervisorLogout() {
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('otpCode').value = '';
            systemState.currentSupervisor = null;
            showHomePage();
            showNotification(getTranslation('تم تسجيل الخروج', 'Logged out successfully', 'لاگ آؤٹ کامیاب'), 'info');
        }

        // ... (بقية الدوال الخاصة بتقديم الطلبات وإدارة السلفيات)

        // دالة تحميل بيانات المناديب
        async function loadRepresentatives() {
            if (!systemState.firebaseReady) {
                showNotification(getTranslation('⏳ جاري الاتصال بقاعدة البيانات...', '⏳ Connecting to database...', '⏳ ڈیٹا بیس سے منسلک ہو رہا ہے...'), 'warning');
                return;
            }

            const searchTerm = document.getElementById('searchRepresentative').value.toLowerCase();
            const filterArea = document.getElementById('filterArea').value;
            const gridContainer = document.getElementById('representativesGrid');
            const tableBody = document.getElementById('representativesTableBody');
            
            try {
                gridContainer.innerHTML = '<div class="text-center">' + getTranslation('جاري تحميل البيانات...', 'Loading data...', 'ڈیٹا لوڈ ہو رہا ہے...') + '</div>';
                tableBody.innerHTML = '<tr><td colspan="9" class="text-center">' + getTranslation('جاري تحميل البيانات...', 'Loading data...', 'ڈیٹا لوڈ ہو رہا ہے...') + '</td></tr>';

                let representativesData = [];
                
                // محاولة جلب البيانات من Firebase
                if (systemState.firebaseReady) {
                    try {
                        const q = window.firestoreFunctions.query(
                            window.firestoreFunctions.collection(window.db, "representatives"),
                            window.firestoreFunctions.orderBy("dateAdded", "desc")
                        );
                        
                        const querySnapshot = await window.firestoreFunctions.getDocs(q);
                        querySnapshot.forEach((doc) => {
                            const data = doc.data();
                            data.id = doc.id;
                            representativesData.push(data);
                        });
                    } catch (error) {
                        console.log("Using local representatives data");
                        // استخدام البيانات المحلية إذا فشل الاتصال
                        representativesData = Object.values(systemState.representatives);
                    }
                } else {
                    // استخدام البيانات المحلية
                    representativesData = Object.values(systemState.representatives);
                }

                // تطبيق الفلاتر
                const filteredData = representativesData.filter(rep => {
                    const matchSearch = !searchTerm || 
                        (rep.residence && rep.residence.includes(searchTerm)) ||
                        (rep.plate && rep.plate.toLowerCase().includes(searchTerm)) ||
                        (rep.name && rep.name.toLowerCase().includes(searchTerm));
                    
                    const matchArea = !filterArea || rep.area === filterArea;
                    
                    return matchSearch && matchArea;
                });

                // عرض البيانات في البطاقات
                gridContainer.innerHTML = '';
                if (filteredData.length === 0) {
                    gridContainer.innerHTML = '<div class="text-center">' + getTranslation('لا توجد بيانات مطابقة', 'No matching data found', 'کوئی مماثل ڈیٹا نہیں ملا') + '</div>';
                } else {
                    filteredData.forEach(rep => {
                        const card = `
                            <div class="representative-card">
                                <div class="representative-header">
                                    <h3 class="representative-name">${rep.name}</h3>
                                    <p class="representative-id">رقم الاي دي: ${rep.id}</p>
                                </div>
                                <div class="representative-body">
                                    <div class="representative-detail">
                                        <span class="detail-label">رقم الجوال</span>
                                        <span class="detail-value">${rep.phone}</span>
                                    </div>
                                    <div class="representative-detail">
                                        <span class="detail-label">رقم الإقامة</span>
                                        <span class="detail-value">${rep.residence}</span>
                                    </div>
                                    <div class="representative-detail">
                                        <span class="detail-label">المنطقة</span>
                                        <span class="detail-value">${rep.area}</span>
                                    </div>
                                    <div class="representative-detail">
                                        <span class="detail-label">المركبة</span>
                                        <span class="detail-value">${rep.vehicle}</span>
                                    </div>
                                    <div class="representative-detail">
                                        <span class="detail-label">لوحة المركبة</span>
                                        <span class="detail-value">${rep.plate}</span>
                                    </div>
                                    ${rep.carType ? `
                                    <div class="representative-detail">
                                        <span class="detail-label">نوع السيارة</span>
                                        <span class="detail-value">${rep.carType}</span>
                                    </div>
                                    ` : ''}
                                </div>
                            </div>
                        `;
                        gridContainer.innerHTML += card;
                    });
                }

                // عرض البيانات في الجدول
                tableBody.innerHTML = '';
                if (filteredData.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="9" class="text-center">' + getTranslation('لا توجد بيانات مطابقة', 'No matching data found', 'کوئی مماثل ڈیٹا نہیں ملا') + '</td></tr>';
                } else {
                    filteredData.forEach(rep => {
                        const row = `
                            <tr>
                                <td>${rep.name}</td>
                                <td>${rep.id}</td>
                                <td>${rep.phone}</td>
                                <td>${rep.residence}</td>
                                <td>${rep.area}</td>
                                <td>${rep.vehicle}</td>
                                <td>${rep.plate}</td>
                                <td>${rep.carType || '-'}</td>
                                <td>
                                    <div class="btn-group">
                                        <button class="btn btn-warning btn-small" onclick="editRepresentative('${rep.id}')">
                                            <i class="fas fa-edit"></i> ${getTranslation('تعديل', 'Edit', 'ترمیم')}
                                        </button>
                                        <button class="btn btn-danger btn-small" onclick="deleteRepresentative('${rep.id}')">
                                            <i class="fas fa-trash"></i> ${getTranslation('حذف', 'Delete', 'حذف کریں')}
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        `;
                        tableBody.innerHTML += row;
                    });
                }

                showNotification(getTranslation('✅ تم تحميل ', '✅ Loaded ', '✅ لوڈ ہو گیا ') + filteredData.length + getTranslation(' مندوب', ' representatives', ' نمائندے'), 'success');

            } catch (error) {
                console.error('Error loading representatives:', error);
                showNotification(getTranslation('❌ حدث خطأ أثناء تحميل البيانات', '❌ Error loading data', '❌ ڈیٹا لوڈ کرنے میں خرابی'), 'error');
                gridContainer.innerHTML = '<div class="text-center">' + getTranslation('حدث خطأ في تحميل البيانات', 'Error loading data', 'ڈیٹا لوڈ کرنے میں خرابی') + '</div>';
                tableBody.innerHTML = '<tr><td colspan="9" class="text-center">' + getTranslation('حدث خطأ في تحميل البيانات', 'Error loading data', 'ڈیٹا لوڈ کرنے میں خرابی') + '</td></tr>';
            }
        }

        // دالة إضافة مندوب جديد
        async function addNewRepresentative(event) {
            event.preventDefault();
            
            if (!systemState.firebaseReady) {
                showNotification(getTranslation('⏳ جاري الاتصال بقاعدة البيانات...', '⏳ Connecting to database...', '⏳ ڈیٹا بیس سے منسلک ہو رہا ہے...'), 'warning');
                return;
            }

            const submitBtn = document.getElementById('submitRepresentativeBtn');
            const originalText = submitBtn.innerHTML;
            
            try {
                submitBtn.innerHTML = '<div class="loading"></div> ' + getTranslation('جاري الحفظ...', 'Saving...', 'محفوظ ہو رہا ہے...');
                submitBtn.disabled = true;

                const formData = {
                    name: document.getElementById('representativeName').value.trim(),
                    id: document.getElementById('representativeId').value.trim(),
                    phone: document.getElementById('representativePhone').value.trim(),
                    residence: document.getElementById('representativeResidence').value.trim(),
                    area: document.getElementById('representativeArea').value,
                    vehicle: document.getElementById('representativeVehicle').value,
                    plate: document.getElementById('representativePlate').value.trim(),
                    carType: document.getElementById('representativeVehicle').value === 'سيارة' ? document.getElementById('carType').value : '',
                    dateAdded: new Date().toISOString(),
                    timestamp: new Date()
                };

                if (!formData.name || !formData.id || !formData.phone || !formData.residence || !formData.area || !formData.vehicle || !formData.plate) {
                    showNotification(getTranslation('❌ يرجى ملء جميع الحقول المطلوبة', '❌ Please fill all required fields', '❌ براہ کرم تمام ضروری فیلڈز کو پُر کریں'), 'error');
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                    return;
                }

                // إذا كان هناك تعديل، قم بتحديث البيانات
                if (systemState.currentEditingId) {
                    // تحديث البيانات في Firebase
                    if (systemState.firebaseReady) {
                        await window.firestoreFunctions.updateDoc(
                            window.firestoreFunctions.doc(window.db, "representatives", systemState.currentEditingId),
                            formData
                        );
                    }
                    
                    // تحديث البيانات المحلية
                    systemState.representatives[systemState.currentEditingId] = formData;
                    
                    showNotification(getTranslation('✅ تم تحديث بيانات المندوب بنجاح', '✅ Representative data updated successfully', '✅ نمائندہ کا ڈیٹا کامیابی سے اپ ڈیٹ ہو گیا'), 'success');
                    systemState.currentEditingId = null;
                } else {
                    // إذا كان مندوب جديد، قم بإضافة البيانات
                    const newId = 'rep' + Date.now();
                    
                    // إضافة البيانات إلى Firebase
                    if (systemState.firebaseReady) {
                        await window.firestoreFunctions.setDoc(
                            window.firestoreFunctions.doc(window.db, "representatives", newId),
                            {...formData, id: newId}
                        );
                    }
                    
                    // إضافة البيانات المحلية
                    systemState.representatives[newId] = {...formData, id: newId};
                    
                    showNotification(getTranslation('✅ تم إضافة المندوب بنجاح', '✅ Representative added successfully', '✅ نمائندہ کامیابی سے شامل ہو گیا'), 'success');
                }
                
                document.getElementById('representativeForm').reset();
                
                setTimeout(() => {
                    showRepresentativesSection();
                }, 1000);
                
            } catch (error) {
                console.error('Error saving representative:', error);
                showNotification(getTranslation('❌ حدث خطأ أثناء حفظ بيانات المندوب', '❌ Error saving representative data', '❌ نمائندہ کا ڈیٹا محفوظ کرنے میں خرابی'), 'error');
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }

        // دالة تعديل مندوب
        async function editRepresentative(representativeId) {
            const representative = systemState.representatives[representativeId];
            
            if (representative) {
                // تعبئة النموذج بالبيانات
                document.getElementById('representativeName').value = representative.name || '';
                document.getElementById('representativeId').value = representative.id || '';
                document.getElementById('representativePhone').value = representative.phone || '';
                document.getElementById('representativeResidence').value = representative.residence || '';
                document.getElementById('representativeArea').value = representative.area || '';
                document.getElementById('representativeVehicle').value = representative.vehicle || '';
                document.getElementById('representativePlate').value = representative.plate || '';
                
                if (representative.vehicle === 'سيارة') {
                    document.getElementById('carType').value = representative.carType || '';
                }
                
                // تحديث حالة النظام
                systemState.currentEditingId = representativeId;
                
                // تحديث حقول النوع بناءً على المركبة
                toggleVehicleType();
                
                // تغيير نص زر الإرسال
                const submitBtn = document.getElementById('submitRepresentativeBtn');
                submitBtn.innerHTML = '<i class="fas fa-save"></i> <span data-ar="تحديث المندوب" data-en="Update Representative" data-ur="نمائندہ اپ ڈیٹ کریں">تحديث المندوب</span>';
                
                // إظهار نموذج إضافة المندوب
                showAddRepresentativeForm();
                
                showNotification(getTranslation('✅ تم تحميل بيانات المندوب للتعديل', '✅ Representative data loaded for editing', '✅ ترمیم کے لیے نمائندہ کا ڈیٹا لوڈ ہو گیا'), 'success');
            } else {
                showNotification(getTranslation('❌ لم يتم العثور على المندوب', '❌ Representative not found', '❌ نمائندہ نہیں ملا'), 'error');
            }
        }

        // دالة حذف مندوب
        async function deleteRepresentative(representativeId) {
            if (!confirm(getTranslation('هل أنت متأكد من حذف هذا المندوب؟', 'Are you sure you want to delete this representative?', 'کیا آپ واقعی اس نمائندہ کو حذف کرنا چاہتے ہیں؟'))) {
                return;
            }

            try {
                // حذف البيانات من Firebase
                if (systemState.firebaseReady) {
                    await window.firestoreFunctions.deleteDoc(
                        window.firestoreFunctions.doc(window.db, "representatives", representativeId)
                    );
                }
                
                // حذف البيانات المحلية
                delete systemState.representatives[representativeId];
                
                showNotification(getTranslation('✅ تم حذف المندوب بنجاح', '✅ Representative deleted successfully', '✅ نمائندہ کامیابی سے حذف ہو گیا'), 'success');
                loadRepresentatives();
                
            } catch (error) {
                console.error('Error deleting representative:', error);
                showNotification(getTranslation('❌ حدث خطأ أثناء حذف المندوب', '❌ Error deleting representative', '❌ نمائندہ حذف کرنے میں خرابی'), 'error');
            }
        }

        // دالة تصدير بيانات المناديب إلى Excel
        function exportRepresentativesToExcel() {
            try {
                const table = document.getElementById('representativesTable');
                const workbook = XLSX.utils.table_to_book(table, {sheet: "المناديب"});
                XLSX.writeFile(workbook, "representatives.xlsx");
                showNotification(getTranslation('✅ تم تحميل ملف Excel بنجاح', '✅ Excel file downloaded successfully', '✅ ایکسل فائل کامیابی سے ڈاؤن لوڈ ہو گئی'), 'success');
            } catch (error) {
                console.error('Error exporting to Excel:', error);
                showNotification(getTranslation('❌ حدث خطأ أثناء التصدير', '❌ Error exporting to Excel', '❌ ایکسل میں برآمد کرنے میں خرابی'), 'error');
            }
        }

        // ... (بقية الدوال الخاصة بالتصدير والتحويل بين اللغات)

        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('jobForm').addEventListener('submit', submitJobApplication);
            document.getElementById('advanceRequestForm').addEventListener('submit', submitAdvanceRequest);
            document.getElementById('representativeForm').addEventListener('submit', addNewRepresentative);
            document.getElementById('addAdminForm').addEventListener('submit', addNewAdmin);
            
            // إضافة مستمعات للأحداث للبحث الفوري
            document.getElementById('searchRepresentative').addEventListener('input', loadRepresentatives);
            document.getElementById('filterArea').addEventListener('change', loadRepresentatives);
            
            updateLanguage('ar');
            setTimeout(() => {
                if (!systemState.firebaseReady) {
                    showNotification(getTranslation('⚠️ جاري الاتصال بقاعدة البيانات...', '⚠️ Connecting to database...', '⚠️ ڈیٹا بیس سے منسلک ہو رہا ہے...'), 'warning');
                }
            }, 2000);
            showNotification(getTranslation('مرحباً بك في نظام توظيف الزهراني', 'Welcome to Al-Zahrani Employment System', 'الزہرانی ملازمت کے نظام میں خوش آمدید'), 'info');
        });

        // ... (بقية الدوال الموجودة سابقاً)
    </script>
</body>
</html>
