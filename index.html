<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام التوظيف - Al-Zahrani</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    
    <!-- إضافة Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, query, orderBy, doc, deleteDoc, getDoc, updateDoc, where, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCWQ2q1HU_LLQKkp2KRlOZ1FdF0bI6jBbM",
            authDomain: "zahrani-bc3ae.firebaseapp.com",
            projectId: "zahrani-bc3ae",
            storageBucket: "zahrani-bc3ae.firebasestorage.app",
            messagingSenderId: "405206070457",
            appId: "1:405206070457:web:fedf4204571d910030d768"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.db = db;
        window.firestoreFunctions = { collection, addDoc, getDocs, query, orderBy, doc, deleteDoc, getDoc, updateDoc, where, setDoc };

        console.log("✅ Firebase initialized successfully");
        window.firebaseReady = true;
        if (window.onFirebaseReady) window.onFirebaseReady();
    </script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', 'Tajawal', sans-serif; }
        :root {
            --primary: #1a365d; --secondary: #2d3748; --accent: #3182ce; --success: #38a169;
            --warning: #d69e2e; --danger: #e53e3e; --light: #f7fafc; --dark: #2d3748;
            --gradient: linear-gradient(135deg, #1a365d 0%, #2d3748 100%);
        }
        
        body { 
            background: linear-gradient(rgba(255, 255, 255, 0.85), rgba(255, 255, 255, 0.85)), 
                        url('https://i.ibb.co/0Q6qW8g/background.jpg') no-repeat center center fixed;
            background-size: cover;
            min-height: 100vh; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            padding: 20px; 
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.7);
            z-index: -1;
        }
        
        .container { 
            width: 100%; 
            max-width: 1400px; 
            position: relative;
            z-index: 1;
        }
        
        .header { 
            background: var(--gradient); 
            color: white; 
            padding: 25px; 
            border-radius: 20px; 
            text-align: center; 
            margin-bottom: 30px; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.15); 
            position: relative; 
            overflow: hidden; 
        }
        .header::before { 
            content: ''; 
            position: absolute; 
            top: 0; 
            left: 0; 
            right: 0; 
            height: 5px; 
            background: linear-gradient(90deg, var(--accent), var(--success)); 
        }
        .video-container { 
            width: 100%; 
            max-width: 900px; 
            margin: 0 auto 25px; 
            border-radius: 15px; 
            overflow: hidden; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border: 3px solid rgba(255,255,255,0.3);
        }
        .video-container video { 
            width: 100%; 
            height: auto; 
            display: block; 
            max-height: 500px;
            object-fit: cover;
        }
        .main-title { font-size: 2.8rem; margin-bottom: 15px; font-weight: 800; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .sub-title { font-size: 1.4rem; opacity: 0.95; font-weight: 500; }
        
        .nav-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 30px; margin-bottom: 40px; }
        .nav-card { background: white; padding: 35px; border-radius: 20px; box-shadow: 0 8px 25px rgba(0,0,0,0.1); text-align: center; transition: all 0.4s ease; cursor: pointer; border: 2px solid transparent; position: relative; overflow: hidden; }
        .nav-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 5px; background: var(--accent); transform: scaleX(0); transition: transform 0.4s ease; }
        .nav-card:hover { transform: translateY(-8px); box-shadow: 0 20px 40px rgba(0,0,0,0.2); border-color: var(--accent); }
        .nav-card:hover::before { transform: scaleX(1); }
        .nav-icon { font-size: 4rem; color: var(--accent); margin-bottom: 25px; }
        .nav-title { font-size: 1.8rem; color: var(--primary); margin-bottom: 20px; font-weight: 700; }
        .nav-description { color: var(--secondary); line-height: 1.7; font-size: 1.1rem; }
        
        .form-container { background: white; padding: 35px; border-radius: 20px; box-shadow: 0 8px 25px rgba(0,0,0,0.1); margin-bottom: 30px; display: none; }
        .form-title { color: var(--primary); font-size: 2.2rem; margin-bottom: 30px; text-align: center; font-weight: 700; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; margin-bottom: 30px; }
        .form-group { margin-bottom: 25px; }
        .form-label { display: block; margin-bottom: 10px; font-weight: 700; color: var(--dark); font-size: 1.1rem; }
        .form-input, .form-select, .form-textarea { width: 100%; padding: 15px 18px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 16px; transition: all 0.3s ease; background: white; }
        .form-input:focus, .form-select:focus, .form-textarea:focus { border-color: var(--accent); outline: none; box-shadow: 0 0 0 4px rgba(49, 130, 206, 0.15); }
        .form-textarea { resize: vertical; min-height: 120px; }
        
        .image-preview { margin-top: 12px; text-align: center; }
        .image-preview img { max-width: 250px; max-height: 180px; border-radius: 10px; border: 2px solid #e2e8f0; }
        .remove-image { margin-top: 8px; background: var(--danger); color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-size: 13px; }
        
        .btn { padding: 15px 35px; border: none; border-radius: 10px; font-size: 17px; font-weight: 700; cursor: pointer; transition: all 0.3s ease; display: inline-flex; align-items: center; justify-content: center; gap: 10px; }
        .btn-primary { background: var(--accent); color: white; }
        .btn-primary:hover { background: #2c5aa0; transform: translateY(-3px); box-shadow: 0 8px 20px rgba(49, 130, 206, 0.4); }
        .btn-secondary { background: var(--secondary); color: white; }
        .btn-success { background: var(--success); color: white; }
        .btn-warning { background: var(--warning); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-full { width: 100%; }
        .btn-group { display: flex; gap: 12px; margin-top: 25px; flex-wrap: wrap; }
        .btn-small { padding: 10px 18px; font-size: 15px; }
        
        .table-container { background: white; border-radius: 20px; box-shadow: 0 8px 25px rgba(0,0,0,0.1); overflow: hidden; margin-bottom: 30px; }
        .table-header { background: var(--gradient); color: white; padding: 25px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px; }
        .table-title { font-size: 1.8rem; font-weight: 700; }
        .filters { display: flex; gap: 20px; flex-wrap: wrap; }
        .filter-group { display: flex; flex-direction: column; gap: 8px; }
        .filter-label { font-size: 1rem; opacity: 0.95; }
        .data-table { width: 100%; border-collapse: collapse; }
        .data-table th { background: #f7fafc; padding: 18px; text-align: right; font-weight: 700; color: var(--dark); border-bottom: 3px solid #e2e8f0; font-size: 1.05rem; }
        .data-table td { padding: 18px; border-bottom: 2px solid #e2e8f0; text-align: right; }
        .data-table tr:hover { background: #f7fafc; }
        .status-badge { padding: 8px 16px; border-radius: 25px; font-size: 0.9rem; font-weight: 700; }
        .status-active { background: #c6f6d5; color: #22543d; }
        .status-expired { background: #fed7d7; color: #c53030; }
        .status-warning { background: #fefcbf; color: #744210; }
        
        .login-container { background: white; padding: 45px; border-radius: 20px; box-shadow: 0 8px 25px rgba(0,0,0,0.1); max-width: 450px; margin: 0 auto; }
        .login-title { color: var(--primary); font-size: 2.2rem; margin-bottom: 35px; text-align: center; font-weight: 700; }
        
        .lang-toggle { position: fixed; top: 25px; left: 25px; background: var(--accent); color: white; border: none; padding: 12px 18px; border-radius: 10px; cursor: pointer; font-weight: 700; z-index: 1000; box-shadow: 0 5px 15px rgba(0,0,0,0.2); display: flex; align-items: center; gap: 10px; font-size: 1rem; }
        
        .loading { display: inline-block; width: 24px; height: 24px; border: 3px solid #ffffff; border-radius: 50%; border-top-color: transparent; animation: spin 1s ease-in-out infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .hidden { display: none; }
        .text-center { text-align: center; }
        .mt-20 { margin-top: 20px; }
        
        .job-announcement { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 35px; border-radius: 20px; margin-bottom: 30px; box-shadow: 0 15px 35px rgba(0,0,0,0.15); text-align: center; }
        .job-announcement h2 { font-size: 2.5rem; margin-bottom: 25px; font-weight: 800; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .job-announcement h3 { font-size: 1.8rem; margin: 25px 0 20px; font-weight: 700; }
        .job-announcement p { font-size: 1.3rem; margin-bottom: 20px; line-height: 1.8; font-weight: 500; }
        .job-announcement ul { text-align: right; margin: 25px 0; padding-right: 25px; }
        .job-announcement li { margin-bottom: 15px; font-size: 1.2rem; line-height: 1.7; }
        
        .success-message { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 30px; border-radius: 20px; margin-top: 30px; text-align: center; display: none; }
        
        .expiry-warning { color: var(--warning); font-size: 1rem; margin-top: 8px; display: none; }
        .expiry-info { color: var(--accent); font-size: 1rem; margin-top: 8px; display: none; }
        
        .verification-container { background: white; padding: 45px; border-radius: 20px; box-shadow: 0 8px 25px rgba(0,0,0,0.1); max-width: 450px; margin: 0 auto; display: none; }
        .verification-title { color: var(--primary); font-size: 2.2rem; margin-bottom: 35px; text-align: center; font-weight: 700; }
        
        .profile-header { background: var(--gradient); color: white; padding: 35px; border-radius: 20px; margin-bottom: 30px; display: flex; align-items: center; gap: 25px; }
        .profile-image { width: 120px; height: 120px; border-radius: 50%; border: 4px solid white; object-fit: cover; }
        .profile-info { flex: 1; }
        .profile-name { font-size: 2.2rem; font-weight: 800; margin-bottom: 8px; }
        .profile-role { font-size: 1.3rem; opacity: 0.95; }
        
        .otp-input { text-align: center; font-size: 1.8rem; font-weight: bold; letter-spacing: 10px; padding: 20px; }
        .otp-message { background: #e6fffa; border: 2px solid #38a169; color: #22543d; padding: 20px; border-radius: 10px; margin: 25px 0; text-align: center; font-weight: 700; font-size: 1.1rem; }
        
        .supervisor-nav { display: flex; gap: 15px; margin-bottom: 25px; flex-wrap: wrap; }
        .supervisor-nav-btn { flex: 1; min-width: 220px; }
        
        .dashboard-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 25px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.1); text-align: center; border-left: 5px solid var(--accent); }
        .stat-value { font-size: 2.5rem; font-weight: 800; color: var(--primary); margin-bottom: 10px; }
        .stat-label { font-size: 1.2rem; color: var(--secondary); font-weight: 600; }
        
        .permission-checkbox { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; }
        .permission-checkbox input { width: 20px; height: 20px; }
        
        .login-credentials { 
            background: #f0f9ff; 
            border: 2px solid #bae6fd; 
            border-radius: 10px; 
            padding: 20px; 
            margin: 20px 0; 
            display: none; /* إخفاء بيانات الدخول */
        }
        .credential-item { display: flex; justify-content: space-between; margin-bottom: 10px; padding: 8px 0; border-bottom: 1px solid #e2e8f0; }
        .credential-label { font-weight: 600; color: var(--primary); }
        .credential-value { font-family: monospace; background: #1a365d; color: white; padding: 4px 8px; border-radius: 4px; }
        
        .show-credentials-btn { 
            background: transparent; 
            border: 2px dashed #3182ce; 
            color: #3182ce; 
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px 0;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        .show-credentials-btn:hover {
            background: #3182ce;
            color: white;
        }
        
        @media (max-width: 768px) {
            .nav-cards, .form-grid { grid-template-columns: 1fr; }
            .table-header { flex-direction: column; align-items: stretch; }
            .filters { flex-direction: column; }
            .data-table { font-size: 0.95rem; }
            .data-table th, .data-table td { padding: 12px 10px; }
            .btn-group { flex-direction: column; }
            .job-announcement h2 { font-size: 2rem; }
            .job-announcement h3 { font-size: 1.5rem; }
            .job-announcement p, .job-announcement li { font-size: 1.1rem; }
            .profile-header { flex-direction: column; text-align: center; }
            .supervisor-nav { flex-direction: column; }
            .video-container { max-width: 100%; }
            .main-title { font-size: 2.2rem; }
            .sub-title { font-size: 1.2rem; }
            .dashboard-stats { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body class="lang-ar">
    <button class="lang-toggle" onclick="toggleLanguage()">
        <i class="fas fa-globe"></i>
        <span id="langText">EN</span>
    </button>

    <div class="container">
        <!-- Header Section -->
        <div class="header">
            <div class="video-container">
                <video autoplay muted loop playsinline>
                    <source src="https://res.cloudinary.com/dfgp8dwj3/video/upload/v1761726342/%D8%A7%D9%84%D8%B2%D9%87%D8%B1%D8%A7%D9%86%D9%8A_1_p6ydli.mp4" type="video/mp4">
                    متصفحك لا يدعم تشغيل الفيديو
                </video>
            </div>
            <h1 class="main-title" data-ar="نظام التوظيف" data-en="Employment System" data-ur="ملازمت کا نظام">نظام التوظيف</h1>
            <p class="sub-title" data-ar="Al-Zahrani Logistics - نظام التوظيف" data-en="Al-Zahrani Logistics - Employment System" data-ur="الزہرانی لوجسٹکس - ملازمت کا نظام">Al-Zahrani Logistics - نظام التوظيف</p>
        </div>

        <!-- Navigation Cards -->
        <div class="nav-cards">
            <div class="nav-card" onclick="showJobApplicationForm()">
                <div class="nav-icon"><i class="fas fa-user-tie"></i></div>
                <h3 class="nav-title" data-ar="تقديم طلب توظيف" data-en="Submit Job Application" data-ur="درخواست جمع کروائیں">تقديم طلب توظيف</h3>
                <p class="nav-description" data-ar="تقديم طلب توظيف لوظيفة مندوب توصيل" data-en="Submit job application for delivery representative" data-ur="ڈیلیوری نمائندے کے لیے درخواست جمع کروائیں">تقديم طلب توظيف لوظيفة مندوب توصيل</p>
            </div>

            <div class="nav-card" onclick="showSupervisorLogin()">
                <div class="nav-icon"><i class="fas fa-user-shield"></i></div>
                <h3 class="nav-title" data-ar="دخول المشرف" data-en="Supervisor Login" data-ur="سپروائزر لاگ ان">دخول المشرف</h3>
                <p class="nav-description" data-ar="إدارة طلبات التوظيف وعرض التقارير" data-en="Manage job applications and view reports" data-ur="ملازمت کی درخواستیں منظم کریں اور رپورٹس دیکھیں">إدارة طلبات التوظيف وعرض التقارير</p>
            </div>
        </div>

        <!-- Job Announcement -->
        <div id="jobAnnouncement" class="job-announcement">
            <h2 data-ar="🚀 فرصة عمل مميزة في شركة الزهراني للخدمات اللوجستية 🏍️" data-en="🚀 Great Job Opportunity at Al-Zahrani Logistics Company 🏍️" data-ur="🚀 الزہرانی لوجسٹکس کمپنی میں بہترین ملازمت کا موقع 🏍️">🚀 فرصة عمل مميزة في شركة الزهراني للخدمات اللوجستية 🏍️</h2>
            <p data-ar="تُعلن شركة الزهراني للخدمات اللوجستية عن فتح باب التوظيف لوظيفة مندوب توصيل (دباب نينجا - استور) ضمن فريق ميداني نشط بالمملكة. نبحث عن شباب طموحين وجادين يمتلكون روح الالتزام والمسؤولية ويحبون العمل الميداني والإنجاز السريع." data-en="Al-Zahrani Logistics Company announces the opening of employment for the position of delivery representative (Ninja Motorcycle - Store) within an active field team in the Kingdom. We are looking for ambitious and serious young people who have a spirit of commitment and responsibility and love field work and quick achievement." data-ur="الزہرانی لوجسٹکس کمپنی مملکت میں ایک فعال فیلڈ ٹیم کے اندر ڈیلیوری نمائندے (ننجا موٹرسائیکل - اسٹور) کی پوزیشن کے لیے ملازمت کے دروازے کھولنے کا اعلان کرتی ہے۔ ہم پرعزم اور سنجیدہ نوجوانوں کی تلاش میں ہیں جن میں وابستگی اور ذمہ داری کا جذبہ ہو اور فیلڈ ورک اور فوری کامیابی سے محبت ہو۔">تُعلن شركة الزهراني للخدمات اللوجستية عن فتح باب التوظيف لوظيفة مندوب توصيل (دباب نينجا - استور) ضمن فريق ميداني نشط بالمملكة. نبحث عن شباب طموحين وجادين يمتلكون روح الالتزام والمسؤولية ويحبون العمل الميداني والإنجاز السريع.</p>
            
            <h3 data-ar="تفاصيل الوظيفة" data-en="Job Details" data-ur="ملازمت کی تفصیلات">تفاصيل الوظيفة</h3>
            <ul>
                <li data-ar="المسمى الوظيفي: مندوب توصيل (دباب نينجا - استور)" data-en="Job Title: Delivery Representative (Ninja Motorcycle - Store)" data-ur="ملازمت کا عنوان: ڈیلیوری نمائندہ (ننجا موٹرسائیکل - اسٹور)">المسمى الوظيفي: مندوب توصيل (دباب نينجا - استور)</li>
                <li data-ar="الراتب الشهري: 2300 ريال" data-en="Monthly Salary: 2300 SAR" data-ur="ماہانہ تنخواہ: 2300 ریال">الراتب الشهري: 2300 ريال</li>
                <li data-ar="ساعات الدوام: 10 ساعة يوميًا (اي ساعة اضافية أوفر تايم)" data-en="Working Hours: 10 hours daily (any extra hour is overtime)" data-ur="کام کے اوقات: روزانہ 10 گھنٹے (کوئی بھی اضافی گھنٹہ اوور ٹائم ہے)">ساعات الدوام: 10 ساعة يوميًا (اي ساعة اضافية أوفر تايم)</li>
                <li data-ar="الشركة توفر الدباب والوقود" data-en="The company provides the motorcycle and fuel" data-ur="کمپنی موٹرسائیکل اور ایندھن مہیا کرتی ہے">الشركة توفر الدباب والوقود</li>
                <li data-ar="نقل كفالة بعد شهرين من بدء العمل" data-en="Sponsorship transfer after two months of work" data-ur="کام شروع کرنے کے دو ماہ بعد کفالت کی منتقلی">نقل كفالة بعد شهرين من بدء العمل</li>
                <li data-ar="المكافآت الإضافية - بونس" data-en="Additional rewards - Bonus" data-ur="اضافی انعامات - بونس">المكافآت الإضافية - بونس</li>
            </ul>
            
            <h3 data-ar="الشروط المطلوبة" data-en="Required Conditions" data-ur="مطلوبہ شرائط">الشروط المطلوبة</h3>
            <ul>
                <li data-ar="إقامة سارية المفعول" data-en="Valid residence permit" data-ur="درست رہائشی اجازت">إقامة سارية المفعول</li>
                <li data-ar="رخصة قيادة دباب سارية" data-en="Valid motorcycle driving license" data-ur="درست موٹرسائیکل ڈرائیونگ لائسنس">رخصة قيادة دباب سارية</li>
                <li data-ar="الجدية والانضباط في العمل" data-en="Seriousness and discipline at work" data-ur="کام میں سنجیدگی اور نظم و ضبط">الجدية والانضباط في العمل</li>
            </ul>
            
            <h3 data-ar="المزايا" data-en="Advantages" data-ur="فوائد">المزايا</h3>
            <ul>
                <li data-ar="بيئة عمل منظمة وداعمة" data-en="Organized and supportive work environment" data-ur="منظم اور معاون کام کا ماحول">بيئة عمل منظمة وداعمة</li>
                <li data-ar="فرصة للاستقرار الوظيفي ونقل الكفالة" data-en="Opportunity for job stability and sponsorship transfer" data-ur="ملازمت کے استحکام اور کفالت کی منتقلی کا موقع">فرصة للاستقرار الوظيفي ونقل الكفالة</li>
                <li data-ar="دعم ومتابعة ميدانية مستمرة" data-en="Continuous field support and follow-up" data-ur="مسلسل فیلڈ سپورٹ اور فالو اپ">دعم ومتابعة ميدانية مستمرة</li>
                <li data-ar="مكان العمل: الشرقية – الدمام" data-en="Work Location: Eastern Province - Dammam" data-ur="کام کی جگہ: مشرقی صوبہ - دمام">مكان العمل: الشرقية – الدمام</li>
            </ul>
        </div>

        <!-- Job Application Form -->
        <div id="jobApplicationForm" class="form-container">
            <h2 class="form-title" data-ar="طلب توظيف جديد" data-en="New Job Application" data-ur="نیا ملازمت کا درخواست فارم">طلب توظيف جديد</h2>
            <form id="jobForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label" data-ar="الاسم الكامل" data-en="Full Name" data-ur="پورا نام">الاسم الكامل</label>
                        <input type="text" class="form-input" id="fullName" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label" data-ar="رقم الجوال" data-en="Phone Number" data-ur="فون نمبر">رقم الجوال</label>
                        <input type="tel" class="form-input" id="phoneNumber" required>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label" data-ar="نوع المركبة" data-en="Vehicle Type" data-ur="گاڑی کی قسم">نوع المركبة</label>
                        <select class="form-select" id="vehicleType" required onchange="toggleLicensePlateField()">
                            <option value="" data-ar="اختر نوع المركبة" data-en="Select Vehicle Type" data-ur="گاڑی کی قسم منتخب کریں">اختر نوع المركبة</option>
                            <option value="دباب" data-ar="دباب" data-en="Motorcycle" data-ur="موٹرسائیکل">دباب</option>
                            <option value="سيارة" data-ar="سيارة" data-en="Car" data-ur="کار">سيارة</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label" data-ar="رقم لوحة المركبة" data-en="Vehicle Plate Number" data-ur="گاڑی کی پلیٹ نمبر">رقم لوحة المركبة</label>
                        <input type="text" class="form-input" id="vehiclePlate" required>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label" data-ar="تاريخ انتهاء الإقامة" data-en="Residence Expiry Date" data-ur="رہائشی کی میعاد ختم ہونے کی تاریخ">تاريخ انتهاء الإقامة</label>
                        <input type="date" class="form-input" id="residenceExpiry" required onchange="checkExpiry(this, 'residence')">
                        <div class="expiry-info" id="residenceInfo" data-ar="⚠️ يمكن تقديم الطلب حتى مع انتهاء الإقامة" data-en="⚠️ Application can be submitted even with expired residence" data-ur="⚠️ درخواست رہائشی ختم ہونے کے باوجود بھی جمع کرائی جا سکتی ہے">⚠️ يمكن تقديم الطلب حتى مع انتهاء الإقامة</div>
                        <div class="expiry-warning" id="residenceWarning" data-ar="⚠️ إقامتك منتهية - يمكنك تقديم الطلب" data-en="⚠️ Your residence is expired - You can still submit the application" data-ur="⚠️ آپ کی رہائش ختم ہو گئی ہے - آپ پھر بھی درخواست جمع کروا سکتے ہیں">⚠️ إقامتك منتهية - يمكنك تقديم الطلب</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" data-ar="تاريخ انتهاء الرخصة" data-en="License Expiry Date" data-ur="لائسنس کی میعاد ختم ہونے کی تاریخ">تاريخ انتهاء الرخصة</label>
                        <input type="date" class="form-input" id="licenseExpiry" required onchange="checkExpiry(this, 'license')">
                        <div class="expiry-warning" id="licenseWarning" data-ar="❌ رخصتك منتهية - لا يمكن تقديم الطلب" data-en="❌ Your license is expired - Cannot submit application" data-ur="❌ آپ کا لائسنس ختم ہو گیا ہے - درخواست جمع نہیں کرائی جا سکتی">❌ رخصتك منتهية - لا يمكن تقديم الطلب</div>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label" data-ar="صورة الإقامة" data-en="Residence Photo" data-ur="رہائشی کی تصویر">صورة الإقامة</label>
                        <input type="file" class="form-input" id="residencePhoto" accept="image/*" onchange="previewImage(this, 'residencePreview')" required>
                        <div class="image-preview" id="residencePreview"></div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" data-ar="صورة رخصة القيادة" data-en="Driving License Photo" data-ur="ڈرائیونگ لائسنس کی تصویر">صورة رخصة القيادة</label>
                        <input type="file" class="form-input" id="licensePhoto" accept="image/*" onchange="previewImage(this, 'licensePreview')" required>
                        <div class="image-preview" id="licensePreview"></div>
                    </div>
                </div>

                <div class="btn-group">
                    <button type="submit" class="btn btn-primary btn-full" id="submitBtn">
                        <i class="fas fa-paper-plane"></i>
                        <span data-ar="تقديم الطلب" data-en="Submit Application" data-ur="درخواست جمع کروائیں">تقديم الطلب</span>
                    </button>
                </div>
            </form>

            <div class="btn-group">
                <button class="btn btn-secondary btn-full" onclick="showHomePage()">
                    <i class="fas fa-arrow-right"></i>
                    <span data-ar="العودة للرئيسية" data-en="Back to Home" data-ur="ہوم پیج پر واپس جائیں">العودة للرئيسية</span>
                </button>
            </div>
        </div>

        <!-- Success Message -->
        <div id="successMessage" class="success-message">
            <h2 data-ar="شكراً لتقديمك للوظيفة!" data-en="Thank you for applying!" data-ur="درخواست دینے کا شکریہ!">شكراً لتقديمك للوظيفة!</h2>
            <p data-ar="سيتم التواصل معك خلال ساعة او اقل" data-en="We will contact you within an hour or less" data-ur="ہم ایک گھنٹے یا اس سے کم وقت میں آپ سے رابطہ کریں گے">سيتم التواصل معك خلال ساعة او اقل</p>
        </div>

        <!-- Supervisor Login -->
        <div id="supervisorLogin" class="login-container">
            <h2 class="login-title" data-ar="دخول المشرف" data-en="Supervisor Login" data-ur="سپروائزر لاگ ان">دخول المشرف</h2>

            <div class="form-group">
                <label class="form-label" data-ar="اسم المستخدم" data-en="Username" data-ur="صارف نام">اسم المستخدم</label>
                <input type="text" class="form-input" id="username" placeholder="أدخل اسم المستخدم">
            </div>

            <div class="form-group">
                <label class="form-label" data-ar="كلمة المرور" data-en="Password" data-ur="پاس ورڈ">كلمة المرور</label>
                <input type="password" class="form-input" id="password" placeholder="أدخل كلمة المرور">
            </div>

            <div class="btn-group">
                <button class="btn btn-primary btn-full" onclick="supervisorLogin()">
                    <i class="fas fa-sign-in-alt"></i>
                    <span data-ar="دخول" data-en="Login" data-ur="لاگ ان">دخول</span>
                </button>
            </div>

            <div class="btn-group">
                <button class="btn btn-secondary btn-full" onclick="showHomePage()">
                    <i class="fas fa-arrow-right"></i>
                    <span data-ar="العودة للرئيسية" data-en="Back to Home" data-ur="ہوم پیج پر واپس جائیں">العودة للرئيسية</span>
                </button>
            </div>
        </div>

        <!-- Supervisor Dashboard -->
        <div id="supervisorDashboard" class="form-container" style="display: none;">
            <!-- Profile Header -->
            <div class="profile-header">
                <img src="https://i.ibb.co/vrKBxqC/profile.jpg" alt="Ahmed Al-Sadiq" class="profile-image">
                <div class="profile-info">
                    <h2 class="profile-name" id="currentSupervisorName">أحمد الصادق</h2>
                    <p class="profile-role" id="currentSupervisorRole" data-ar="مشرف نظام التوظيف" data-en="Employment System Supervisor" data-ur="ملازمت کے نظام کا سپروائزر">مشرف نظام التوظيف</p>
                </div>
                <button class="btn btn-danger" onclick="supervisorLogout()">
                    <i class="fas fa-sign-out-alt"></i>
                    <span data-ar="تسجيل الخروج" data-en="Logout" data-ur="لاگ آؤٹ">تسجيل الخروج</span>
                </button>
            </div>

            <!-- Dashboard Stats -->
            <div id="dashboardStats" class="dashboard-stats">
                <div class="stat-card">
                    <div class="stat-value" id="totalApplications">0</div>
                    <div class="stat-label" data-ar="إجمالي الطلبات" data-en="Total Applications" data-ur="کل درخواستیں">إجمالي الطلبات</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="pendingApplications">0</div>
                    <div class="stat-label" data-ar="طلبات قيد المراجعة" data-en="Pending Applications" data-ur="زیر التواء درخواستیں">طلبات قيد المراجعة</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalRepresentatives">0</div>
                    <div class="stat-label" data-ar="إجمالي المندوبين" data-en="Total Representatives" data-ur="کل نمائندے">إجمالي المندوبين</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalSupervisors">0</div>
                    <div class="stat-label" data-ar="إجمالي المشرفين" data-en="Total Supervisors" data-ur="کل سپروائزر">إجمالي المشرفين</div>
                </div>
            </div>

            <!-- Supervisor Navigation -->
            <div class="supervisor-nav">
                <button class="btn btn-primary supervisor-nav-btn" onclick="showJobApplicationsSection()">
                    <i class="fas fa-users"></i>
                    <span data-ar="طلبات التوظيف" data-en="Job Applications" data-ur="ملازمت کی درخواستیں">طلبات التوظيف</span>
                </button>
                <button class="btn btn-success supervisor-nav-btn" onclick="showAdvanceRequestsSection()">
                    <i class="fas fa-hand-holding-usd"></i>
                    <span data-ar="طلبات السلفيات" data-en="Advance Requests" data-ur="ایڈوانس کی درخواستیں">طلبات السلفيات</span>
                </button>
                <button class="btn btn-warning supervisor-nav-btn" id="representativesNavBtn" onclick="showRepresentativesSection()">
                    <i class="fas fa-user-tie"></i>
                    <span data-ar="المندوبين" data-en="Representatives" data-ur="نمائندے">المندوبين</span>
                </button>
                <button class="btn btn-danger supervisor-nav-btn" id="adminsNavBtn" onclick="showAdminsSection()">
                    <i class="fas fa-user-shield"></i>
                    <span data-ar="المشرفين" data-en="Supervisors" data-ur="سپروائزر">المشرفين</span>
                </button>
                <button class="btn btn-info supervisor-nav-btn" id="reportsNavBtn" onclick="showReportsSection()">
                    <i class="fas fa-chart-bar"></i>
                    <span data-ar="التقارير" data-en="Reports" data-ur="رپورٹس">التقارير</span>
                </button>
            </div>

            <!-- Job Applications Section -->
            <div id="jobApplicationsSection">
                <div class="table-header">
                    <h2 class="table-title" data-ar="طلبات التوظيف المسجلة" data-en="Registered Job Applications" data-ur="رجسٹرڈ ملازمت کی درخواستیں">طلبات التوظيف المسجلة</h2>
                    <div class="filters">
                        <div class="filter-group">
                            <label class="filter-label" data-ar="اسم المتقدم" data-en="Applicant Name" data-ur="درخواست دہندہ کا نام">اسم المتقدم</label>
                            <input type="text" class="form-input" id="filterName" placeholder="بحث بالاسم">
                        </div>

                        <div class="filter-group">
                            <label class="filter-label" data-ar="التاريخ" data-en="Date" data-ur="تاریخ">التاريخ</label>
                            <input type="date" class="form-input" id="filterDate">
                        </div>

                        <div class="filter-group">
                            <label class="filter-label" data-ar="حالة الإقامة" data-en="Residence Status" data-ur="رہائشی کی حالت">حالة الإقامة</label>
                            <select class="form-select" id="filterResidenceStatus">
                                <option value="" data-ar="الكل" data-en="All" data-ur="سب">الكل</option>
                                <option value="active" data-ar="سارية" data-en="Active" data-ur="درست">سارية</option>
                                <option value="expired" data-ar="منتهية" data-en="Expired" data-ur="ختم">منتهية</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-success" onclick="loadJobApplications()" id="loadDataBtn">
                        <i class="fas fa-sync-alt"></i>
                        <span data-ar="عرض البيانات" data-en="Show Data" data-ur="ڈیٹا دکھائیں">عرض البيانات</span>
                    </button>
                    <button class="btn btn-primary" onclick="exportJobApplicationsToExcel()">
                        <i class="fas fa-file-excel"></i>
                        <span data-ar="تحميل Excel" data-en="Download Excel" data-ur="ایکسل ڈاؤن لوڈ کریں">تحميل Excel</span>
                    </button>
                </div>

                <div class="table-container mt-20">
                    <table class="data-table" id="jobApplicationsTable">
                        <thead>
                            <tr>
                                <th data-ar="الاسم" data-en="Name" data-ur="نام">الاسم</th>
                                <th data-ar="رقم الجوال" data-en="Phone" data-ur="فون">رقم الجوال</th>
                                <th data-ar="نوع المركبة" data-en="Vehicle Type" data-ur="گاڑی کی قسم">نوع المركبة</th>
                                <th data-ar="رقم اللوحة" data-en="Plate Number" data-ur="پلیٹ نمبر">رقم اللوحة</th>
                                <th data-ar="انتهاء الإقامة" data-en="Residence Expiry" data-ur="رہائشی کی میعاد">انتهاء الإقامة</th>
                                <th data-ar="حالة الإقامة" data-en="Residence Status" data-ur="رہائشی کی حالت">حالة الإقامة</th>
                                <th data-ar="انتهاء الرخصة" data-en="License Expiry" data-ur="لائسنس کی میعاد">انتهاء الرخصة</th>
                                <th data-ar="حالة الرخصة" data-en="License Status" data-ur="لائسنس کی حالت">حالة الرخصة</th>
                                <th data-ar="صورة الإقامة" data-en="Residence Photo" data-ur="رہائشی تصویر">صورة الإقامة</th>
                                <th data-ar="صورة الرخصة" data-en="License Photo" data-ur="لائسنس تصویر">صورة الرخصة</th>
                                <th data-ar="التاريخ" data-en="Date" data-ur="تاریخ">التاريخ</th>
                                <th data-ar="الإجراءات" data-en="Actions" data-ur="اعمال">الإجراءات</th>
                            </tr>
                        </thead>
                        <tbody id="applicationsTableBody">
                            <!-- البيانات سيتم تحميلها هنا -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- باقي الأقسام تبقى كما هي -->
            <!-- ... -->
            
        </div>
    </div>

    <script>
        let systemState = {
            firebaseReady: false,
            currentEditingId: null,
            selectedResidenceImage: null,
            selectedLicenseImage: null,
            hasExpiredResidence: false,
            hasExpiredLicense: false,
            currentSupervisor: null,
            currentPermissions: {
                jobApps: true,
                advances: true,
                representatives: true,
                admins: true,
                reports: true
            }
        };

        // بيانات الدخول الافتراضية - مخفية
        const defaultSupervisors = [
            {
                id: "ahmed-al-sadiq",
                fullName: "أحمد الصادق",
                username: "احمد الصادق",
                password: "0094",
                permissions: {
                    jobApps: true,
                    advances: true,
                    representatives: true,
                    admins: true,
                    reports: true
                },
                date: new Date().toISOString().split('T')[0],
                timestamp: new Date(),
                createdAt: new Date().toISOString()
            }
        ];

        window.onFirebaseReady = function() {
            systemState.firebaseReady = true;
            console.log("✅ Firebase is ready to use");
            showNotification(getTranslation('✅ تم الاتصال بقاعدة البيانات بنجاح', '✅ Connected to database successfully', '✅ ڈیٹا بیس سے کامیابی سے منسلک ہو گیا'), 'success');
            
            // إنشاء المشرف الافتراضي إذا لم يكن موجوداً
            createDefaultSupervisor();
        };

        // دالة إنشاء المشرف الافتراضي
        async function createDefaultSupervisor() {
            if (!systemState.firebaseReady) return;

            try {
                const supervisorRef = window.firestoreFunctions.doc(window.db, "supervisors", "ahmed-al-sadiq");
                const supervisorSnap = await window.firestoreFunctions.getDoc(supervisorRef);
                
                if (!supervisorSnap.exists()) {
                    await window.firestoreFunctions.setDoc(supervisorRef, defaultSupervisors[0]);
                    console.log("✅ Default supervisor created successfully");
                }
            } catch (error) {
                console.error("Error creating default supervisor:", error);
            }
        }

        // دالة تسجيل الدخول المبسطة
        async function supervisorLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (!username || !password) {
                showNotification(getTranslation('❌ يرجى إدخال اسم المستخدم وكلمة المرور', '❌ Please enter username and password', '❌ براہ کرم صارف نام اور پاس ورڈ درج کریں'), 'error');
                return;
            }

            // التحقق من البيانات الافتراضية أولاً
            const defaultSupervisor = defaultSupervisors.find(s => s.username === username && s.password === password);
            if (defaultSupervisor) {
                systemState.currentSupervisor = defaultSupervisor;
                systemState.currentPermissions = defaultSupervisor.permissions;
                
                // تحديث الاسم في لوحة التحكم
                document.getElementById('currentSupervisorName').textContent = defaultSupervisor.fullName;
                
                showSupervisorDashboard();
                showNotification(getTranslation('✅ تم تسجيل الدخول بنجاح - أحمد الصادق', '✅ Login successful - Ahmed Al-Sadiq', '✅ لاگ ان کامیاب - احمد الصادق'), 'success');
                return;
            }

            // إذا لم تكن البيانات افتراضية، تحقق من Firebase
            if (!systemState.firebaseReady) {
                showNotification(getTranslation('⏳ جاري الاتصال بقاعدة البيانات...', '⏳ Connecting to database...', '⏳ ڈیٹا بیس سے منسلک ہو رہا ہے...'), 'warning');
                return;
            }

            try {
                const q = window.firestoreFunctions.query(
                    window.firestoreFunctions.collection(window.db, "supervisors"),
                    window.firestoreFunctions.where("username", "==", username)
                );
                
                const querySnapshot = await window.firestoreFunctions.getDocs(q);
                
                if (querySnapshot.empty) {
                    showNotification(getTranslation('❌ اسم المستخدم غير صحيح', '❌ Invalid username', '❌ غلط صارف نام'), 'error');
                    return;
                }

                let supervisorFound = false;
                querySnapshot.forEach((doc) => {
                    const supervisorData = doc.data();
                    if (supervisorData.password === password) {
                        supervisorFound = true;
                        systemState.currentSupervisor = {
                            id: doc.id,
                            ...supervisorData
                        };
                        
                        // حفظ الصلاحيات في حالة النظام
                        systemState.currentPermissions = supervisorData.permissions || {
                            jobApps: true,
                            advances: true,
                            representatives: false,
                            admins: false,
                            reports: false
                        };
                    }
                });

                if (supervisorFound) {
                    showSupervisorDashboard();
                    showNotification(getTranslation('✅ تم تسجيل الدخول بنجاح', '✅ Login successful', '✅ لاگ ان کامیاب'), 'success');
                } else {
                    showNotification(getTranslation('❌ كلمة المرور غير صحيحة', '❌ Invalid password', '❌ غلط پاس ورڈ'), 'error');
                }
            } catch (error) {
                console.error('Error during login:', error);
                showNotification(getTranslation('❌ حدث خطأ أثناء تسجيل الدخول', '❌ Error during login', '❌ لاگ ان کے دوران خرابی'), 'error');
            }
        }

        // دوال العرض الأساسية
        function showHomePage() {
            document.getElementById('jobApplicationForm').style.display = 'none';
            document.getElementById('supervisorLogin').style.display = 'none';
            document.getElementById('supervisorDashboard').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
            document.getElementById('verificationContainer').style.display = 'none';
            document.querySelector('.nav-cards').style.display = 'grid';
            document.getElementById('jobAnnouncement').style.display = 'block';
            resetForm();
        }

        function showJobApplicationForm() {
            document.querySelector('.nav-cards').style.display = 'none';
            document.getElementById('jobApplicationForm').style.display = 'block';
            document.getElementById('supervisorLogin').style.display = 'none';
            document.getElementById('supervisorDashboard').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
            document.getElementById('verificationContainer').style.display = 'none';
            document.getElementById('jobAnnouncement').style.display = 'none';
            resetForm();
        }

        function showSupervisorLogin() {
            document.querySelector('.nav-cards').style.display = 'none';
            document.getElementById('jobApplicationForm').style.display = 'none';
            document.getElementById('supervisorLogin').style.display = 'block';
            document.getElementById('supervisorDashboard').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
            document.getElementById('verificationContainer').style.display = 'none';
            document.getElementById('jobAnnouncement').style.display = 'none';
            
            // مسح الحقول عند العرض
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        function showSupervisorDashboard() {
            document.querySelector('.nav-cards').style.display = 'none';
            document.getElementById('jobApplicationForm').style.display = 'none';
            document.getElementById('supervisorLogin').style.display = 'none';
            document.getElementById('supervisorDashboard').style.display = 'block';
            document.getElementById('successMessage').style.display = 'none';
            document.getElementById('verificationContainer').style.display = 'none';
            document.getElementById('jobAnnouncement').style.display = 'none';
            
            // تحديث واجهة المستخدم بناءً على الصلاحيات
            updateUIByPermissions();
            
            showJobApplicationsSection();
            loadDashboardStats();
        }

        function supervisorLogout() {
            systemState.currentSupervisor = null;
            systemState.currentPermissions = {
                jobApps: true,
                advances: true,
                representatives: false,
                admins: false,
                reports: false
            };
            
            // مسح الحقول عند الخروج
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            
            showHomePage();
            showNotification(getTranslation('تم تسجيل الخروج', 'Logged out successfully', 'لاگ آؤٹ کامیاب'), 'info');
        }

        function updateUIByPermissions() {
            const permissions = systemState.currentPermissions;
            
            // إخفاء/إظهار أزرار التنقل بناءً على الصلاحيات
            document.getElementById('representativesNavBtn').style.display = permissions.representatives ? 'flex' : 'none';
            document.getElementById('adminsNavBtn').style.display = permissions.admins ? 'flex' : 'none';
            document.getElementById('reportsNavBtn').style.display = permissions.reports ? 'flex' : 'none';
        }

        // دوال تحميل البيانات الأساسية
        async function loadJobApplications() {
            if (!systemState.firebaseReady) {
                showNotification(getTranslation('⏳ جاري الاتصال بقاعدة البيانات...', '⏳ Connecting to database...', '⏳ ڈیٹا بیس سے منسلک ہو رہا ہے...'), 'warning');
                return;
            }

            try {
                const q = window.firestoreFunctions.query(
                    window.firestoreFunctions.collection(window.db, "jobApplications"),
                    window.firestoreFunctions.orderBy("timestamp", "desc")
                );
                
                const querySnapshot = await window.firestoreFunctions.getDocs(q);
                const tableBody = document.getElementById('applicationsTableBody');
                tableBody.innerHTML = '';

                if (querySnapshot.empty) {
                    tableBody.innerHTML = '<tr><td colspan="12" class="text-center">' + getTranslation('لا توجد بيانات', 'No data found', 'کوئی ڈیٹا نہیں ملا') + '</td></tr>';
                    return;
                }

                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    const residenceStatusBadge = data.residenceStatus === 'active' ? 
                        '<span class="status-badge status-active">' + getTranslation('سارية', 'Active', 'درست') + '</span>' :
                        '<span class="status-badge status-expired">' + getTranslation('منتهية', 'Expired', 'ختم') + '</span>';
                    
                    const licenseStatusBadge = data.licenseStatus === 'active' ? 
                        '<span class="status-badge status-active">' + getTranslation('سارية', 'Active', 'درست') + '</span>' :
                        '<span class="status-badge status-expired">' + getTranslation('منتهية', 'Expired', 'ختم') + '</span>';
                    
                    const row = `
                        <tr data-id="${doc.id}">
                            <td>${data.fullName || '-'}</td>
                            <td>${data.phoneNumber || '-'}</td>
                            <td>${data.vehicleType || '-'}</td>
                            <td>${data.vehiclePlate || '-'}</td>
                            <td>${data.residenceExpiry || '-'}</td>
                            <td>${residenceStatusBadge}</td>
                            <td>${data.licenseExpiry || '-'}</td>
                            <td>${licenseStatusBadge}</td>
                            <td>
                                ${data.residenceImageUrl ? 
                                    `<a href="${data.residenceImageUrl}" target="_blank" class="btn btn-primary btn-small">
                                        <i class="fas fa-eye"></i> ${getTranslation('عرض', 'View', 'دیکھیں')}
                                    </a>` : 
                                    '-'
                                }
                            </td>
                            <td>
                                ${data.licenseImageUrl ? 
                                    `<a href="${data.licenseImageUrl}" target="_blank" class="btn btn-primary btn-small">
                                        <i class="fas fa-eye"></i> ${getTranslation('عرض', 'View', 'دیکھیں')}
                                    </a>` : 
                                    '-'
                                }
                            </td>
                            <td>${data.date || '-'}</td>
                            <td>
                                <div class="btn-group">
                                    <button class="btn btn-warning btn-small" onclick="editApplication('${doc.id}')">
                                        <i class="fas fa-edit"></i> ${getTranslation('تعديل', 'Edit', 'ترمیم')}
                                    </button>
                                    <button class="btn btn-danger btn-small" onclick="deleteApplication('${doc.id}')">
                                        <i class="fas fa-trash"></i> ${getTranslation('حذف', 'Delete', 'حذف کریں')}
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                    tableBody.innerHTML += row;
                });

                showNotification(getTranslation('✅ تم تحميل البيانات بنجاح', '✅ Data loaded successfully', '✅ ڈیٹا کامیابی سے لوڈ ہو گیا'), 'success');

            } catch (error) {
                console.error('Error loading data:', error);
                showNotification(getTranslation('❌ حدث خطأ أثناء تحميل البيانات', '❌ Error loading data', '❌ ڈیٹا لوڈ کرنے میں خرابی'), 'error');
            }
        }

        // دوال التحويل بين اللغات
        function toggleLanguage() {
            const body = document.body;
            const langToggle = document.getElementById('langText');
            
            if (body.classList.contains('lang-ar')) {
                body.classList.remove('lang-ar');
                body.classList.add('lang-en');
                langToggle.textContent = 'AR';
                document.documentElement.dir = 'ltr';
                document.documentElement.lang = 'en';
                updateLanguage('en');
            } else if (body.classList.contains('lang-en')) {
                body.classList.remove('lang-en');
                body.classList.add('lang-ur');
                langToggle.textContent = 'EN';
                document.documentElement.dir = 'rtl';
                document.documentElement.lang = 'ur';
                updateLanguage('ur');
            } else {
                body.classList.remove('lang-ur');
                body.classList.add('lang-ar');
                langToggle.textContent = 'UR';
                document.documentElement.dir = 'rtl';
                document.documentElement.lang = 'ar';
                updateLanguage('ar');
            }
        }

        function updateLanguage(lang) {
            document.querySelectorAll('[data-ar], [data-en], [data-ur]').forEach(element => {
                if (element.hasAttribute(`data-${lang}`)) {
                    element.textContent = element.getAttribute(`data-${lang}`);
                }
            });
        }

        function getTranslation(ar, en, ur) {
            const body = document.body;
            if (body.classList.contains('lang-ar')) return ar;
            if (body.classList.contains('lang-en')) return en;
            if (body.classList.contains('lang-ur')) return ur;
            return ar;
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                ${document.body.classList.contains('lang-ar') || document.body.classList.contains('lang-ur') ? 'left: 20px' : 'right: 20px'};
                padding: 15px 25px;
                border-radius: 8px;
                color: white;
                font-weight: 600;
                z-index: 10000;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                transition: all 0.3s ease;
                max-width: 400px;
            `;

            const colors = {
                success: '#38a169',
                error: '#e53e3e',
                info: '#3182ce',
                warning: '#d69e2e'
            };

            notification.style.background = colors[type] || colors.info;
            notification.textContent = message;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateY(-20px)';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 5000);
        }

        // دوال مساعدة إضافية
        function resetForm() {
            document.getElementById('jobForm').reset();
            document.getElementById('residencePreview').innerHTML = '';
            document.getElementById('licensePreview').innerHTML = '';
            document.getElementById('residenceWarning').style.display = 'none';
            document.getElementById('licenseWarning').style.display = 'none';
            document.getElementById('residenceInfo').style.display = 'block';
            systemState.currentEditingId = null;
            systemState.selectedResidenceImage = null;
            systemState.selectedLicenseImage = null;
            systemState.hasExpiredResidence = false;
            systemState.hasExpiredLicense = false;
        }

        async function loadDashboardStats() {
            if (!systemState.firebaseReady) return;

            try {
                // تحميل إحصائيات طلبات التوظيف
                const jobAppsSnapshot = await window.firestoreFunctions.getDocs(
                    window.firestoreFunctions.collection(window.db, "jobApplications")
                );
                document.getElementById('totalApplications').textContent = jobAppsSnapshot.size;
                
                // تحميل إحصائيات المندوبين
                const repsSnapshot = await window.firestoreFunctions.getDocs(
                    window.firestoreFunctions.collection(window.db, "representatives")
                );
                document.getElementById('totalRepresentatives').textContent = repsSnapshot.size;
                
                // تحميل إحصائيات المشرفين
                const supervisorsSnapshot = await window.firestoreFunctions.getDocs(
                    window.firestoreFunctions.collection(window.db, "supervisors")
                );
                document.getElementById('totalSupervisors').textContent = supervisorsSnapshot.size;
                
            } catch (error) {
                console.error('Error loading dashboard stats:', error);
            }
        }

        // تهيئة الصفحة
        document.addEventListener('DOMContentLoaded', function() {
            updateLanguage('ar');
            showNotification(getTranslation('مرحباً بك في نظام توظيف الزهراني', 'Welcome to Al-Zahrani Employment System', 'الزہرانی ملازمت کے نظام میں خوش آمدید'), 'info');
        });
    </script>
</body>
</html>
